{"version":3,"file":"klinecharts.simple.js","sources":["../src/data/extension.js","../src/utils/typeChecks.js","../src/options/styleOptions.js","../src/utils/format.js","../src/utils/logger.js","../src/utils/number.js","../src/data/constants.js","../src/data/store/TimeScaleStore.js","../src/component/technicalindicator/TechnicalIndicator.js","../src/data/store/TechnicalIndicatorStore.js","../src/component/overlay/Overlay.js","../src/renderer/circle.js","../src/extension/shape/shapeHelper.js","../src/renderer/path.js","../src/renderer/line.js","../src/utils/canvas.js","../src/component/overlay/Shape.js","../src/data/store/ShapeStore.js","../src/data/store/AnnotationStore.js","../src/data/store/TagStore.js","../src/data/store/CrosshairStore.js","../src/data/delegate/Delegate.js","../src/data/store/ActionStore.js","../src/data/ChartData.js","../src/utils/element.js","../src/pane/Pane.js","../src/widget/Widget.js","../src/utils/compatible.js","../src/view/View.js","../src/view/TechnicalIndicatorView.js","../src/renderer/text.js","../src/view/TechnicalIndicatorOverlayView.js","../src/widget/TechnicalIndicatorWidget.js","../src/renderer/rect.js","../src/view/YAxisView.js","../src/view/YAxisOverlayView.js","../src/widget/YAxisWidget.js","../src/component/axis/Axis.js","../src/component/axis/YAxis.js","../src/pane/TechnicalIndicatorPane.js","../src/view/CandleView.js","../src/view/CandleOverlayView.js","../src/widget/CandleWidget.js","../src/pane/CandlePane.js","../src/view/XAxisView.js","../src/view/XAxisOverlayView.js","../src/widget/XAxisWidget.js","../src/component/axis/XAxis.js","../src/pane/XAxisPane.js","../src/event/EventBase.js","../src/pane/SeparatorPane.js","../src/event/EventHandler.js","../src/event/ZoomScrollEventHandler.js","../src/event/OverlayEventHandler.js","../src/event/KeyBoardEventHandler.js","../src/event/ChartEvent.js","../src/utils/performance.js","../src/renderer/diamond.js","../src/renderer/triangle.js","../src/component/overlay/Annotation.js","../src/component/overlay/Tag.js","../src/pane/ChartPane.js","../src/Chart.js","../src/core.js"],"sourcesContent":["/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport default {\r\n  technicalIndicatorExtensions: {},\r\n  shapeExtensions: {},\r\n  addTechnicalIndicatorTemplate (template) {\r\n    if (template) {\r\n      ([].concat(template)).forEach(\r\n        tmp => {\r\n          if (tmp.name) {\r\n            this.technicalIndicatorExtensions[tmp.name] = tmp\r\n          }\r\n        }\r\n      )\r\n    }\r\n  },\r\n  addShapeTemplate (template) {\r\n    if (template) {\r\n      ([].concat(template)).forEach(\r\n        tmp => {\r\n          if (tmp.name) {\r\n            this.shapeExtensions[tmp.name] = tmp\r\n          }\r\n        }\r\n      )\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 合并\r\n * @param target\r\n * @param source\r\n */\r\nexport function merge (target, source) {\r\n  if (!isObject(target) || !isObject(source)) {\r\n    return\r\n  }\r\n  for (const key in source) {\r\n    if (Object.prototype.hasOwnProperty.call(source, key) && (key in target)) {\r\n      const targetProp = target[key]\r\n      const sourceProp = source[key]\r\n      if (\r\n        isObject(sourceProp) &&\r\n        isObject(targetProp) &&\r\n        !isArray(sourceProp) &&\r\n        !isArray(targetProp)\r\n      ) {\r\n        merge(targetProp, sourceProp)\r\n      } else {\r\n        if (isValid(source[key])) {\r\n          target[key] = source[key]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 克隆\r\n * @param target\r\n * @return {{}|*}\r\n */\r\nexport function clone (target) {\r\n  if (!isObject(target)) {\r\n    return target\r\n  }\r\n\r\n  let copy\r\n  if (isArray(target)) {\r\n    copy = []\r\n  } else {\r\n    copy = {}\r\n  }\r\n  for (const key in target) {\r\n    if (Object.prototype.hasOwnProperty.call(target, key)) {\r\n      const v = target[key]\r\n      if (isObject(v)) {\r\n        copy[key] = clone(v)\r\n      } else {\r\n        copy[key] = v\r\n      }\r\n    }\r\n  }\r\n  return copy\r\n}\r\n\r\n/**\r\n * 是否是数组\r\n * @param value\r\n * @return {boolean}\r\n */\r\nexport function isArray (value) {\r\n  return Object.prototype.toString.call(value) === '[object Array]'\r\n}\r\n\r\n/**\r\n * 是否是方法\r\n * @param {*} value\r\n * @return {boolean}\r\n */\r\nexport function isFunction (value) {\r\n  return value && typeof value === 'function'\r\n}\r\n\r\n/**\r\n * 是否是对象\r\n * @param {*} value\r\n * @return {boolean}\r\n */\r\nexport function isObject (value) {\r\n  return (!!value && typeof value === 'object')\r\n}\r\n\r\n/**\r\n * 判断是否是数字\r\n * @param value\r\n * @returns {boolean}\r\n */\r\nexport function isNumber (value) {\r\n  return typeof value === 'number' && !isNaN(value)\r\n}\r\n\r\n/**\r\n * 判断是否有效\r\n * @param value\r\n * @returns {boolean}\r\n */\r\nexport function isValid (value) {\r\n  return value !== null && value !== undefined\r\n}\r\n\r\n/**\r\n * 判断是否是boolean\r\n * @param value\r\n * @returns {boolean}\r\n */\r\nexport function isBoolean (value) {\r\n  return typeof value === 'boolean'\r\n}\r\n\r\n/**\r\n * 是否是字符串\r\n * @param value\r\n * @return {boolean}\r\n */\r\nexport function isString (value) {\r\n  return typeof value === 'string'\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 填充空心样式类型\r\n */\r\nexport const StrokeFillStyle = {\r\n  STROKE: 'stroke',\r\n  FILL: 'fill'\r\n}\r\n\r\n/**\r\n * 线的样式\r\n * @type {{DASH: string, SOLID: string}}\r\n */\r\nexport const LineStyle = {\r\n  DASH: 'dash',\r\n  SOLID: 'solid'\r\n}\r\n\r\n/**\r\n * y轴位置\r\n * @type {{LEFT: string, RIGHT: string}}\r\n */\r\nexport const YAxisPosition = {\r\n  LEFT: 'left',\r\n  RIGHT: 'right'\r\n}\r\n\r\n/**\r\n * y轴类型\r\n * @type {{PERCENTAGE: string, NORMAL: string}}\r\n */\r\nexport const YAxisType = {\r\n  NORMAL: 'normal',\r\n  PERCENTAGE: 'percentage',\r\n  LOG: 'log'\r\n}\r\n\r\n/**\r\n * 蜡烛图样式\r\n * @type {{AREA: string, OHLC: string, CANDLE_STROKE: string, CANDLE_SOLID: string, CANDLE_DOWN_STROKE: string, CANDLE_UP_STROKE: string}}\r\n */\r\nexport const CandleType = {\r\n  CANDLE_SOLID: 'candle_solid',\r\n  CANDLE_STROKE: 'candle_stroke',\r\n  CANDLE_UP_STROKE: 'candle_up_stroke',\r\n  CANDLE_DOWN_STROKE: 'candle_down_stroke',\r\n  OHLC: 'ohlc',\r\n  AREA: 'area'\r\n}\r\n\r\n/**\r\n * 说明显示规则\r\n * @type {{FOLLOW_CROSS: string, NONE: string, ALWAYS: string}}\r\n */\r\nexport const TooltipShowRule = {\r\n  ALWAYS: 'always',\r\n  FOLLOW_CROSS: 'follow_cross',\r\n  NONE: 'none'\r\n}\r\n\r\n/**\r\n * 数据提示显示类型\r\n * @type {{RECT: string, STANDARD: string}}\r\n */\r\nexport const TooltipShowType = {\r\n  RECT: 'rect',\r\n  STANDARD: 'standard'\r\n}\r\n\r\n/**\r\n * 注解标识类似\r\n * @type {{RECT: string, TRIANGLE: string, DIAMOND: string, CUSTOM: string, NONE: string, CIRCLE: string}}\r\n */\r\nexport const AnnotationSymbolType = {\r\n  CIRCLE: 'circle',\r\n  RECT: 'rect',\r\n  TRIANGLE: 'triangle',\r\n  DIAMOND: 'diamond',\r\n  CUSTOM: 'custom',\r\n  NONE: 'none'\r\n}\r\n\r\n/**\r\n * 覆盖物位置\r\n * @type {{TOP: string, BOTTOM: string, POINT: string}}\r\n */\r\nexport const OverlayPosition = {\r\n  POINT: 'point',\r\n  TOP: 'top',\r\n  BOTTOM: 'bottom'\r\n}\r\n\r\n/**\r\n * 默认网格配置\r\n * @type {{horizontal: {size: number, color: string, dashValue: number[], show: boolean, style: string}, show: boolean, vertical: {size: number, color: string, dashValue: number[], show: boolean, style: string}}}\r\n */\r\nconst defaultGrid = {\r\n  show: true,\r\n  horizontal: {\r\n    show: true,\r\n    size: 1,\r\n    color: '#EDEDED',\r\n    style: LineStyle.DASH,\r\n    dashValue: [2, 2]\r\n  },\r\n  vertical: {\r\n    show: true,\r\n    size: 1,\r\n    color: '#EDEDED',\r\n    style: LineStyle.DASH,\r\n    dashValue: [2, 2]\r\n  }\r\n}\r\n\r\n/**\r\n * 默认蜡烛柱图样式配置\r\n * @type {{area: {backgroundColor: [{offset: number, color: string}, {offset: number, color: string}], lineColor: string, lineSize: number, value: string}, bar: {noChangeColor: string, upColor: string, downColor: string}, tooltip: {rect: {offsetTop: number, fillColor: string, borderColor: string, paddingBottom: number, borderRadius: number, paddingRight: number, borderSize: number, offsetLeft: number, paddingTop: number, paddingLeft: number, offsetRight: number}, showRule: string, values: null, showType: string, text: {marginRight: number, size: number, color: string, weight: string, marginBottom: number, family: string, marginTop: number, marginLeft: number}, labels: string[]}, type: string, priceMark: {high: {textMargin: number, textSize: number, color: string, textFamily: string, show: boolean, textWeight: string}, last: {noChangeColor: string, upColor: string, line: {dashValue: number[], size: number, show: boolean, style: string}, show: boolean, text: {paddingBottom: number, size: number, color: string, paddingRight: number, show: boolean, weight: string, paddingTop: number, family: string, paddingLeft: number}, downColor: string}, low: {textMargin: number, textSize: number, color: string, textFamily: string, show: boolean, textWeight: string}, show: boolean}}}\r\n */\r\nconst defaultCandle = {\r\n  margin: {\r\n    top: 0.2,\r\n    bottom: 0.1\r\n  },\r\n  type: CandleType.CANDLE_SOLID,\r\n  bar: {\r\n    /**\r\n     * 上涨颜色\r\n     */\r\n    upColor: '#26A69A',\r\n    /**\r\n     * 下跌颜色\r\n     */\r\n    downColor: '#EF5350',\r\n    /**\r\n     * 无变化时颜色\r\n     */\r\n    noChangeColor: '#999999'\r\n  },\r\n  area: {\r\n    lineSize: 2,\r\n    lineColor: '#2196F3',\r\n    value: 'close',\r\n    backgroundColor: [{\r\n      offset: 0,\r\n      color: 'rgba(33, 150, 243, 0.01)'\r\n    }, {\r\n      offset: 1,\r\n      color: 'rgba(33, 150, 243, 0.2)'\r\n    }]\r\n  },\r\n  priceMark: {\r\n    show: true,\r\n    high: {\r\n      show: true,\r\n      color: '#76808F',\r\n      textMargin: 5,\r\n      textSize: 10,\r\n      textFamily: 'Helvetica Neue',\r\n      textWeight: 'normal'\r\n    },\r\n    low: {\r\n      show: true,\r\n      color: '#76808F',\r\n      textMargin: 5,\r\n      textSize: 10,\r\n      textFamily: 'Helvetica Neue',\r\n      textWeight: 'normal'\r\n    },\r\n    last: {\r\n      show: true,\r\n      upColor: '#26A69A',\r\n      downColor: '#EF5350',\r\n      noChangeColor: '#888888',\r\n      line: {\r\n        show: true,\r\n        style: LineStyle.DASH,\r\n        dashValue: [4, 4],\r\n        size: 1\r\n      },\r\n      text: {\r\n        show: true,\r\n        size: 12,\r\n        paddingLeft: 2,\r\n        paddingTop: 2,\r\n        paddingRight: 2,\r\n        paddingBottom: 2,\r\n        color: '#FFFFFF',\r\n        family: 'Helvetica Neue',\r\n        weight: 'normal',\r\n        borderRadius: 2\r\n      }\r\n    }\r\n  },\r\n  tooltip: {\r\n    showRule: TooltipShowRule.ALWAYS,\r\n    showType: TooltipShowType.STANDARD,\r\n    labels: ['时间: ', '开: ', '收: ', '高: ', '低: ', '成交量: '],\r\n    values: null,\r\n    defaultValue: 'n/a',\r\n    rect: {\r\n      paddingLeft: 0,\r\n      paddingRight: 0,\r\n      paddingTop: 0,\r\n      paddingBottom: 6,\r\n      offsetLeft: 8,\r\n      offsetTop: 8,\r\n      offsetRight: 8,\r\n      borderRadius: 4,\r\n      borderSize: 1,\r\n      borderColor: '#F2F3F5',\r\n      backgroundColor: '#FEFEFE'\r\n    },\r\n    text: {\r\n      size: 12,\r\n      family: 'Helvetica Neue',\r\n      weight: 'normal',\r\n      color: '#76808F',\r\n      marginLeft: 8,\r\n      marginTop: 6,\r\n      marginRight: 8,\r\n      marginBottom: 0\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 默认的技术指标样式配置\r\n * @type {{bar: {noChangeColor: string, upColor: string, downColor: string}, line: {size: number, colors: [string, string, string, string, string]}, tooltip: {showParams: boolean, showName: boolean, showRule: string, text: {marginRight: number, size: number, color: string, weight: string, marginBottom: number, family: string, marginTop: number, marginLeft: number}}, circle: {noChangeColor: string, upColor: string, downColor: string}, lastValueMark: {show: boolean, text: {paddingBottom: number, color: string, size: number, paddingRight: number, show: boolean, weight: string, paddingTop: number, family: string, paddingLeft: number}}}}\r\n */\r\nconst defaultTechnicalIndicator = {\r\n  margin: {\r\n    top: 0.2,\r\n    bottom: 0.1\r\n  },\r\n  bar: {\r\n    upColor: 'rgba(38, 166, 154, .65)',\r\n    downColor: 'rgba(239, 83, 80, .65)',\r\n    noChangeColor: '#888888'\r\n  },\r\n  line: {\r\n    size: 1,\r\n    colors: ['#FF9600', '#9D65C9', '#2196F3', '#E11D74', '#01C5C4']\r\n  },\r\n  circle: {\r\n    upColor: 'rgba(38, 166, 154, .65)',\r\n    downColor: 'rgba(239, 83, 80, .65)',\r\n    noChangeColor: '#888888'\r\n  },\r\n  lastValueMark: {\r\n    show: false,\r\n    text: {\r\n      show: false,\r\n      color: '#FFFFFF',\r\n      size: 12,\r\n      family: 'Helvetica Neue',\r\n      weight: 'normal',\r\n      paddingLeft: 3,\r\n      paddingTop: 2,\r\n      paddingRight: 3,\r\n      paddingBottom: 2,\r\n      borderRadius: 2\r\n    }\r\n  },\r\n  tooltip: {\r\n    showRule: TooltipShowRule.ALWAYS,\r\n    showType: TooltipShowType.STANDARD,\r\n    showName: true,\r\n    showParams: true,\r\n    defaultValue: 'n/a',\r\n    text: {\r\n      size: 12,\r\n      family: 'Helvetica Neue',\r\n      weight: 'normal',\r\n      color: '#76808F',\r\n      marginTop: 6,\r\n      marginRight: 8,\r\n      marginBottom: 0,\r\n      marginLeft: 8\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 默认x轴配置\r\n * @type {{axisLine: {color: string, size: number, show: boolean}, show: boolean, tickText: {paddingBottom: number, color: string, size: number, show: boolean, weight: string, paddingTop: number, family: string}, height: null, tickLine: {size: number, color: string, show: boolean, length: number}}}\r\n */\r\nconst defaultXAxis = {\r\n  /**\r\n   * 是否显示整个轴\r\n   */\r\n  show: true,\r\n  /**\r\n   * 高度\r\n   */\r\n  height: null,\r\n  /**\r\n   * 轴线配置\r\n   */\r\n  axisLine: {\r\n    show: true,\r\n    color: '#DDDDDD',\r\n    size: 1\r\n  },\r\n\r\n  /**\r\n   * tick文字\r\n   */\r\n  tickText: {\r\n    show: true,\r\n    color: '#76808F',\r\n    size: 12,\r\n    family: 'Helvetica Neue',\r\n    weight: 'normal',\r\n    paddingTop: 3,\r\n    paddingBottom: 6\r\n  },\r\n  // tick线\r\n  tickLine: {\r\n    show: true,\r\n    size: 1,\r\n    length: 3,\r\n    color: '#DDDDDD'\r\n  }\r\n}\r\n\r\n/**\r\n * 默认y轴配置\r\n * @type {{axisLine: {color: string, size: number, show: boolean}, show: boolean, width: null, position: string, tickText: {color: string, size: number, paddingRight: number, show: boolean, weight: string, family: string, paddingLeft: number}, type: string, inside: boolean, tickLine: {size: number, color: string, show: boolean, length: number}}}\r\n */\r\nconst defaultYAxis = {\r\n  /**\r\n   * 是否显示整个轴\r\n   */\r\n  show: true,\r\n  /**\r\n   * 宽度\r\n   */\r\n  width: null,\r\n  /**\r\n   * y轴类型\r\n   */\r\n  type: YAxisType.NORMAL,\r\n  /**\r\n   * 轴位置\r\n   */\r\n  position: YAxisPosition.RIGHT,\r\n  /**\r\n   * 轴是否在内部\r\n   */\r\n  inside: false,\r\n  /**\r\n   * 轴线配置\r\n   */\r\n  axisLine: {\r\n    show: true,\r\n    color: '#DDDDDD',\r\n    size: 1\r\n  },\r\n\r\n  /**\r\n   * tick文字\r\n   */\r\n  tickText: {\r\n    show: true,\r\n    color: '#76808F',\r\n    size: 12,\r\n    family: 'Helvetica Neue',\r\n    weight: 'normal',\r\n    paddingLeft: 3,\r\n    paddingRight: 6\r\n  },\r\n  // tick线\r\n  tickLine: {\r\n    show: true,\r\n    size: 1,\r\n    length: 3,\r\n    color: '#DDDDDD'\r\n  }\r\n}\r\n\r\nconst defaultCrosshair = {\r\n  show: true,\r\n  horizontal: {\r\n    show: true,\r\n    line: {\r\n      show: true,\r\n      style: LineStyle.DASH,\r\n      dashValue: [4, 2],\r\n      size: 1,\r\n      color: '#76808F'\r\n    },\r\n    text: {\r\n      show: true,\r\n      color: '#FFFFFF',\r\n      size: 12,\r\n      family: 'Helvetica Neue',\r\n      weight: 'normal',\r\n      paddingLeft: 2,\r\n      paddingRight: 2,\r\n      paddingTop: 2,\r\n      paddingBottom: 2,\r\n      borderSize: 1,\r\n      borderColor: '#686D76',\r\n      borderRadius: 2,\r\n      backgroundColor: '#686D76'\r\n    }\r\n  },\r\n  vertical: {\r\n    show: true,\r\n    line: {\r\n      show: true,\r\n      style: LineStyle.DASH,\r\n      dashValue: [4, 2],\r\n      size: 1,\r\n      color: '#76808F'\r\n    },\r\n    text: {\r\n      show: true,\r\n      color: '#FFFFFF',\r\n      size: 12,\r\n      family: 'Helvetica Neue',\r\n      weight: 'normal',\r\n      paddingLeft: 2,\r\n      paddingRight: 2,\r\n      paddingTop: 2,\r\n      paddingBottom: 2,\r\n      borderSize: 1,\r\n      borderRadius: 2,\r\n      borderColor: '#686D76',\r\n      backgroundColor: '#686D76'\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 默认图形配置\r\n * @type {{arc: {style: string, color: string, size: number}, polygon: {style: string, color: string, size: number}, line: {style: string, color: string, size: number, dashValue: number[]}, text: {style: string, marginRight: number, color: string, size: number, weight: string, marginBottom: number, family: string, marginTop: number, marginLeft: number}, point: {backgroundColor: string, borderColor: string, activeBorderSize: number, activeRadius: number, activeBorderColor: string, activeBackgroundColor: string, borderSize: number, radius: number}}}\r\n */\r\nconst defaultShape = {\r\n  point: {\r\n    backgroundColor: '#2196F3',\r\n    borderColor: 'rgba(33, 150, 243, 0.35)',\r\n    borderSize: 1,\r\n    radius: 5,\r\n    activeBackgroundColor: '#2196F3',\r\n    activeBorderColor: 'rgba(33, 150, 243, 0.35)',\r\n    activeBorderSize: 3,\r\n    activeRadius: 5\r\n  },\r\n  line: {\r\n    style: LineStyle.SOLID,\r\n    color: '#2196F3',\r\n    size: 1,\r\n    dashValue: [2, 2]\r\n  },\r\n  polygon: {\r\n    style: StrokeFillStyle.STROKE,\r\n    stroke: {\r\n      style: LineStyle.SOLID,\r\n      size: 1,\r\n      color: '#2196F3',\r\n      dashValue: [2, 2]\r\n    },\r\n    fill: {\r\n      color: '#2196F3'\r\n    }\r\n  },\r\n  arc: {\r\n    style: StrokeFillStyle.STROKE,\r\n    stroke: {\r\n      style: LineStyle.SOLID,\r\n      size: 1,\r\n      color: '#2196F3',\r\n      dashValue: [2, 2]\r\n    },\r\n    fill: {\r\n      color: '#2196F3'\r\n    }\r\n  },\r\n  text: {\r\n    style: StrokeFillStyle.FILL,\r\n    color: '#2196F3',\r\n    size: 12,\r\n    family: 'Helvetica Neue',\r\n    weight: 'normal',\r\n    offset: [0, 0]\r\n  }\r\n}\r\n\r\n/**\r\n * 默认注解信息配置\r\n * @type {{}}\r\n */\r\nconst defaultAnnotation = {\r\n  position: OverlayPosition.TOP,\r\n  offset: [20, 0],\r\n  symbol: {\r\n    type: AnnotationSymbolType.DIAMOND,\r\n    size: 8,\r\n    color: '#2196F3',\r\n    activeSize: 10,\r\n    activeColor: '#FF9600'\r\n  }\r\n}\r\n\r\nconst defaultTag = {\r\n  position: OverlayPosition.POINT,\r\n  offset: 0,\r\n  line: {\r\n    show: true,\r\n    style: LineStyle.DASH,\r\n    dashValue: [4, 2],\r\n    size: 1,\r\n    color: '#2196F3'\r\n  },\r\n  text: {\r\n    color: '#FFFFFF',\r\n    backgroundColor: '#2196F3',\r\n    size: 12,\r\n    family: 'Helvetica Neue',\r\n    weight: 'normal',\r\n    paddingLeft: 2,\r\n    paddingRight: 2,\r\n    paddingTop: 2,\r\n    paddingBottom: 2,\r\n    borderRadius: 2\r\n  },\r\n  mark: {\r\n    color: '#FFFFFF',\r\n    backgroundColor: '#2196F3',\r\n    size: 12,\r\n    family: 'Helvetica Neue',\r\n    weight: 'normal',\r\n    paddingLeft: 2,\r\n    paddingRight: 2,\r\n    paddingTop: 2,\r\n    paddingBottom: 2,\r\n    borderRadius: 2\r\n  }\r\n}\r\n\r\n/**\r\n * 图表之间默认分割配置\r\n * @type {{size: number, color: string}}\r\n */\r\nconst defaultSeparator = {\r\n  size: 1,\r\n  color: '#DDDDDD',\r\n  fill: true,\r\n  activeBackgroundColor: 'rgba(33, 150, 243, 0.08)'\r\n}\r\n\r\nexport const defaultStyleOptions = {\r\n  grid: defaultGrid,\r\n  candle: defaultCandle,\r\n  technicalIndicator: defaultTechnicalIndicator,\r\n  xAxis: defaultXAxis,\r\n  yAxis: defaultYAxis,\r\n  separator: defaultSeparator,\r\n  crosshair: defaultCrosshair,\r\n  shape: defaultShape,\r\n  annotation: defaultAnnotation,\r\n  tag: defaultTag\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isNumber, isObject, isValid } from './typeChecks'\r\n\r\n/**\r\n * 格式化值\r\n * @param data\r\n * @param key\r\n * @param defaultValue\r\n * @returns {string|*}\r\n */\r\nexport function formatValue (data, key, defaultValue = '--') {\r\n  if (isObject(data)) {\r\n    const value = data[key]\r\n    if (isValid(value)) {\r\n      return value\r\n    }\r\n  }\r\n  return defaultValue\r\n}\r\n\r\n/**\r\n * 格式化时间\r\n * @param dateTimeFormat\r\n * @param timestamp\r\n * @param format\r\n * @returns {string}\r\n */\r\nexport function formatDate (dateTimeFormat, timestamp, format = 'MM-DD hh:mm') {\r\n  if (isNumber(timestamp)) {\r\n    const dateTimeString = dateTimeFormat.format(new Date(timestamp))\r\n    const dateTimeStringArray = dateTimeString.split(', ')\r\n    const dateStringArray = dateTimeStringArray[0].split('/')\r\n    const date = {\r\n      YYYY: dateStringArray[2],\r\n      MM: dateStringArray[0],\r\n      DD: dateStringArray[1],\r\n      'hh:mm': dateTimeStringArray[1].match(/^[\\d]{2}/)[0] === '24'\r\n        ? dateTimeStringArray[1].replace(/^[\\d]{2}/, '00')\r\n        : dateTimeStringArray[1]\r\n    }\r\n    return format.replace(/YYYY|MM|DD|(hh:mm)/g, key => date[key])\r\n  }\r\n  return '--'\r\n}\r\n\r\n/**\r\n * 格式化精度\r\n */\r\nexport function formatPrecision (value, precision = 2) {\r\n  const v = +value\r\n  if ((v || v === 0) && isNumber(v)) {\r\n    return v.toFixed(precision)\r\n  }\r\n  return `${v}`\r\n}\r\n\r\n/**\r\n * 格式化大数据\r\n * @param value\r\n */\r\nexport function formatBigNumber (value) {\r\n  if (isNumber(+value)) {\r\n    if (value > 1000000000) {\r\n      return `${+((value / 1000000000).toFixed(3))}B`\r\n    }\r\n    if (value > 1000000) {\r\n      return `${+((value / 1000000).toFixed(3))}M`\r\n    }\r\n    if (value > 1000) {\r\n      return `${+((value / 1000).toFixed(3))}K`\r\n    }\r\n    return value\r\n  }\r\n  return '--'\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nconst DEV = '__BUILD_ENV__' === 'development'\r\n\r\n/**\r\n * 打印警告日志\r\n * @param api\r\n * @param invalidParam\r\n * @param append\r\n */\r\nexport function logWarn (api, invalidParam, append = '') {\r\n  if (DEV) {\r\n    console.log(\r\n      '%c😑 klinecharts warning: \\n%s%s%s',\r\n      'color:#fcaf17;font-weight:bold',\r\n      api ? `Call api ${api}${invalidParam || append ? ', ' : '.'}` : '',\r\n      invalidParam ? `invalid parameter ${invalidParam}${append ? ', ' : '.'}` : '',\r\n      append ? `${append}` : ''\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * 打印错误日志\r\n * @param api\r\n * @param invalidParam\r\n * @param append\r\n */\r\nexport function logError (api, invalidParam, append = '') {\r\n  if (DEV) {\r\n    console.log(\r\n      '%c😟 klinecharts error: \\n%s%s%s',\r\n      'color:#ed1941;font-weight:bold',\r\n      api ? `Call api ${api}${invalidParam || append ? ', ' : '.'},` : '',\r\n      invalidParam ? `invalid parameter ${invalidParam}${append ? ', ' : '.'}` : '',\r\n      append ? `${append}` : ''\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * 打印标识\r\n */\r\nexport function logTag () {\r\n  if (DEV) {\r\n    console.log(\r\n      '%c❤️ Welcome to klinecharts. Version is __BUILD_VERSION__',\r\n      'border-radius:2px;border:dashed 1px #2196F3;padding:26px 20px;font-size:14px;color:#2196F3'\r\n    )\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 二分查找最接近的数\r\n * @param dataList\r\n * @param valueKey\r\n * @param targetNumber\r\n * @return {number}\r\n */\r\nexport function binarySearchNearest (dataList, valueKey, targetNumber) {\r\n  let left = 0\r\n  let right = 0\r\n  for (right = dataList.length - 1; left !== right;) {\r\n    const midIndex = Math.floor((right + left) / 2)\r\n    const mid = right - left\r\n    const midValue = dataList[midIndex][valueKey]\r\n    if (targetNumber === dataList[left][valueKey]) {\r\n      return left\r\n    }\r\n    if (targetNumber === dataList[right][valueKey]) {\r\n      return right\r\n    }\r\n    if (targetNumber === midValue) {\r\n      return midIndex\r\n    }\r\n\r\n    if (targetNumber > midValue) {\r\n      left = midIndex\r\n    } else {\r\n      right = midIndex\r\n    }\r\n\r\n    if (mid <= 2) {\r\n      break\r\n    }\r\n  }\r\n  return left\r\n}\r\n\r\n/**\r\n * 优化数字\r\n * @param value\r\n * @return {number|number}\r\n */\r\nexport function nice (value) {\r\n  const exponent = Math.floor(log10(value))\r\n  const exp10 = index10(exponent)\r\n  const f = value / exp10 // 1 <= f < 10\r\n  let nf = 0\r\n  if (f < 1.5) {\r\n    nf = 1\r\n  } else if (f < 2.5) {\r\n    nf = 2\r\n  } else if (f < 3.5) {\r\n    nf = 3\r\n  } else if (f < 4.5) {\r\n    nf = 4\r\n  } else if (f < 5.5) {\r\n    nf = 5\r\n  } else if (f < 6.5) {\r\n    nf = 6\r\n  } else {\r\n    nf = 8\r\n  }\r\n  value = nf * exp10\r\n  return exponent >= -20 ? +value.toFixed(exponent < 0 ? -exponent : 0) : value\r\n}\r\n\r\n/**\r\n * 四和五入\r\n * @param value\r\n * @param precision\r\n * @return {number}\r\n */\r\nexport function round (value, precision) {\r\n  if (precision == null) {\r\n    precision = 10\r\n  }\r\n  precision = Math.min(Math.max(0, precision), 20)\r\n  value = (+value).toFixed(precision)\r\n  return +value\r\n}\r\n\r\n/**\r\n * 获取小数位数\r\n * @param value\r\n * @return {number|number}\r\n */\r\nexport function getPrecision (value) {\r\n  const str = value.toString()\r\n  const eIndex = str.indexOf('e')\r\n  if (eIndex > 0) {\r\n    const precision = +str.slice(eIndex + 1)\r\n    return precision < 0 ? -precision : 0\r\n  } else {\r\n    const dotIndex = str.indexOf('.')\r\n    return dotIndex < 0 ? 0 : str.length - 1 - dotIndex\r\n  }\r\n}\r\n\r\n/**\r\n * 10为低的对数函数\r\n * @param value\r\n * @return {number}\r\n */\r\nexport function log10 (value) {\r\n  return Math.log(value) / Math.log(10)\r\n}\r\n\r\n/**\r\n * 10的指数函数\r\n * @param value\r\n * @return {number}\r\n */\r\nexport function index10 (value) {\r\n  return Math.pow(10, value)\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n// 默认技术指标窗口高度\r\nexport const DEFAULT_TECHNICAL_INDICATOR_PANE_HEIGHT = 100\r\n\r\n// 技术指标窗口id前缀\r\nexport const TECHNICAL_INDICATOR_PANE_ID_PREFIX = 'technical_indicator_pane_'\r\n\r\n// 图形id前缀\r\nexport const SHAPE_ID_PREFIX = 'shape_'\r\n\r\n// 蜡烛图窗口id\r\nexport const CANDLE_PANE_ID = 'candle_pane'\r\n\r\n// 最小单条数据宽度\r\nexport const MIN_DATA_SPACE = 1\r\n\r\n// 最大单条数据宽度\r\nexport const MAX_DATA_SPACE = 50\r\n\r\n/**\r\n * 刷新层级\r\n * @type {{OVERLAY: number, MAIN: number, NONE: number, FULL: number}}\r\n */\r\nexport const InvalidateLevel = {\r\n  NONE: 0,\r\n  OVERLAY: 1,\r\n  MAIN: 2,\r\n  FULL: 3\r\n}\r\n\r\n/**\r\n * 图表动作\r\n * @type {{DRAW_CANDLE: string, SCROLL: string, PANE_DRAG: string, ZOOM: string, CROSSHAIR: string, DRAW_TECHNICAL_INDICATOR: string}}\r\n */\r\nexport const ActionType = {\r\n  ZOOM: 'zoom',\r\n  SCROLL: 'scroll',\r\n  CROSSHAIR: 'crosshair',\r\n  PANE_DRAG: 'pane_drag'\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isFunction, isValid } from '../../utils/typeChecks'\r\nimport { formatValue } from '../../utils/format'\r\nimport { logWarn } from '../../utils/logger'\r\n\r\nimport { binarySearchNearest } from '../../utils/number'\r\n\r\nimport { MIN_DATA_SPACE, MAX_DATA_SPACE, ActionType } from '../constants'\r\n\r\nexport default class TimeScaleStore {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n    this._dateTimeFormat = new Intl.DateTimeFormat(\r\n      'en', {\r\n        hour12: false, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'\r\n      }\r\n    )\r\n\r\n    // 是否可以缩放\r\n    this._zoomEnabled = true\r\n    // 是否可以拖拽滑动\r\n    this._scrollEnabled = true\r\n\r\n    // 是否在加载中\r\n    this._loading = true\r\n    // 加载更多回调\r\n    this._loadMoreCallback = null\r\n    // 还有更多\r\n    this._more = true\r\n\r\n    // 可见区域数据占用的空间\r\n    this._totalDataSpace = 0\r\n    // 每一条数据的空间\r\n    this._dataSpace = 6\r\n    // bar的空间\r\n    this._barSpace = this._calcBarSpace()\r\n    // 向右偏移的空间\r\n    this._offsetRightSpace = 50\r\n    // 向右偏移的数量\r\n    this._offsetRightBarCount = this._offsetRightSpace / this._dataSpace\r\n    // 左边最小可见bar的个数\r\n    this._leftMinVisibleBarCount = 2\r\n    // 右边最小可见bar的个数\r\n    this._rightMinVisibleBarCount = 2\r\n    // 开始绘制的索引\r\n    this._from = 0\r\n    // 结束的索引\r\n    this._to = 0\r\n\r\n    // 用来记录开始拖拽时向右偏移的数量\r\n    this._preOffsetRightBarCount = 0\r\n  }\r\n\r\n  /**\r\n   * 计算一条柱子的空间\r\n   * @returns {number}\r\n   * @private\r\n   */\r\n  _calcBarSpace () {\r\n    const rateBarSpace = Math.floor(this._dataSpace * 0.82)\r\n    const floorBarSpace = Math.floor(this._dataSpace)\r\n    const optimalBarSpace = Math.min(rateBarSpace, floorBarSpace - 1)\r\n    return Math.max(1, optimalBarSpace)\r\n  }\r\n\r\n  /**\r\n   * 调整绘制起点终点位置\r\n   * @private\r\n   */\r\n  adjustFromTo () {\r\n    const dataSize = this._chartData.dataList().length\r\n    const barLength = this._totalDataSpace / this._dataSpace\r\n    const maxRightOffsetBarCount = barLength - Math.min(this._leftMinVisibleBarCount, dataSize)\r\n    if (this._offsetRightBarCount > maxRightOffsetBarCount) {\r\n      this._offsetRightBarCount = maxRightOffsetBarCount\r\n    }\r\n\r\n    const minRightOffsetBarCount = -dataSize + Math.min(this._rightMinVisibleBarCount, dataSize)\r\n\r\n    if (this._offsetRightBarCount < minRightOffsetBarCount) {\r\n      this._offsetRightBarCount = minRightOffsetBarCount\r\n    }\r\n    this._to = Math.round(this._offsetRightBarCount + dataSize + 0.5)\r\n    this._from = Math.round(this._to - barLength) - 1\r\n    if (this._to > dataSize) {\r\n      this._to = dataSize\r\n    }\r\n    if (this._from < 0) {\r\n      this._from = 0\r\n    }\r\n    this._chartData.adjustVisibleDataList()\r\n    // 处理加载更多，有更多并且没有在加载则去加载更多\r\n    if (this._from === 0 && this._more && !this._loading && isFunction(this._loadMoreCallback)) {\r\n      this._loading = true\r\n      this._loadMoreCallback(formatValue(this._chartData.dataList()[0], 'timestamp'))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置是否有更多\r\n   * @param more\r\n   */\r\n  setMore (more) {\r\n    this._more = more\r\n  }\r\n\r\n  /**\r\n   * 设置是否在加载\r\n   */\r\n  setLoading (loading) {\r\n    this._loading = loading\r\n  }\r\n\r\n  /**\r\n   * 获取时间格式化\r\n   * @returns {Intl.DateTimeFormat | Intl.DateTimeFormat}\r\n   */\r\n  dateTimeFormat () {\r\n    return this._dateTimeFormat\r\n  }\r\n\r\n  /**\r\n   * 设置时区\r\n   * @param timezone\r\n   */\r\n  setTimezone (timezone) {\r\n    let dateTimeFormat\r\n    try {\r\n      dateTimeFormat = new Intl.DateTimeFormat(\r\n        'en', {\r\n          hour12: false, timeZone: timezone, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'\r\n        }\r\n      )\r\n    } catch (e) {\r\n      logWarn('', '', 'Timezone is error!!!')\r\n    }\r\n    if (dateTimeFormat) {\r\n      this._dateTimeFormat = dateTimeFormat\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取时区\r\n   * @returns {null}\r\n   */\r\n  timezone () {\r\n    return this._dateTimeFormat.resolvedOptions().timeZone\r\n  }\r\n\r\n  /**\r\n   * 获取一条数据的空间\r\n   * @returns {number}\r\n   */\r\n  dataSpace () {\r\n    return this._dataSpace\r\n  }\r\n\r\n  /**\r\n   * 获取绘制一条数据的空间（不包括bar之间的间隙）\r\n   * @returns {*}\r\n   */\r\n  barSpace () {\r\n    return this._barSpace\r\n  }\r\n\r\n  /**\r\n   * 获取绘制一条数据一半的空间（不包括bar之间的间隙）\r\n   * @returns\r\n   */\r\n  halfBarSpace () {\r\n    return this._barSpace / 2\r\n  }\r\n\r\n  /**\r\n   * 设置一条数据的空间\r\n   * @param dataSpace\r\n   * @param adjustBeforeFuc\r\n   */\r\n  setDataSpace (dataSpace, adjustBeforeFuc) {\r\n    if (dataSpace < MIN_DATA_SPACE || dataSpace > MAX_DATA_SPACE || this._dataSpace === dataSpace) {\r\n      return\r\n    }\r\n    this._dataSpace = dataSpace\r\n    this._barSpace = this._calcBarSpace()\r\n    adjustBeforeFuc && adjustBeforeFuc()\r\n    this.adjustFromTo()\r\n    this._chartData.crosshairStore().recalculate(true)\r\n    this._chartData.invalidate()\r\n  }\r\n\r\n  /**\r\n   * 设置可见区域数据占用的总空间\r\n   * @param totalSpace\r\n   */\r\n  setTotalDataSpace (totalSpace) {\r\n    if (this._totalDataSpace === totalSpace) {\r\n      return\r\n    }\r\n    this._totalDataSpace = totalSpace\r\n    this.adjustFromTo()\r\n    this._chartData.crosshairStore().recalculate(true)\r\n  }\r\n\r\n  /**\r\n   * 设置右边可以偏移的空间\r\n   * @param space\r\n   * @param invalidate\r\n   */\r\n  setOffsetRightSpace (space, invalidate) {\r\n    this._offsetRightSpace = space\r\n    this._offsetRightBarCount = space / this._dataSpace\r\n    if (invalidate) {\r\n      this.adjustFromTo()\r\n      this._chartData.crosshairStore().recalculate(true)\r\n      this._chartData.invalidate()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重置右边可以偏移的空间\r\n   */\r\n  resetOffsetRightSpace () {\r\n    this.setOffsetRightSpace(this._offsetRightSpace)\r\n  }\r\n\r\n  /**\r\n   * 右偏移距离\r\n   * @return {number}\r\n   */\r\n  offsetRightSpace () {\r\n    return this._offsetRightSpace\r\n  }\r\n\r\n  /**\r\n   * 右偏移bar数量\r\n   * @return {*|number}\r\n   */\r\n  offsetRightBarCount () {\r\n    return this._offsetRightBarCount\r\n  }\r\n\r\n  /**\r\n   * 设置右偏移bar数量\r\n   * @param barCount\r\n   */\r\n  setOffsetRightBarCount (barCount) {\r\n    this._offsetRightBarCount = barCount\r\n  }\r\n\r\n  /**\r\n   * 设置左边可见的最小bar数量\r\n   * @param barCount\r\n   */\r\n  setLeftMinVisibleBarCount (barCount) {\r\n    this._leftMinVisibleBarCount = barCount\r\n  }\r\n\r\n  /**\r\n   * 设置右边可见的最小bar数量\r\n   * @param barCount\r\n   */\r\n  setRightMinVisibleBarCount (barCount) {\r\n    this._rightMinVisibleBarCount = barCount\r\n  }\r\n\r\n  /**\r\n   * 获取数据绘制起点\r\n   * @returns {number}\r\n   */\r\n  from () {\r\n    return this._from\r\n  }\r\n\r\n  /**\r\n   * 获取数据绘制终点\r\n   * @returns {number}\r\n   */\r\n  to () {\r\n    return this._to\r\n  }\r\n\r\n  /**\r\n   * 开始滚动\r\n   */\r\n  startScroll () {\r\n    this._preOffsetRightBarCount = this._offsetRightBarCount\r\n  }\r\n\r\n  /**\r\n   * 滚动\r\n   * @param distance\r\n   * @param crosshair\r\n   */\r\n  scroll (distance, crosshair) {\r\n    if (!this._scrollEnabled) {\r\n      return\r\n    }\r\n    const distanceBarCount = distance / this._dataSpace\r\n    this._chartData.actionStore().execute(ActionType.SCROLL, { barCount: distanceBarCount, distance })\r\n    this._offsetRightBarCount = this._preOffsetRightBarCount - distanceBarCount\r\n    this.adjustFromTo()\r\n    const cross = crosshair || this._chartData.crosshairStore().get()\r\n    this._chartData.crosshairStore().set(cross, true)\r\n    this._chartData.invalidate()\r\n  }\r\n\r\n  /**\r\n   * 根据索引获取数据\r\n   * @param dataIndex\r\n   */\r\n  getDataByDataIndex (dataIndex) {\r\n    return this._chartData.dataList()[dataIndex]\r\n  }\r\n\r\n  /**\r\n   * x转换成浮点数的位置\r\n   * @param x\r\n   * @returns {number}\r\n   */\r\n  coordinateToFloatIndex (x) {\r\n    const dataSize = this._chartData.dataList().length\r\n    const deltaFromRight = (this._totalDataSpace - x) / this._dataSpace\r\n    const index = dataSize + this._offsetRightBarCount - deltaFromRight\r\n    return Math.round(index * 1000000) / 1000000\r\n  }\r\n\r\n  /**\r\n   * 数据索引转换成时间戳\r\n   * @param dataIndex\r\n   * @return {*}\r\n   */\r\n  dataIndexToTimestamp (dataIndex) {\r\n    const data = this.getDataByDataIndex(dataIndex)\r\n    if (data) {\r\n      return data.timestamp\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 将时间戳转换成数据索引位置\r\n   * @param timestamp\r\n   * @return {number}\r\n   */\r\n  timestampToDataIndex (timestamp) {\r\n    if (this._chartData.dataList().length === 0) {\r\n      return 0\r\n    }\r\n    return binarySearchNearest(this._chartData.dataList(), 'timestamp', timestamp)\r\n  }\r\n\r\n  /**\r\n   * 数据索引转换成坐标\r\n   * @param dataIndex\r\n   */\r\n  dataIndexToCoordinate (dataIndex) {\r\n    const dataSize = this._chartData.dataList().length\r\n    const deltaFromRight = dataSize + this._offsetRightBarCount - dataIndex\r\n    return this._totalDataSpace - (deltaFromRight - 0.5) * this._dataSpace\r\n  }\r\n\r\n  /**\r\n   * 坐标换成数据索引转\r\n   * @param pixel\r\n   */\r\n  coordinateToDataIndex (pixel) {\r\n    return Math.ceil(this.coordinateToFloatIndex(pixel)) - 1\r\n  }\r\n\r\n  /**\r\n   * 缩放\r\n   * @param scale\r\n   * @param coordinate\r\n   */\r\n  zoom (scale, coordinate) {\r\n    if (!this._zoomEnabled) {\r\n      return\r\n    }\r\n    if (!coordinate || !isValid(coordinate.x)) {\r\n      const crosshair = this._chartData.crosshairStore().get()\r\n      coordinate = { x: isValid(crosshair.x) ? crosshair.x : this._totalDataSpace / 2 }\r\n    }\r\n    this._chartData.actionStore().execute(ActionType.ZOOM, { coordinate, scale })\r\n    const floatIndex = this.coordinateToFloatIndex(coordinate.x)\r\n    const dataSpace = this._dataSpace + scale * (this._dataSpace / 10)\r\n    this.setDataSpace(dataSpace, () => {\r\n      this._offsetRightBarCount += (floatIndex - this.coordinateToFloatIndex(coordinate.x))\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 设置是否可以缩放\r\n   * @param enabled\r\n   */\r\n  setZoomEnabled (enabled) {\r\n    this._zoomEnabled = enabled\r\n  }\r\n\r\n  /**\r\n   * 获取是否可以缩放\r\n   * @return {boolean}\r\n   */\r\n  zoomEnabled () {\r\n    return this._zoomEnabled\r\n  }\r\n\r\n  /**\r\n   * 设置是否可以拖拽滚动\r\n   * @param enabled\r\n   */\r\n  setScrollEnabled (enabled) {\r\n    this._scrollEnabled = enabled\r\n  }\r\n\r\n  /**\r\n   * 获取是否可以拖拽滚动\r\n   * @return {boolean}\r\n   */\r\n  scrollEnabled () {\r\n    return this._scrollEnabled\r\n  }\r\n\r\n  /**\r\n   * 设置加载更多\r\n   * @param callback\r\n   */\r\n  setLoadMoreCallback (callback) {\r\n    this._loadMoreCallback = callback\r\n  }\r\n\r\n  /**\r\n   * 清除数据\r\n   */\r\n  clear () {\r\n    this._more = true\r\n    this._loading = true\r\n    this._from = 0\r\n    this._to = 0\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { clone, isArray, isBoolean, isNumber, merge, isObject } from '../../utils/typeChecks'\r\n\r\n/**\r\n * 绘制类型\r\n * @type {{BAR: string, LINE: string, CIRCLE: string}}\r\n */\r\nexport const TechnicalIndicatorPlotType = {\r\n  LINE: 'line',\r\n  BAR: 'bar',\r\n  CIRCLE: 'circle'\r\n}\r\n\r\n/**\r\n * 系列\r\n */\r\nexport const TechnicalIndicatorSeries = {\r\n  PRICE: 'price',\r\n  VOLUME: 'volume',\r\n  NORMAL: 'normal'\r\n}\r\n\r\nexport default class TechnicalIndicator {\r\n  constructor ({\r\n    name, series, calcParams, plots, precision,\r\n    shouldCheckParamCount, shouldOhlc, shouldFormatBigNumber,\r\n    minValue, maxValue, styles\r\n  }) {\r\n    // 指标名\r\n    this.name = name || ''\r\n    // 系列\r\n    this.series = Object.values(TechnicalIndicatorSeries).indexOf(series) !== -1 ? series : TechnicalIndicatorSeries.NORMAL\r\n    // 精度\r\n    this.precision = isNumber(precision) && precision >= 0 ? precision : 4\r\n    // 精度设置标识\r\n    this._precisionFlag = false\r\n    // 计算参数\r\n    this.calcParams = isArray(calcParams) ? calcParams : []\r\n    // 数据信息\r\n    this.plots = isArray(plots) ? plots : []\r\n    // 是否需要检查参数\r\n    this.shouldCheckParamCount = isBoolean(shouldCheckParamCount) ? shouldCheckParamCount : true\r\n    // 是否需要ohlc\r\n    this.shouldOhlc = isBoolean(shouldOhlc) ? shouldOhlc : false\r\n    // 是否需要格式化大数据值，从1000开始格式化，比如100000是否需要格式化100K\r\n    this.shouldFormatBigNumber = isBoolean(shouldFormatBigNumber) ? shouldFormatBigNumber : false\r\n    // 指定的最小值\r\n    this.minValue = minValue\r\n    // 指定的最大值\r\n    this.maxValue = maxValue\r\n    // 样式\r\n    this.styles = styles\r\n    // 结果\r\n    this.result = []\r\n  }\r\n\r\n  _createParams (calcParams) {\r\n    return calcParams.map(param => {\r\n      if (isObject(param)) {\r\n        return param.value\r\n      }\r\n      return param\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 设置精度\r\n   * @param precision\r\n   * @param flag\r\n   * @returns\r\n   */\r\n  setPrecision (precision, flag) {\r\n    if (isNumber(precision) && precision >= 0 && (!flag || (flag && !this._precisionFlag))) {\r\n      this.precision = parseInt(precision, 10)\r\n      if (!flag) {\r\n        this._precisionFlag = true\r\n      }\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 设置计算参数\r\n   * @param params\r\n   * @returns\r\n   */\r\n  setCalcParams (params) {\r\n    if (!isArray(params)) {\r\n      return false\r\n    }\r\n    if (this.shouldCheckParamCount && params.length !== this.calcParams.length) {\r\n      return false\r\n    }\r\n    const calcParams = []\r\n    for (let i = 0; i < params.length; i++) {\r\n      const param = params[i]\r\n      let v\r\n      let allowDecimal\r\n      if (isObject(param)) {\r\n        v = param.value\r\n        allowDecimal = param.allowDecimal\r\n      } else {\r\n        v = param\r\n        allowDecimal = false\r\n      }\r\n      const oldParam = this.calcParams[i]\r\n      if (isObject(oldParam) && isBoolean(oldParam.allowDecimal)) {\r\n        allowDecimal = oldParam.allowDecimal\r\n      }\r\n      if (\r\n        !isNumber(v) ||\r\n        v <= 0 ||\r\n        (!allowDecimal && parseInt(v, 10) !== v)\r\n      ) {\r\n        return false\r\n      }\r\n      calcParams.push({ allowDecimal, value: v })\r\n    }\r\n    this.calcParams = calcParams\r\n    const plots = this.regeneratePlots(this._createParams(calcParams))\r\n    if (plots && isArray(plots)) {\r\n      this.plots = plots\r\n    }\r\n    return true\r\n  }\r\n\r\n  setShouldOhlc (shouldOhlc) {\r\n    if (isBoolean(shouldOhlc) && this.shouldOhlc !== shouldOhlc) {\r\n      this.shouldOhlc = shouldOhlc\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  setShouldFormatBigNumber (shouldFormatBigNumber) {\r\n    if (isBoolean(shouldFormatBigNumber) && this.shouldFormatBigNumber !== shouldFormatBigNumber) {\r\n      this.shouldFormatBigNumber = shouldFormatBigNumber\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  setStyles (styles, defaultStyles) {\r\n    if (!isObject(styles)) {\r\n      return false\r\n    }\r\n    if (!this.styles) {\r\n      this.styles = {\r\n        bar: clone(defaultStyles.bar),\r\n        line: clone(defaultStyles.line),\r\n        circle: clone(defaultStyles.circle)\r\n      }\r\n    }\r\n    merge(this.styles, styles)\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 计算\r\n   * @param dataList\r\n   * @return {*}\r\n   */\r\n  calc (dataList) {\r\n    this.result = this.calcTechnicalIndicator(dataList, {\r\n      params: this._createParams(this.calcParams),\r\n      plots: this.plots\r\n    }) || []\r\n  }\r\n\r\n  /**\r\n   * 计算技术指标\r\n   */\r\n  calcTechnicalIndicator (dataList, options) {}\r\n\r\n  /**\r\n   * 重新生成各项数据\r\n   * @param params\r\n   */\r\n  regeneratePlots (params) {}\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport extension from '../extension'\r\n\r\nimport { isFunction, isValid, isObject } from '../../utils/typeChecks'\r\nimport { formatPrecision, formatBigNumber } from '../../utils/format'\r\n\r\nimport { logWarn } from '../../utils/logger'\r\n\r\nimport TechnicalIndicator, { TechnicalIndicatorSeries } from '../../component/technicalindicator/TechnicalIndicator'\r\n\r\n/**\r\n * 获取技术指标提示数据\r\n * @param technicalIndicatorData\r\n * @param technicalIndicator\r\n * @return {{calcParamText: string, values: [], name: string}}\r\n */\r\nexport function getTechnicalIndicatorTooltipData (technicalIndicatorData = {}, technicalIndicator) {\r\n  const calcParams = technicalIndicator.calcParams\r\n  const plots = technicalIndicator.plots\r\n  const precision = technicalIndicator.precision\r\n  const shouldFormatBigNumber = technicalIndicator.shouldFormatBigNumber\r\n\r\n  const values = []\r\n  let name = ''\r\n  let calcParamText = ''\r\n  if (plots.length > 0) {\r\n    name = technicalIndicator.name\r\n  }\r\n  if (calcParams.length > 0) {\r\n    const params = calcParams.map(param => {\r\n      if (isObject(param)) {\r\n        return param.value\r\n      }\r\n      return param\r\n    })\r\n    calcParamText = `(${params.join(',')})`\r\n  }\r\n  plots.forEach(plot => {\r\n    const data = {}\r\n    if (isValid(plot.title)) {\r\n      let value = technicalIndicatorData[plot.key]\r\n      if (isValid(value)) {\r\n        value = formatPrecision(value, precision)\r\n        if (shouldFormatBigNumber) {\r\n          value = formatBigNumber(value)\r\n        }\r\n      }\r\n      data.title = plot.title\r\n      data.value = value\r\n    }\r\n    values.push(data)\r\n  })\r\n  return { values, name, calcParamText }\r\n}\r\n\r\nexport default class TechnicalIndicatorStore {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n    // 指标模板\r\n    this._templates = this._createTemplates()\r\n    this._instances = new Map()\r\n  }\r\n\r\n  /**\r\n   * 获取指标信息\r\n   * @param tech\r\n   * @return {{ calcParams, series, precision, name, shouldCheckParamCount, shouldOhlc, shouldFormatBigNumber, styles }}\r\n   */\r\n  _createTechInfo (tech) {\r\n    return {\r\n      name: tech.name,\r\n      series: tech.series,\r\n      calcParams: tech.calcParams,\r\n      shouldCheckParamCount: tech.shouldCheckParamCount,\r\n      shouldOhlc: tech.shouldOhlc,\r\n      shouldFormatBigNumber: tech.shouldFormatBigNumber,\r\n      precision: tech.precision,\r\n      styles: tech.styles,\r\n      result: tech.result || []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建技术指标模板\r\n   * @return {{}}\r\n   */\r\n  _createTemplates () {\r\n    const mapping = {}\r\n    const extensions = extension.technicalIndicatorExtensions\r\n    for (const name in extensions) {\r\n      const templateInstance = this._createTemplateInstance(extensions[name])\r\n      if (templateInstance) {\r\n        mapping[name] = templateInstance\r\n      }\r\n    }\r\n    return mapping\r\n  }\r\n\r\n  /**\r\n   * 创建一个新的技术指标\r\n   * @param name\r\n   * @param series\r\n   * @param calcParams\r\n   * @param plots\r\n   * @param precision\r\n   * @param shouldCheckParamCount\r\n   * @param shouldOhlc\r\n   * @param shouldFormatBigNumber\r\n   * @param minValue\r\n   * @param maxValue\r\n   * @param styles\r\n   * @param calcTechnicalIndicator\r\n   * @param regeneratePlots\r\n   * @param render\r\n   * @returns {templateInstance|null}\r\n   */\r\n  _createTemplateInstance ({\r\n    name, series, calcParams, plots, precision,\r\n    shouldCheckParamCount, shouldOhlc, shouldFormatBigNumber,\r\n    minValue, maxValue, styles,\r\n    calcTechnicalIndicator, regeneratePlots, render\r\n  }) {\r\n    if (!name || !isFunction(calcTechnicalIndicator)) {\r\n      logWarn('', '', 'The required attribute \"name\" and method \"calcTechnicalIndicator\" are missing, and new technical indicator cannot be generated!!!')\r\n      return null\r\n    }\r\n    class Template extends TechnicalIndicator {\r\n      constructor () {\r\n        super(\r\n          {\r\n            name,\r\n            series,\r\n            calcParams,\r\n            plots,\r\n            precision,\r\n            shouldCheckParamCount,\r\n            shouldOhlc,\r\n            shouldFormatBigNumber,\r\n            minValue,\r\n            maxValue,\r\n            styles\r\n          }\r\n        )\r\n      }\r\n    }\r\n    Template.prototype.calcTechnicalIndicator = calcTechnicalIndicator\r\n    if (isFunction(regeneratePlots)) {\r\n      Template.prototype.regeneratePlots = regeneratePlots\r\n    }\r\n    if (isFunction(render)) {\r\n      Template.prototype.render = render\r\n    }\r\n    return new Template()\r\n  }\r\n\r\n  /**\r\n   * 添加指标模板\r\n   * @param templates\r\n   */\r\n  addTemplate (templates) {\r\n    templates.forEach(tmp => {\r\n      const instance = this._createTemplateInstance(tmp || {})\r\n      if (instance) {\r\n        // 将生成的新的指标类放入集合\r\n        this._templates[instance.name] = instance\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 模板是否存在\r\n   * @param {*} name\r\n   * @returns\r\n   */\r\n  hasTemplate (name) {\r\n    return !!this._templates[name]\r\n  }\r\n\r\n  /**\r\n   * 获取技术指标模板信息\r\n   * @param name\r\n   * @return {{}|{calcParams: *, precision: *, name: *}}\r\n   */\r\n  getTemplateInfo (name) {\r\n    if (isValid(name)) {\r\n      const template = this._templates[name]\r\n      if (template) {\r\n        return this._createTechInfo(template)\r\n      }\r\n    } else {\r\n      const templateInfos = {}\r\n      for (const name in this._templates) {\r\n        const template = this._templates[name]\r\n        templateInfos[name] = this._createTechInfo(template)\r\n      }\r\n      return templateInfos\r\n    }\r\n    return {}\r\n  }\r\n\r\n  /**\r\n   * 添加技术指标实例\r\n   * @param paneId\r\n   * @param tech\r\n   * @param isStack\r\n   * @returns\r\n   */\r\n  addInstance (paneId, tech, isStack) {\r\n    if (tech) {\r\n      const { name, calcParams, precision, shouldOhlc, shouldFormatBigNumber, styles } = tech\r\n      let paneInstances = this._instances.get(paneId)\r\n      if (paneInstances && paneInstances.has(name)) {\r\n        return false\r\n      }\r\n      if (!paneInstances) {\r\n        paneInstances = new Map()\r\n        this._instances.set(paneId, paneInstances)\r\n      }\r\n      const template = this._templates[name]\r\n      let instance\r\n      if (template) {\r\n        instance = Object.create(Object.getPrototypeOf(template))\r\n        for (const key in template) {\r\n          if (Object.prototype.hasOwnProperty.call(template, key)) {\r\n            instance[key] = template[key]\r\n          }\r\n        }\r\n      }\r\n      if (instance) {\r\n        instance.setCalcParams(calcParams)\r\n        instance.setPrecision(precision)\r\n        instance.setShouldOhlc(shouldOhlc)\r\n        instance.setShouldFormatBigNumber(shouldFormatBigNumber)\r\n        instance.setStyles(styles, this._chartData.styleOptions().technicalIndicator)\r\n        if (!isStack) {\r\n          paneInstances.clear()\r\n        }\r\n        paneInstances.set(name, instance)\r\n        instance.calc(this._chartData.dataList())\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 获取实例\r\n   * @param {*} paneId\r\n   * @returns\r\n   */\r\n  instances (paneId) {\r\n    return this._instances.get(paneId) || new Map()\r\n  }\r\n\r\n  /**\r\n   * 移除技术指标\r\n   * @param paneId\r\n   * @param name\r\n   * @return {boolean}\r\n   */\r\n  removeInstance (paneId, name) {\r\n    let removed = false\r\n    if (this._instances.has(paneId)) {\r\n      const paneInstances = this._instances.get(paneId)\r\n      if (isValid(name)) {\r\n        if (paneInstances.has(name)) {\r\n          paneInstances.delete(name)\r\n          removed = true\r\n        }\r\n      } else {\r\n        paneInstances.clear()\r\n        removed = true\r\n      }\r\n      if (paneInstances.size === 0) {\r\n        this._instances.delete(paneId)\r\n      }\r\n    }\r\n    return removed\r\n  }\r\n\r\n  /**\r\n   * 是否有实例\r\n   * @param paneId\r\n   * @returns\r\n   */\r\n  hasInstance (paneId) {\r\n    return this._instances.has(paneId)\r\n  }\r\n\r\n  /**\r\n   * 实例计算\r\n   * @param paneId\r\n   * @param name\r\n   */\r\n  calcInstance (name, paneId) {\r\n    let calcSuccess = false\r\n    if (isValid(name)) {\r\n      if (isValid(paneId)) {\r\n        const paneInstances = this._instances.get(paneId)\r\n        if (paneInstances && paneInstances.has(name)) {\r\n          paneInstances.get(name).calc(this._chartData.dataList())\r\n          calcSuccess = true\r\n        }\r\n      } else {\r\n        this._instances.forEach(paneInstances => {\r\n          if (paneInstances.has(name)) {\r\n            paneInstances.get(name).calc(this._chartData.dataList())\r\n            calcSuccess = true\r\n          }\r\n        })\r\n      }\r\n    } else {\r\n      this._instances.forEach(paneInstances => {\r\n        paneInstances.forEach(instance => {\r\n          instance.calc(this._chartData.dataList())\r\n          calcSuccess = true\r\n        })\r\n      })\r\n    }\r\n    return calcSuccess\r\n  }\r\n\r\n  /**\r\n   * 获取实例信息\r\n   * @param paneId\r\n   * @param name\r\n   * @returns\r\n   */\r\n  getInstanceInfo (paneId, name) {\r\n    const info = (paneInstances) => {\r\n      const instanceInfos = []\r\n      for (const entry of paneInstances) {\r\n        const instance = entry[1]\r\n        if (instance) {\r\n          const instanceInfo = this._createTechInfo(instance)\r\n          if (instance.name === name) {\r\n            return instanceInfo\r\n          }\r\n          instanceInfos.push(instanceInfo)\r\n        }\r\n      }\r\n      return instanceInfos\r\n    }\r\n\r\n    if (isValid(paneId)) {\r\n      if (this._instances.has(paneId)) {\r\n        return info(this._instances.get(paneId))\r\n      }\r\n    } else {\r\n      const infos = {}\r\n      this._instances.forEach((paneInstance, paneId) => {\r\n        infos[paneId] = info(paneInstance)\r\n      })\r\n      return infos\r\n    }\r\n    return {}\r\n  }\r\n\r\n  /**\r\n   * 设置系列精度\r\n   * @param pricePrecision\r\n   * @param volumePrecision\r\n   */\r\n  setSeriesPrecision (pricePrecision, volumePrecision) {\r\n    const setPrecision = (tech) => {\r\n      if (tech.series === TechnicalIndicatorSeries.PRICE) {\r\n        tech.setPrecision(pricePrecision, true)\r\n      }\r\n      if (tech.series === TechnicalIndicatorSeries.VOLUME) {\r\n        tech.setPrecision(volumePrecision, true)\r\n      }\r\n    }\r\n    for (const key in this._templates) {\r\n      setPrecision(this._templates[key])\r\n    }\r\n    this._instances.forEach(paneInstances => {\r\n      paneInstances.forEach(instance => {\r\n        setPrecision(instance)\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 覆盖\r\n   * @param techOverride\r\n   * @param paneId\r\n   * @returns\r\n   */\r\n  override (techOverride, paneId) {\r\n    const { name, calcParams, precision, shouldOhlc, shouldFormatBigNumber, styles } = techOverride\r\n    const defaultTechStyleOptions = this._chartData.styleOptions().technicalIndicator\r\n    let instances = new Map()\r\n    if (isValid(paneId)) {\r\n      if (this._instances.has(paneId)) {\r\n        instances.set(paneId, this._instances.get(paneId))\r\n      }\r\n    } else {\r\n      instances = this._instances\r\n      const template = this._templates[name]\r\n      if (template) {\r\n        template.setCalcParams(calcParams)\r\n        template.setPrecision(precision)\r\n        template.setShouldOhlc(shouldOhlc)\r\n        template.setShouldFormatBigNumber(shouldFormatBigNumber)\r\n        template.setStyles(styles, defaultTechStyleOptions)\r\n      }\r\n    }\r\n    let overiderSuccss = false\r\n    const tasks = []\r\n    instances.forEach(paneInstances => {\r\n      if (paneInstances.has(name)) {\r\n        const tech = paneInstances.get(name)\r\n        const calcParamsSuccess = tech.setCalcParams(calcParams)\r\n        const precisionSuccess = tech.setPrecision(precision)\r\n        const shouldOhlcSuccess = tech.setShouldOhlc(shouldOhlc)\r\n        const shouldFormatBigNumberSuccess = tech.setShouldFormatBigNumber(shouldFormatBigNumber)\r\n        const styleSuccess = tech.setStyles(styles, defaultTechStyleOptions)\r\n        if (calcParamsSuccess || precisionSuccess || shouldOhlcSuccess || shouldFormatBigNumberSuccess || styleSuccess) {\r\n          overiderSuccss = true\r\n        }\r\n        if (calcParamsSuccess) {\r\n          tasks.push(\r\n            Promise.resolve(tech.calc(this._chartData.dataList()))\r\n          )\r\n        }\r\n      }\r\n    })\r\n    if (overiderSuccss) {\r\n      return Promise.all(tasks)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isFunction, isObject, clone, merge } from '../../utils/typeChecks'\r\n\r\n/**\r\n * 完善覆盖物实例\r\n * @param overlay 覆盖物实例\r\n * @param options 参数\r\n */\r\nexport function perfectOverlayFunc (overlay, funcs) {\r\n  funcs.forEach(({ key, fn }) => {\r\n    if (isFunction(fn)) {\r\n      overlay[key] = fn\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * 覆盖物\r\n */\r\nexport default class Overlay {\r\n  constructor ({\r\n    id, chartData, xAxis, yAxis\r\n  }) {\r\n    this._id = id\r\n    this._chartData = chartData\r\n    this._xAxis = xAxis\r\n    this._yAxis = yAxis\r\n    this._styles = null\r\n  }\r\n\r\n  /**\r\n   * 绘制\r\n   * @param ctx\r\n   */\r\n  draw (ctx) {}\r\n\r\n  /**\r\n   * 设置样式\r\n   * @param styles\r\n   * @param defaultStyles\r\n   */\r\n  setStyles (styles, defaultStyles) {\r\n    if (!isObject(styles)) {\r\n      return false\r\n    }\r\n    if (!this._styles) {\r\n      this._styles = clone(defaultStyles)\r\n    }\r\n    merge(this._styles, styles)\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 获取id\r\n   * @return {*}\r\n   */\r\n  id () {\r\n    return this._id\r\n  }\r\n\r\n  /**\r\n   * 获取样式\r\n   * @return {null}\r\n   */\r\n  styles () {\r\n    return this._styles\r\n  }\r\n\r\n  /**\r\n   * 设置y轴\r\n   * @param yAxis\r\n   */\r\n  setYAxis (yAxis) {\r\n    if (yAxis) {\r\n      this._yAxis = yAxis\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查鼠标点是否在图形上\r\n   * @param coordinate\r\n   */\r\n  checkEventCoordinateOn (coordinate) {}\r\n\r\n  // -------------------- 事件开始 -------------------\r\n\r\n  /**\r\n   * 点击事件\r\n   * @param id\r\n   * @param points\r\n   * @param event\r\n   */\r\n  onClick ({ id, points, event }) {}\r\n\r\n  /**\r\n   * 右击事件\r\n   * @param id\r\n   * @param points\r\n   * @param event\r\n   */\r\n  onRightClick ({ id, points, event }) {}\r\n\r\n  /**\r\n   * 鼠标进入事件\r\n   * @param id\r\n   * @param points\r\n   * @param event\r\n   */\r\n  onMouseEnter ({ id, points, event }) {}\r\n\r\n  /**\r\n   * 鼠标离开事件\r\n   * @param id\r\n   * @param points\r\n   * @param event\r\n   */\r\n  onMouseLeave ({ id, points, event }) {}\r\n\r\n  // -------------------- 事件结束 -------------------\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 绘制边框圆\r\n * @param ctx\r\n * @param borderColor\r\n * @param borderSize\r\n * @param circleCoordinate\r\n * @param radius\r\n */\r\nexport function renderStrokeCircle (ctx, borderColor, borderSize, circleCoordinate, radius) {\r\n  ctx.lineWidth = borderSize\r\n  ctx.strokeStyle = borderColor\r\n  ctx.beginPath()\r\n  ctx.arc(circleCoordinate.x, circleCoordinate.y, radius, 0, Math.PI * 2)\r\n  ctx.closePath()\r\n  ctx.stroke()\r\n}\r\n\r\n/**\r\n * 绘制实心圆\r\n * @param ctx\r\n * @param fillColor\r\n * @param circleCoordinate\r\n * @param radius\r\n */\r\nexport function renderFillCircle (ctx, fillColor, circleCoordinate, radius) {\r\n  ctx.fillStyle = fillColor\r\n  ctx.beginPath()\r\n  ctx.arc(circleCoordinate.x, circleCoordinate.y, radius, 0, Math.PI * 2)\r\n  ctx.closePath()\r\n  ctx.fill()\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport const DEVIATION = 2\r\n\r\n/**\r\n * 获取两点之间的距离\r\n * @param coordinate\r\n * @param coordinate2\r\n * @return {number}\r\n */\r\nexport function getDistance (coordinate1, coordinate2) {\r\n  const xDif = coordinate1.x - coordinate2.x\r\n  const yDif = coordinate1.y - coordinate2.y\r\n  return Math.sqrt(xDif * xDif + yDif * yDif)\r\n}\r\n\r\n/**\r\n * 根据三角形三个点获取三角形面积\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param coordinate3\r\n * @return {number}\r\n */\r\nexport function getTriangleSquare (coordinate1, coordinate2, coordinate3) {\r\n  const x1 = Math.abs(coordinate2.x - coordinate1.x)\r\n  const y1 = Math.abs(coordinate2.y - coordinate1.y)\r\n  const x2 = Math.abs(coordinate3.x - coordinate1.x)\r\n  const y2 = Math.abs(coordinate3.y - coordinate1.y)\r\n  return Math.abs(x1 * y2 - x2 * y1) / 2\r\n}\r\n\r\n/**\r\n * 获取一点绕另一点旋转一定角度后新的点坐标\r\n * @param coordinate 旋转点\r\n * @param targetCoordinate 参照点\r\n * @param angle 角度\r\n * @return {{x: *, y: *}}\r\n */\r\nexport function getRotateCoordinate (coordinate, targetCoordinate, angle) {\r\n  const x = (coordinate.x - targetCoordinate.x) * Math.cos(angle) - (coordinate.y - targetCoordinate.y) * Math.sin(angle) + targetCoordinate.x\r\n  const y = (coordinate.x - targetCoordinate.x) * Math.sin(angle) + (coordinate.y - targetCoordinate.y) * Math.cos(angle) + targetCoordinate.y\r\n  return { x, y }\r\n}\r\n\r\n/**\r\n * 获取一次函数斜率和截距，即 y = kx + b 中的k值和b值\r\n * @param coordinate1\r\n * @param coordinate2\r\n */\r\nexport function getLinearSlopeIntercept (coordinate1, coordinate2) {\r\n  const difX = (coordinate1.x - coordinate2.x)\r\n  if (difX !== 0) {\r\n    const k = (coordinate1.y - coordinate2.y) / difX\r\n    const b = coordinate1.y - k * coordinate1.x\r\n    return { k, b }\r\n  }\r\n}\r\n\r\n/**\r\n * 获取点在两点决定的一次函数上的y值\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param targetCoordinate\r\n */\r\nexport function getLinearYFromCoordinates (coordinate1, coordinate2, targetCoordinate) {\r\n  const kb = getLinearSlopeIntercept(coordinate1, coordinate2)\r\n  return getLinearYFromSlopeIntercept(kb, targetCoordinate)\r\n}\r\n\r\n/**\r\n * 获取点在斜率和截距确定的线上的y值\r\n * @param kb\r\n * @param targetCoordinate\r\n */\r\nexport function getLinearYFromSlopeIntercept (kb, targetCoordinate) {\r\n  if (kb) {\r\n    return targetCoordinate.x * kb.k + kb.b\r\n  }\r\n  return targetCoordinate.y\r\n}\r\n\r\n/**\r\n * 点是否在线上\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param targetCoordinate\r\n */\r\nexport function checkCoordinateOnStraightLine (coordinate1, coordinate2, targetCoordinate) {\r\n  if (!targetCoordinate || !coordinate1 || !coordinate2) {\r\n    return false\r\n  }\r\n  if (coordinate1.x === coordinate2.x) {\r\n    return Math.abs(targetCoordinate.x - coordinate1.x) < DEVIATION\r\n  }\r\n  const kb = getLinearSlopeIntercept(coordinate1, coordinate2)\r\n  const y = getLinearYFromSlopeIntercept(kb, targetCoordinate)\r\n  const yDif = Math.abs(y - targetCoordinate.y)\r\n  return yDif * yDif / (kb.k * kb.k + 1) < DEVIATION * DEVIATION\r\n}\r\n\r\n/**\r\n * 点是否在线段上\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param targetCoordinate\r\n * @returns {boolean}\r\n */\r\nexport function checkCoordinateOnRayLine (coordinate1, coordinate2, targetCoordinate) {\r\n  if (checkCoordinateOnStraightLine(coordinate1, coordinate2, targetCoordinate)) {\r\n    if (coordinate1.x === coordinate2.x) {\r\n      if (coordinate1.y < coordinate2.y) {\r\n        return coordinate1.y - targetCoordinate.y < DEVIATION\r\n      } else {\r\n        return targetCoordinate.y - coordinate1.y < DEVIATION\r\n      }\r\n    }\r\n    if (coordinate1.x < coordinate2.x) {\r\n      return coordinate1.x - targetCoordinate.x < DEVIATION\r\n    } else {\r\n      return targetCoordinate.x - coordinate1.x < DEVIATION\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\n/**\r\n * 判断点是否在线段上面\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param targetCoordinate\r\n */\r\nexport function checkCoordinateOnSegment (coordinate1, coordinate2, targetCoordinate) {\r\n  if (checkCoordinateOnStraightLine(coordinate1, coordinate2, targetCoordinate)) {\r\n    if (coordinate1.x === coordinate2.x) {\r\n      return Math.abs(coordinate1.y - targetCoordinate.y) + Math.abs(coordinate2.y - targetCoordinate.y) - Math.abs(coordinate1.y - coordinate2.y) < DEVIATION * 2\r\n    }\r\n    return Math.abs(coordinate1.x - targetCoordinate.x) + Math.abs(coordinate2.x - targetCoordinate.x) - Math.abs(coordinate1.x - coordinate2.x) < DEVIATION * 2\r\n  }\r\n  return false\r\n}\r\n\r\n/**\r\n * 点是否在圆内\r\n * @param circleCenterCoordinate\r\n * @param radius\r\n * @param targetCoordinate\r\n * @returns {boolean}\r\n */\r\nexport function checkCoordinateInCircle (circleCenterCoordinate, radius, targetCoordinate) {\r\n  if (!targetCoordinate) {\r\n    return false\r\n  }\r\n  const difX = targetCoordinate.x - circleCenterCoordinate.x\r\n  const difY = targetCoordinate.y - circleCenterCoordinate.y\r\n  return !(difX * difX + difY * difY > radius * radius)\r\n}\r\n\r\n/**\r\n * 点是否在圆上\r\n * @param circleCenterCoordinate\r\n * @param radius\r\n * @param targetCoordinate\r\n * @return {boolean}\r\n */\r\nexport function checkCoordinateOnCircle (circleCenterCoordinate, radius, targetCoordinate) {\r\n  if (!targetCoordinate) {\r\n    return false\r\n  }\r\n  return Math.abs(getDistance(targetCoordinate, circleCenterCoordinate) - radius) < DEVIATION\r\n}\r\n\r\n/**\r\n * 检查点是否在圆弧上\r\n * @param circleCenterCoordinate\r\n * @param radius\r\n * @param startAngle\r\n * @param endAngle\r\n * @param targetCoordinate\r\n * @return {boolean}\r\n */\r\nexport function checkCoordinateOnArc (circleCenterCoordinate, radius, startAngle, endAngle, targetCoordinate) {\r\n  if (checkCoordinateOnCircle(circleCenterCoordinate, radius, targetCoordinate)) {\r\n    const startCoordinateX = radius * Math.cos(startAngle) + circleCenterCoordinate.x\r\n    const startCoordinateY = radius * Math.sin(startAngle) + circleCenterCoordinate.y\r\n    const endCoordinateX = radius * Math.cos(endAngle) + circleCenterCoordinate.x\r\n    const endCoordinateY = radius * Math.sin(endAngle) + circleCenterCoordinate.y\r\n    return (\r\n      targetCoordinate.x <= Math.max(startCoordinateX, endCoordinateX) + DEVIATION &&\r\n      targetCoordinate.x >= Math.min(startCoordinateX, endCoordinateX) - DEVIATION &&\r\n      targetCoordinate.y <= Math.max(startCoordinateY, endCoordinateY) + DEVIATION &&\r\n      targetCoordinate.y >= Math.min(startCoordinateY, endCoordinateY) - DEVIATION\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * 检查点是否在三角形内部\r\n * @param triangleCoordinates\r\n * @param targetCoordinate\r\n * @return {boolean}\r\n */\r\nexport function checkCoordinateInTriangle (triangleCoordinates, targetCoordinate) {\r\n  const square = getTriangleSquare(triangleCoordinates[0], triangleCoordinates[1], triangleCoordinates[2])\r\n  const compareSquare =\r\n    getTriangleSquare(triangleCoordinates[0], triangleCoordinates[1], targetCoordinate) +\r\n    getTriangleSquare(triangleCoordinates[0], triangleCoordinates[2], targetCoordinate) +\r\n    getTriangleSquare(triangleCoordinates[1], triangleCoordinates[2], targetCoordinate)\r\n  return Math.abs(square - compareSquare) < DEVIATION\r\n}\r\n\r\n/**\r\n * 检查点是否在三角形菱形内部\r\n * @param centerCoordinate\r\n * @param width\r\n * @param height\r\n * @param targetCoordinate\r\n * @return {boolean}\r\n */\r\nexport function checkCoordinateInDiamond (centerCoordinate, width, height, targetCoordinate) {\r\n  const xDis = Math.abs(centerCoordinate.x - targetCoordinate.x)\r\n  const yDis = Math.abs(centerCoordinate.y - targetCoordinate.y)\r\n  return xDis * height + yDis * width < width * height / 2 + DEVIATION\r\n}\r\n\r\n/**\r\n * 检查点是否在矩形内部\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param targetCoordinate\r\n * @return {boolean}\r\n */\r\nexport function checkCoordinateInRect (coordinate1, coordinate2, targetCoordinate) {\r\n  return targetCoordinate.x >= coordinate1.x && targetCoordinate.x <= coordinate2.x && targetCoordinate.y >= coordinate1.y && targetCoordinate.y <= coordinate2.y\r\n}\r\n\r\n/**\r\n * 根据两点获取一条射线\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @param xyMax\r\n * @return {(*|{x: *, y: *})[]|*[]}\r\n */\r\nexport function getRayLine (coordinate1, coordinate2, xyMax) {\r\n  if (coordinate1 && coordinate2) {\r\n    let coordinate\r\n    if (coordinate1.x === coordinate2.x && coordinate1.y !== coordinate2.y) {\r\n      if (coordinate1.y < coordinate2.y) {\r\n        coordinate = {\r\n          x: coordinate1.x,\r\n          y: xyMax.y\r\n        }\r\n      } else {\r\n        coordinate = {\r\n          x: coordinate1.x,\r\n          y: 0\r\n        }\r\n      }\r\n    } else if (coordinate1.x > coordinate2.x) {\r\n      coordinate = {\r\n        x: 0,\r\n        y: getLinearYFromCoordinates(coordinate1, coordinate2, { x: 0, y: coordinate1.y })\r\n      }\r\n    } else {\r\n      coordinate = {\r\n        x: xyMax.x,\r\n        y: getLinearYFromCoordinates(coordinate1, coordinate2, { x: xyMax.x, y: coordinate1.y })\r\n      }\r\n    }\r\n    return [coordinate1, coordinate]\r\n  }\r\n  return []\r\n}\r\n\r\n/**\r\n * 获取平行线\r\n * @param coordinates\r\n * @param xyMax\r\n * @param extendParallelLineCount\r\n * @returns {Array}\r\n */\r\nexport function getParallelLines (coordinates, xyMax, extendParallelLineCount = 0) {\r\n  const lines = []\r\n  if (coordinates.length > 1) {\r\n    if (coordinates[0].x === coordinates[1].x) {\r\n      const startY = 0\r\n      const endY = xyMax.y\r\n      lines.push([{ x: coordinates[0].x, y: startY }, { x: coordinates[0].x, y: endY }])\r\n      if (coordinates.length > 2) {\r\n        lines.push([{ x: coordinates[2].x, y: startY }, { x: coordinates[2].x, y: endY }])\r\n        const distance = coordinates[0].x - coordinates[2].x\r\n        for (let i = 0; i < extendParallelLineCount; i++) {\r\n          const d = distance * (i + 1)\r\n          lines.push([{ x: coordinates[0].x + d, y: startY }, { x: coordinates[0].x + d, y: endY }])\r\n        }\r\n      }\r\n    } else {\r\n      const startX = 0\r\n      const endX = xyMax.x\r\n      const kb = getLinearSlopeIntercept(coordinates[0], coordinates[1])\r\n      const k = kb.k\r\n      const b = kb.b\r\n      lines.push([{ x: startX, y: startX * k + b }, { x: endX, y: endX * k + b }])\r\n      if (coordinates.length > 2) {\r\n        const b1 = coordinates[2].y - k * coordinates[2].x\r\n        lines.push([{ x: startX, y: startX * k + b1 }, { x: endX, y: endX * k + b1 }])\r\n        const distance = b - b1\r\n        for (let i = 0; i < extendParallelLineCount; i++) {\r\n          const b2 = b + distance * (i + 1)\r\n          lines.push([{ x: startX, y: startX * k + b2 }, { x: endX, y: endX * k + b2 }])\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return lines\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 绘制路径\r\n * @param ctx\r\n * @param coordinates\r\n * @param strokeFill\r\n */\r\nfunction renderPath (ctx, coordinates, strokeFill) {\r\n  ctx.save()\r\n  if (ctx.lineWidth % 2) {\r\n    ctx.translate(0.5, 0.5)\r\n  }\r\n  ctx.beginPath()\r\n  let move = true\r\n  coordinates.forEach(coordinate => {\r\n    if (coordinate) {\r\n      if (move) {\r\n        ctx.moveTo(coordinate.x, coordinate.y)\r\n        move = false\r\n      } else {\r\n        ctx.lineTo(coordinate.x, coordinate.y)\r\n      }\r\n    }\r\n  })\r\n  strokeFill()\r\n  ctx.restore()\r\n}\r\n\r\n/**\r\n * 渲染边框路径\r\n * @param ctx\r\n * @param coordinates\r\n */\r\nexport function renderStrokePath (ctx, coordinates) {\r\n  renderPath(ctx, coordinates, () => {\r\n    ctx.stroke()\r\n    ctx.closePath()\r\n  })\r\n}\r\n\r\n/**\r\n * 渲染填充路径\r\n * @param ctx\r\n * @param coordinates\r\n */\r\nexport function renderFillPath (ctx, coordinates) {\r\n  renderPath(ctx, coordinates, () => {\r\n    ctx.closePath()\r\n    ctx.fill()\r\n  })\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { renderStrokePath } from './path'\r\n\r\n/**\r\n * 绘制水平直线\r\n * @param ctx\r\n * @param y\r\n * @param left\r\n * @param right\r\n */\r\nexport function renderHorizontalLine (ctx, y, left, right) {\r\n  ctx.beginPath()\r\n  const correction = (ctx.lineWidth % 2) ? 0.5 : 0\r\n  ctx.moveTo(left, y + correction)\r\n  ctx.lineTo(right, y + correction)\r\n  ctx.stroke()\r\n  ctx.closePath()\r\n}\r\n\r\n/**\r\n * 绘制垂直直线\r\n * @param ctx\r\n * @param x\r\n * @param top\r\n * @param bottom\r\n */\r\nexport function renderVerticalLine (ctx, x, top, bottom) {\r\n  ctx.beginPath()\r\n  const correction = (ctx.lineWidth % 2) ? 0.5 : 0\r\n  ctx.moveTo(x + correction, top)\r\n  ctx.lineTo(x + correction, bottom)\r\n  ctx.stroke()\r\n  ctx.closePath()\r\n}\r\n\r\n/**\r\n * 绘制线\r\n * @param ctx\r\n * @param coordinates\r\n */\r\nexport function renderLine (ctx, coordinates) {\r\n  renderStrokePath(ctx, coordinates)\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 获取屏幕比\r\n * @param canvas\r\n * @returns {number}\r\n */\r\nexport function getPixelRatio (canvas) {\r\n  return (canvas.ownerDocument && canvas.ownerDocument.defaultView && canvas.ownerDocument.defaultView.devicePixelRatio) || 2\r\n}\r\n\r\n/**\r\n * 测量文字的宽度\r\n * @param ctx\r\n * @param text\r\n * @returns {number}\r\n */\r\nexport function calcTextWidth (ctx, text) {\r\n  return Math.round(ctx.measureText(text).width)\r\n}\r\n\r\n/**\r\n * 创建字体\r\n * @param fontSize\r\n * @param fontFamily\r\n * @param fontWeight\r\n * @returns {string}\r\n */\r\nexport function createFont (fontSize = 12, fontWeight = 'normal', fontFamily = 'Helvetica Neue') {\r\n  return `${fontWeight} ${fontSize}px ${fontFamily}`\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Overlay from './Overlay'\r\n\r\nimport { renderFillCircle } from '../../renderer/circle'\r\nimport { checkCoordinateInCircle } from '../../extension/shape/shapeHelper'\r\nimport { renderHorizontalLine, renderLine, renderVerticalLine } from '../../renderer/line'\r\nimport { renderStrokePath, renderFillPath } from '../../renderer/path'\r\nimport { isArray, isValid, clone } from '../../utils/typeChecks'\r\nimport { createFont } from '../../utils/canvas'\r\n\r\nimport { StrokeFillStyle, LineStyle } from '../../options/styleOptions'\r\n\r\n// 标记图形绘制步骤开始\r\nconst SHAPE_DRAW_STEP_START = 1\r\n\r\n// 标记图形绘制步骤结束\r\nconst SHAPE_DRAW_STEP_FINISHED = -1\r\n\r\n/**\r\n * 图形标记鼠标操作元素类型\r\n * @type {{OTHER: string, POINT: string, NONE: string}}\r\n */\r\nexport const ShapeMouseOperateElement = {\r\n  OTHER: 'other',\r\n  POINT: 'point',\r\n  NONE: 'none'\r\n}\r\n\r\n/**\r\n * 绘制类型\r\n * @type {{ARC: string, POLYGON: string, LINE: string, CONTINUOUS_LINE: string, TEXT: string}}\r\n */\r\nconst ShapeElementType = {\r\n  LINE: 'line',\r\n  TEXT: 'text',\r\n  CONTINUOUS_LINE: 'continuous_line',\r\n  POLYGON: 'polygon',\r\n  ARC: 'arc'\r\n}\r\n\r\n/**\r\n * 线类型\r\n * @type {{VERTICAL: number, COMMON: number, HORIZONTAL: number}}\r\n */\r\nconst LineType = {\r\n  COMMON: 0,\r\n  HORIZONTAL: 1,\r\n  VERTICAL: 2\r\n}\r\n\r\n/**\r\n * 图形模式\r\n */\r\nconst ShapeMode = {\r\n  NORMAL: 'normal',\r\n  WEAK_MAGNET: 'weak_magnet',\r\n  STRONG_MAGNET: 'strong_magnet'\r\n}\r\n\r\n/**\r\n * 获取绘制线类型\r\n * @param coordinate1\r\n * @param coordinate2\r\n * @private\r\n */\r\nfunction getLineType (coordinate1, coordinate2) {\r\n  if (coordinate1.x === coordinate2.x) {\r\n    return LineType.VERTICAL\r\n  }\r\n  if (coordinate1.y === coordinate2.y) {\r\n    return LineType.HORIZONTAL\r\n  }\r\n  return LineType.COMMON\r\n}\r\n\r\n/**\r\n * 标记图形\r\n */\r\nexport default class Shape extends Overlay {\r\n  constructor ({\r\n    id, name, totalStep,\r\n    chartData, xAxis, yAxis,\r\n    points, styles, lock, data\r\n  }) {\r\n    super({ id, chartData, xAxis, yAxis })\r\n    this._name = name\r\n    this._totalStep = totalStep\r\n    this._lock = lock\r\n    this._mode = ShapeMode.NORMAL\r\n    this._data = data\r\n    this._drawStep = SHAPE_DRAW_STEP_START\r\n    this._points = []\r\n    this.setPoints(points)\r\n    this.setStyles(styles, chartData.styleOptions().shape)\r\n    this._prevPressPoint = null\r\n    this._prevPoints = null\r\n    this._coordinates = []\r\n  }\r\n\r\n  /**\r\n   * 加载点\r\n   * @param points\r\n   */\r\n  setPoints (points) {\r\n    if (isArray(points) && points.length > 0) {\r\n      let repeatTotalStep\r\n      if (points.length >= this._totalStep - 1) {\r\n        this._drawStep = SHAPE_DRAW_STEP_FINISHED\r\n        this._points = points.slice(0, this._totalStep - 1)\r\n        repeatTotalStep = this._totalStep - 1\r\n      } else {\r\n        this._drawStep = points.length + 1\r\n        this._points = clone(points)\r\n        repeatTotalStep = points.length\r\n      }\r\n      // 重新演练绘制一遍，防止因为点不对而绘制出错误的图形\r\n      for (let i = 0; i < repeatTotalStep; i++) {\r\n        this.performEventMoveForDrawing({\r\n          step: i + 2,\r\n          mode: this._mode,\r\n          points: this._points,\r\n          movePoint: this._points[i],\r\n          xAxis: this._xAxis,\r\n          yAxis: this._yAxis\r\n        })\r\n      }\r\n      if (this._drawStep === SHAPE_DRAW_STEP_FINISHED) {\r\n        this.performEventPressedMove({\r\n          mode: this._mode,\r\n          points: this._points,\r\n          pressPointIndex: this._points.length - 1,\r\n          pressPoint: this._points[this._points.length - 1],\r\n          xAxis: this._xAxis,\r\n          yAxis: this._yAxis\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 时间戳转换成x轴上点的位置\r\n   * @param point\r\n   * @return {*|number}\r\n   * @private\r\n   */\r\n  _timestampOrDataIndexToCoordinateX ({ timestamp, dataIndex }) {\r\n    if (timestamp) {\r\n      dataIndex = this._chartData.timeScaleStore().timestampToDataIndex(timestamp)\r\n    }\r\n    return this._xAxis.convertToPixel(dataIndex)\r\n  }\r\n\r\n  /**\r\n   * 绘制线\r\n   * @param ctx\r\n   * @param lines\r\n   * @param styles\r\n   * @param defaultStyles\r\n   * @private\r\n   */\r\n  _drawLines (ctx, lines, styles, defaultStyles) {\r\n    ctx.save()\r\n    ctx.strokeStyle = styles.color || defaultStyles.color\r\n    ctx.lineWidth = styles.size || defaultStyles.size\r\n    if (styles.style === LineStyle.DASH) {\r\n      ctx.setLineDash(styles.dashValue || defaultStyles.dashValue)\r\n    }\r\n    lines.forEach(coordinates => {\r\n      if (coordinates.length > 1) {\r\n        const lineType = getLineType(coordinates[0], coordinates[1])\r\n        switch (lineType) {\r\n          case LineType.COMMON: {\r\n            renderLine(ctx, coordinates)\r\n            break\r\n          }\r\n          case LineType.HORIZONTAL: {\r\n            renderHorizontalLine(ctx, coordinates[0].y, coordinates[0].x, coordinates[1].x)\r\n            break\r\n          }\r\n          case LineType.VERTICAL: {\r\n            renderVerticalLine(ctx, coordinates[0].x, coordinates[0].y, coordinates[1].y)\r\n            break\r\n          }\r\n          default: { break }\r\n        }\r\n      }\r\n    })\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制连续线\r\n   * @param ctx\r\n   * @param continuousLines\r\n   * @param styles\r\n   * @param styles\r\n   * @private\r\n   */\r\n  _drawContinuousLines (ctx, continuousLines, styles, defaultStyles) {\r\n    ctx.save()\r\n    ctx.strokeStyle = styles.color || defaultStyles.color\r\n    ctx.lineWidth = styles.size || defaultStyles.size\r\n    if (styles.style === LineStyle.DASH) {\r\n      ctx.setLineDash(styles.dashValue || defaultStyles.dashValue)\r\n    }\r\n    continuousLines.forEach(coordinates => {\r\n      if (coordinates.length > 0) {\r\n        renderLine(ctx, coordinates)\r\n      }\r\n    })\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制多边形\r\n   * @param ctx\r\n   * @param polygons\r\n   * @param styles\r\n   * @param defaultStyles\r\n   * @private\r\n   */\r\n  _drawPolygons (ctx, polygons, styles, defaultStyles) {\r\n    ctx.save()\r\n    let strokeFill\r\n    if (styles.style === StrokeFillStyle.FILL) {\r\n      ctx.fillStyle = (styles.fill || defaultStyles.fill).color\r\n      strokeFill = renderFillPath\r\n    } else {\r\n      const strokeStyles = styles.stroke || defaultStyles.stroke\r\n      if (strokeStyles.style === LineStyle.DASH) {\r\n        ctx.setLineDash(strokeStyles.dashValue)\r\n      }\r\n      ctx.lineWidth = strokeStyles.size\r\n      ctx.strokeStyle = strokeStyles.color\r\n      strokeFill = renderStrokePath\r\n    }\r\n    polygons.forEach(coordinates => {\r\n      if (coordinates.length > 0) {\r\n        strokeFill(ctx, coordinates)\r\n      }\r\n    })\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 画圆弧\r\n   * @param ctx\r\n   * @param arcs\r\n   * @param styles\r\n   * @param defaultStyles\r\n   * @private\r\n   */\r\n  _drawArcs (ctx, arcs, styles, defaultStyles) {\r\n    ctx.save()\r\n    if (styles.style === StrokeFillStyle.FILL) {\r\n      ctx.fillStyle = (styles.fill || defaultStyles.fill).color\r\n    } else {\r\n      const strokeStyles = styles.stroke || defaultStyles.stroke\r\n      if (strokeStyles.style === LineStyle.DASH) {\r\n        ctx.setLineDash(strokeStyles.dashValue)\r\n      }\r\n      ctx.lineWidth = strokeStyles.size\r\n      ctx.strokeStyle = strokeStyles.color\r\n    }\r\n    arcs.forEach(({ x, y, radius, startAngle, endAngle }) => {\r\n      ctx.beginPath()\r\n      ctx.arc(x, y, radius, startAngle, endAngle)\r\n      if (styles.style === StrokeFillStyle.FILL) {\r\n        ctx.closePath()\r\n        ctx.fill()\r\n      } else {\r\n        ctx.stroke()\r\n        ctx.closePath()\r\n      }\r\n    })\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制文字\r\n   * @param ctx\r\n   * @param texts\r\n   * @param styles\r\n   * @param defaultStyles\r\n   * @private\r\n   */\r\n  _drawText (ctx, texts, styles, defaultStyles) {\r\n    ctx.save()\r\n    let fillStroke\r\n    if (styles.style === StrokeFillStyle.STROKE) {\r\n      ctx.strokeStyle = styles.color || defaultStyles.color\r\n      fillStroke = ctx.strokeText\r\n    } else {\r\n      ctx.fillStyle = styles.color || defaultStyles.color\r\n      fillStroke = ctx.fillText\r\n    }\r\n    ctx.font = createFont(\r\n      styles.size || defaultStyles.size,\r\n      styles.family || defaultStyles.family,\r\n      styles.weight || defaultStyles.weight\r\n    )\r\n    const offset = styles.offset || defaultStyles.offset || [0, 0]\r\n    texts.forEach(({ x, y, text }) => {\r\n      fillStroke.call(\r\n        ctx,\r\n        text,\r\n        x + offset[1],\r\n        y + offset[0]\r\n      )\r\n    })\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制\r\n   * @param ctx\r\n   */\r\n  draw (ctx) {\r\n    this._coordinates = this._points.map(({ timestamp, value, dataIndex }) => {\r\n      return {\r\n        x: this._timestampOrDataIndexToCoordinateX({ timestamp, dataIndex }),\r\n        y: this._yAxis.convertToPixel(value)\r\n      }\r\n    })\r\n    const shapeOptions = this._styles || this._chartData.styleOptions().shape\r\n    if (this._drawStep !== SHAPE_DRAW_STEP_START && this._coordinates.length > 0) {\r\n      const viewport = { width: this._xAxis.width(), height: this._yAxis.height() }\r\n      const precision = { price: this._chartData.pricePrecision(), volume: this._chartData.volumePrecision() }\r\n      this._shapeDataSources = this.createShapeDataSource({\r\n        step: this._drawStep,\r\n        mode: this._mode,\r\n        points: this._points,\r\n        coordinates: this._coordinates,\r\n        viewport: { width: this._xAxis.width(), height: this._yAxis.height() },\r\n        precision: { price: this._chartData.pricePrecision(), volume: this._chartData.volumePrecision() },\r\n        styles: shapeOptions,\r\n        xAxis: this._xAxis,\r\n        yAxis: this._yAxis,\r\n        data: this._data\r\n      }) || []\r\n      this._shapeDataSources.forEach(({ type, isDraw, styles, dataSource = [] }) => {\r\n        if (isDraw) {\r\n          switch (type) {\r\n            case ShapeElementType.LINE: {\r\n              this._drawLines(ctx, dataSource, styles || shapeOptions.line, shapeOptions.line)\r\n              break\r\n            }\r\n            case ShapeElementType.CONTINUOUS_LINE: {\r\n              this._drawContinuousLines(ctx, dataSource, styles || shapeOptions.line, shapeOptions.line)\r\n              break\r\n            }\r\n            case ShapeElementType.POLYGON: {\r\n              this._drawPolygons(ctx, dataSource, styles || shapeOptions.polygon, shapeOptions.polygon)\r\n              break\r\n            }\r\n            case ShapeElementType.ARC: {\r\n              this._drawArcs(ctx, dataSource, styles || shapeOptions.arc, shapeOptions.arc)\r\n              break\r\n            }\r\n            case ShapeElementType.TEXT: {\r\n              this._drawText(ctx, dataSource, styles || shapeOptions.text, shapeOptions.text)\r\n              break\r\n            }\r\n            default: { break }\r\n          }\r\n        }\r\n      })\r\n      if (this.drawExtend) {\r\n        ctx.save()\r\n        this.drawExtend({\r\n          ctx,\r\n          dataSource: this._shapeDataSources,\r\n          styles: shapeOptions,\r\n          viewport,\r\n          precision,\r\n          mode: this._mode,\r\n          xAxis: this._xAxis,\r\n          yAxis: this._yAxis,\r\n          data: this._data\r\n        })\r\n        ctx.restore()\r\n      }\r\n    }\r\n    const shapeMouseOperate = this._chartData.shapeStore().mouseOperate()\r\n    if (\r\n      (shapeMouseOperate.hover.id === this._id && shapeMouseOperate.hover.element !== ShapeMouseOperateElement.NONE) ||\r\n      (shapeMouseOperate.click.id === this._id && shapeMouseOperate.click.element !== ShapeMouseOperateElement.NONE) ||\r\n      this.isDrawing()\r\n    ) {\r\n      this._coordinates.forEach(({ x, y }, index) => {\r\n        let radius = shapeOptions.point.radius\r\n        let color = shapeOptions.point.backgroundColor\r\n        let borderColor = shapeOptions.point.borderColor\r\n        let borderSize = shapeOptions.point.borderSize\r\n        if (\r\n          shapeMouseOperate.hover.id === this._id &&\r\n          shapeMouseOperate.hover.element === ShapeMouseOperateElement.POINT &&\r\n          index === shapeMouseOperate.hover.elementIndex\r\n        ) {\r\n          radius = shapeOptions.point.activeRadius\r\n          color = shapeOptions.point.activeBackgroundColor\r\n          borderColor = shapeOptions.point.activeBorderColor\r\n          borderSize = shapeOptions.point.activeBorderSize\r\n        }\r\n        renderFillCircle(ctx, borderColor, { x, y }, radius + borderSize)\r\n        renderFillCircle(ctx, color, { x, y }, radius)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置是否锁定\r\n   * @param lock\r\n   */\r\n  setLock (lock) {\r\n    this._lock = lock\r\n  }\r\n\r\n  /**\r\n   * 获取名字\r\n   * @return {*}\r\n   */\r\n  name () {\r\n    return this._name\r\n  }\r\n\r\n  /**\r\n   * 是否锁定\r\n   * @return {*}\r\n   */\r\n  lock () {\r\n    return this._lock\r\n  }\r\n\r\n  /**\r\n   * 总步骤数\r\n   * @return {*}\r\n   */\r\n  totalStep () {\r\n    return this._totalStep\r\n  }\r\n\r\n  /**\r\n   * 获取模式类型\r\n   * @returns\r\n   */\r\n  mode () {\r\n    return this._mode\r\n  }\r\n\r\n  /**\r\n   * 设置模式\r\n   * @param mode\r\n   */\r\n  setMode (mode) {\r\n    if (Object.values(ShapeMode).indexOf > -1) {\r\n      this._mode = mode\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置数据\r\n   * @param data\r\n   */\r\n  setData (data) {\r\n    if (data !== this._data) {\r\n      this._data = data\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 获取数据\r\n   * @returns\r\n   */\r\n  data () {\r\n    return this._data\r\n  }\r\n\r\n  /**\r\n   * 获取点\r\n   * @return {[]}\r\n   */\r\n  points () {\r\n    return this._points\r\n  }\r\n\r\n  /**\r\n   * 是否在绘制中\r\n   * @return {boolean}\r\n   */\r\n  isDrawing () {\r\n    return this._drawStep !== SHAPE_DRAW_STEP_FINISHED\r\n  }\r\n\r\n  /**\r\n   * 是否开始\r\n   * @returns\r\n   */\r\n  isStart () {\r\n    return this._drawStep === SHAPE_DRAW_STEP_START\r\n  }\r\n\r\n  /**\r\n   * 检查鼠标点是否在图形上\r\n   * @param mouseCoordinate\r\n   * @return {{id: *, elementIndex: number, element: string}}\r\n   */\r\n  checkEventCoordinateOn (eventCoordinate) {\r\n    const shapeOptions = this._styles || this._chartData.styleOptions().shape\r\n    // 检查鼠标点是否在图形的点上\r\n    const start = this._coordinates.length - 1\r\n    for (let i = start; i > -1; i--) {\r\n      if (checkCoordinateInCircle(this._coordinates[i], shapeOptions.point.radius, eventCoordinate)) {\r\n        return {\r\n          id: this._id,\r\n          element: ShapeMouseOperateElement.POINT,\r\n          elementIndex: i,\r\n          instance: this\r\n        }\r\n      }\r\n    }\r\n    // 检查鼠标点是否在点构成的其它图形上\r\n    if (this._shapeDataSources) {\r\n      for (const { key, type, isCheck, dataSource = [] } of this._shapeDataSources) {\r\n        if (isCheck) {\r\n          for (let i = 0; i < dataSource.length; i++) {\r\n            const sources = dataSource[i]\r\n            if (this.checkEventCoordinateOnShape({ key, type, dataSource: sources, eventCoordinate })) {\r\n              return {\r\n                id: this._id,\r\n                element: ShapeMouseOperateElement.OTHER,\r\n                elementIndex: i,\r\n                instance: this\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 不同的模式下处理值\r\n   * @param value\r\n   * @param dataIndex\r\n   * @param paneId\r\n   */\r\n  _performValue (y, dataIndex, paneId) {\r\n    const value = this._yAxis.convertFromPixel(y)\r\n    if (this._mode === ShapeMode.NORMAL || paneId !== 'candle_pane') {\r\n      return value\r\n    }\r\n    const kLineData = this._chartData.timeScaleStore().getDataByDataIndex(dataIndex)\r\n    if (!kLineData) {\r\n      return value\r\n    }\r\n    if (value > kLineData.high) {\r\n      if (this._mode === ShapeMode.WEAK_MAGNET) {\r\n        const highY = this._yAxis.convertToPixel(kLineData.high)\r\n        const buffValue = this._yAxis.convertFromPixel(highY - 8)\r\n        if (value < buffValue) {\r\n          return kLineData.high\r\n        }\r\n        return value\r\n      }\r\n      return kLineData.high\r\n    }\r\n    if (value < kLineData.low) {\r\n      if (this._mode === ShapeMode.WEAK_MAGNET) {\r\n        const lowY = this._yAxis.convertToPixel(kLineData.low)\r\n        const buffValue = this._yAxis.convertFromPixel(lowY - 8)\r\n        if (value > buffValue) {\r\n          return kLineData.low\r\n        }\r\n        return value\r\n      }\r\n      return kLineData.low\r\n    }\r\n    const max = Math.max(kLineData.open, kLineData.close)\r\n    if (value > max) {\r\n      if (value - max < kLineData.high - value) {\r\n        return max\r\n      }\r\n      return kLineData.high\r\n    }\r\n    const min = Math.min(kLineData.open, kLineData.close)\r\n    if (value < min) {\r\n      if (value - kLineData.low < min - value) {\r\n        return kLineData.low\r\n      }\r\n      return min\r\n    }\r\n    if (max - value < value - min) {\r\n      return max\r\n    }\r\n    return min\r\n  }\r\n\r\n  /**\r\n   * 绘制过程中鼠标移动事件\r\n   * @param coordinate\r\n   * @param event\r\n   */\r\n  mouseMoveForDrawing (coordinate, event) {\r\n    const dataIndex = this._xAxis.convertFromPixel(coordinate.x)\r\n    const timestamp = this._chartData.timeScaleStore().dataIndexToTimestamp(dataIndex)\r\n    const value = this._performValue(coordinate.y, dataIndex, event.paneId)\r\n    this._points[this._drawStep - 1] = { timestamp, value, dataIndex }\r\n    this.performEventMoveForDrawing({\r\n      step: this._drawStep,\r\n      mode: this._mode,\r\n      points: this._points,\r\n      movePoint: { timestamp, value, dataIndex },\r\n      xAxis: this._xAxis,\r\n      yAxis: this._yAxis\r\n    })\r\n    this.onDrawing({ id: this._id, step: this._drawStep, points: this._points })\r\n  }\r\n\r\n  /**\r\n   * 鼠标左边按钮点击事件\r\n   */\r\n  mouseLeftButtonDownForDrawing () {\r\n    if (this._drawStep === this._totalStep - 1) {\r\n      this._drawStep = SHAPE_DRAW_STEP_FINISHED\r\n      this._chartData.shapeStore().progressInstanceComplete()\r\n      this.onDrawEnd({ id: this._id, points: this._points })\r\n    } else {\r\n      this._drawStep++\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 鼠标按住移动方法\r\n   * @param coordinate\r\n   * @param event\r\n   */\r\n  mousePressedPointMove (coordinate, event) {\r\n    const shapeMouseOperate = this._chartData.shapeStore().mouseOperate()\r\n    const elementIndex = shapeMouseOperate.click.elementIndex\r\n    if (\r\n      !this._lock &&\r\n      shapeMouseOperate.click.id === this._id &&\r\n      shapeMouseOperate.click.element === ShapeMouseOperateElement.POINT &&\r\n      elementIndex !== -1\r\n    ) {\r\n      const dataIndex = this._xAxis.convertFromPixel(coordinate.x)\r\n      const timestamp = this._chartData.timeScaleStore().dataIndexToTimestamp(dataIndex)\r\n      const value = this._performValue(coordinate.y, dataIndex, event.paneId)\r\n      this._points[elementIndex].timestamp = timestamp\r\n      this._points[elementIndex].dataIndex = dataIndex\r\n      this._points[elementIndex].value = value\r\n      this.performEventPressedMove({\r\n        points: this._points,\r\n        mode: this._mode,\r\n        pressPointIndex: elementIndex,\r\n        pressPoint: { dataIndex, timestamp, value },\r\n        xAxis: this._xAxis,\r\n        yAxis: this._yAxis\r\n      })\r\n      this.onPressedMove({\r\n        id: shapeMouseOperate.click.id,\r\n        points: this._points,\r\n        event\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 按住非点拖动开始事件\r\n   * @param coordinate\r\n   */\r\n  startPressedOtherMove (coordinate) {\r\n    const dataIndex = this._xAxis.convertFromPixel(coordinate.x)\r\n    const value = this._yAxis.convertFromPixel(coordinate.y)\r\n    this._prevPressPoint = { dataIndex, value }\r\n    this._prevPoints = clone(this._points)\r\n  }\r\n\r\n  /**\r\n   * 按住非点拖动时事件\r\n   * @param coordinate\r\n   */\r\n  mousePressedOtherMove (coordinate) {\r\n    if (this._prevPressPoint) {\r\n      const dataIndex = this._xAxis.convertFromPixel(coordinate.x)\r\n      const value = this._yAxis.convertFromPixel(coordinate.y)\r\n      const difDataIndex = dataIndex - this._prevPressPoint.dataIndex\r\n      const difValue = value - this._prevPressPoint.value\r\n      this._points = this._prevPoints.map(point => {\r\n        // 防止因为创建时传入进来的point没有dataIndex，导致无法计算时间戳问题\r\n        if (!isValid(point.dataIndex)) {\r\n          point.dataIndex = this._chartData.timeScaleStore().timestampToDataIndex(point.timestamp)\r\n        }\r\n        const dataIndex = point.dataIndex + difDataIndex\r\n        const value = point.value + difValue\r\n        return {\r\n          dataIndex,\r\n          value,\r\n          timestamp: this._chartData.timeScaleStore().dataIndexToTimestamp(dataIndex)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  // -------------------- 事件开始 -------------------\r\n\r\n  /**\r\n   * 开始绘制事件回调\r\n   * @param id\r\n   */\r\n  onDrawStart ({ id }) {}\r\n\r\n  /**\r\n   * 绘制过程中事件回调\r\n   * @param id\r\n   * @param step\r\n   * @param points\r\n   */\r\n  onDrawing ({ id, step, points }) {}\r\n\r\n  /**\r\n   * 绘制结束事件回调\r\n   * @param id\r\n   * @param points\r\n   */\r\n  onDrawEnd ({ id, points }) {}\r\n\r\n  /**\r\n   * 按住移动事件\r\n   * @param id\r\n   * @param points\r\n   * @param event\r\n   */\r\n  onPressedMove ({ id, points, event }) {}\r\n\r\n  /**\r\n   * 移除事件回调\r\n   * @param id\r\n   */\r\n  onRemove ({ id }) {}\r\n\r\n  // -------------------- 事件结束 -------------------\r\n\r\n  // --------------------- 自定义时需要实现的一些方法开始 ----------------------\r\n\r\n  /**\r\n   * 检查事件坐标是否在图形上\r\n   * @param key\r\n   * @param type\r\n   * @param points\r\n   * @param mousePoint\r\n   */\r\n  checkEventCoordinateOnShape ({ key, type, dataSource, eventCoordinate }) {}\r\n\r\n  /**\r\n   * 创建图形配置\r\n   * @param step\r\n   * @param points\r\n   * @param coordinates\r\n   * @param viewport\r\n   * @param precision\r\n   * @param xAxis\r\n   * @param yAxis\r\n   */\r\n  createShapeDataSource ({ step, mode, points, coordinates, viewport, precision, styles, xAxis, yAxis, data }) {}\r\n\r\n  /**\r\n   * 处理绘制过程中鼠标移动\r\n   * @param step\r\n   * @param mode\r\n   * @param points\r\n   * @param point\r\n   * @param xAxis\r\n   * @param yAxis\r\n   */\r\n  performEventMoveForDrawing ({ step, mode, points, movePoint, xAxis, yAxis }) {}\r\n\r\n  /**\r\n   * 处理鼠标按住移动\r\n   * @param mode\r\n   * @param points\r\n   * @param pressPointIndex\r\n   * @param point\r\n   * @param xAxis\r\n   * @param yAxis\r\n   */\r\n  performEventPressedMove ({ mode, points, pressPointIndex, pressPoint, xAxis, yAxis }) {}\r\n\r\n  // --------------------- 自定义时需要实现的一些方法结束 ----------------------\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport extension from '../extension'\r\n\r\nimport { isNumber, isFunction, isValid } from '../../utils/typeChecks'\r\nimport { logWarn } from '../../utils/logger'\r\n\r\nimport Shape, { ShapeMouseOperateElement } from '../../component/overlay/Shape'\r\n\r\nimport { InvalidateLevel } from '../constants'\r\n\r\nexport default class ShapeStore {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n    // 图形标记映射\r\n    this._templates = this._createTemplates()\r\n    // 图形标记鼠标操作信息\r\n    this._mouseOperate = {\r\n      click: {\r\n        id: '',\r\n        element: ShapeMouseOperateElement.NONE,\r\n        elementIndex: -1\r\n      },\r\n      hover: {\r\n        id: '',\r\n        element: ShapeMouseOperateElement.NONE,\r\n        elementIndex: -1\r\n      }\r\n    }\r\n    // 进行中的实例\r\n    this._progressInstance = null\r\n    // 事件按住的示例\r\n    this._pressedInstance = null\r\n    // 图形实例\r\n    this._instances = new Map()\r\n  }\r\n\r\n  /**\r\n   * 创建模板\r\n   * @returns\r\n   */\r\n  _createTemplates () {\r\n    const templates = {}\r\n    const extensions = extension.shapeExtensions\r\n    for (const name in extensions) {\r\n      const TemplateClass = this._createTemplateClass(extensions[name])\r\n      if (TemplateClass) {\r\n        templates[name] = TemplateClass\r\n      }\r\n    }\r\n    return templates\r\n  }\r\n\r\n  /**\r\n   * 创建模板类\r\n   * @param name\r\n   * @param totalStep\r\n   * @param checkEventCoordinateOnShape\r\n   * @param createShapeDataSource\r\n   * @param performEventPressedMove\r\n   * @param performEventMoveForDrawing\r\n   * @param drawExtend\r\n   * @return\r\n   */\r\n  _createTemplateClass ({\r\n    name, totalStep,\r\n    checkEventCoordinateOnShape,\r\n    createShapeDataSource,\r\n    performEventPressedMove,\r\n    performEventMoveForDrawing,\r\n    drawExtend\r\n  }) {\r\n    if (\r\n      !name ||\r\n      !isNumber(totalStep) ||\r\n      !isFunction(checkEventCoordinateOnShape) ||\r\n      !isFunction(createShapeDataSource)\r\n    ) {\r\n      logWarn('', '', 'Required attribute \"name\" and \"totalStep\", method \"checkEventCoordinateOnShape\" and \"createShapeDataSource\", new shape cannot be generated!!!')\r\n      return null\r\n    }\r\n    class Template extends Shape {\r\n      constructor ({\r\n        id, chartData, xAxis, yAxis, points, styles, lock, data\r\n      }) {\r\n        super({\r\n          id, name, totalStep, chartData, xAxis, yAxis, points, styles, lock, data\r\n        })\r\n      }\r\n    }\r\n    Template.prototype.checkEventCoordinateOnShape = checkEventCoordinateOnShape\r\n    Template.prototype.createShapeDataSource = createShapeDataSource\r\n    if (isFunction(performEventPressedMove)) {\r\n      Template.prototype.performEventPressedMove = performEventPressedMove\r\n    }\r\n    if (isFunction(performEventMoveForDrawing)) {\r\n      Template.prototype.performEventMoveForDrawing = performEventMoveForDrawing\r\n    }\r\n    if (isFunction(drawExtend)) {\r\n      Template.prototype.drawExtend = drawExtend\r\n    }\r\n    return Template\r\n  }\r\n\r\n  /**\r\n   * 添加自定义标记图形\r\n   * @param templates\r\n   */\r\n  addTemplate (templates) {\r\n    templates.forEach(tmp => {\r\n      const Template = this._createTemplateClass(tmp)\r\n      if (Template) {\r\n        this._templates[tmp.name] = Template\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取图形标记模板类\r\n   * @param name\r\n   * @return {*}\r\n   */\r\n  getTemplate (name) {\r\n    return this._templates[name]\r\n  }\r\n\r\n  /**\r\n   * 获取实例\r\n   * @param shapeId\r\n   * @returns\r\n   */\r\n  getInstance (shapeId) {\r\n    for (const entry of this._instances) {\r\n      const shape = (entry[1] || []).find(s => s.id() === shapeId)\r\n      if (shape) {\r\n        return shape\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 是否有实例\r\n   * @param shapeId\r\n   * @returns\r\n   */\r\n  hasInstance (shapeId) {\r\n    return !!this.getInstance(shapeId)\r\n  }\r\n\r\n  /**\r\n   * 添加标记实例\r\n   * @param instance\r\n   * @param paneId\r\n   */\r\n  addInstance (instance, paneId) {\r\n    if (instance.isDrawing()) {\r\n      this._progressInstance = { paneId, instance, fixed: isValid(paneId) }\r\n    } else {\r\n      if (!this._instances.has(paneId)) {\r\n        this._instances.set(paneId, [])\r\n      }\r\n      this._instances.get(paneId).push(instance)\r\n    }\r\n    this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n  }\r\n\r\n  /**\r\n   * 获取进行中的实例\r\n   * @returns\r\n   */\r\n  progressInstance () {\r\n    return this._progressInstance || {}\r\n  }\r\n\r\n  /**\r\n   * 进行中的实例完成\r\n   */\r\n  progressInstanceComplete () {\r\n    const { instance, paneId } = this.progressInstance()\r\n    if (instance && !instance.isDrawing()) {\r\n      if (!this._instances.has(paneId)) {\r\n        this._instances.set(paneId, [])\r\n      }\r\n      this._instances.get(paneId).push(instance)\r\n      this._progressInstance = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新进行中的实例\r\n   * @param yAxis\r\n   * @param paneId\r\n   */\r\n  updateProgressInstance (yAxis, paneId) {\r\n    const { instance, fixed } = this.progressInstance()\r\n    if (instance && !fixed) {\r\n      instance.setYAxis(yAxis)\r\n      this._progressInstance.paneId = paneId\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取按住的实例\r\n   * @returns\r\n   */\r\n  pressedInstance () {\r\n    return this._pressedInstance || {}\r\n  }\r\n\r\n  /**\r\n   * 更新事件按住的实例\r\n   * @param instance\r\n   * @param paneId\r\n   * @param element\r\n   */\r\n  updatePressedInstance (instance, paneId, element) {\r\n    if (instance) {\r\n      this._pressedInstance = { instance, paneId, element }\r\n    } else {\r\n      this._pressedInstance = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取图形标记的数据\r\n   * @param paneId\r\n   * @returns {{}}\r\n   */\r\n  instances (paneId) {\r\n    return this._instances.get(paneId) || []\r\n  }\r\n\r\n  /**\r\n   * 设置图形标记实例配置\r\n   * @param options\r\n   */\r\n  setInstanceOptions (options = {}) {\r\n    const { id, styles, lock, mode, data } = options\r\n    const defaultStyles = this._chartData.styleOptions().shape\r\n    let shouldInvalidate = false\r\n    if (isValid(id)) {\r\n      const instance = this.getInstance(id)\r\n      if (instance) {\r\n        instance.setLock(lock)\r\n        instance.setMode(mode)\r\n        if (instance.setStyles(styles, defaultStyles) || instance.setData(data)) {\r\n          shouldInvalidate = true\r\n        }\r\n      }\r\n    } else {\r\n      this._instances.forEach(shapes => {\r\n        shapes.forEach(instance => {\r\n          instance.setLock(lock)\r\n          instance.setMode(mode)\r\n          if (instance.setStyles(styles, defaultStyles) || instance.setData(data)) {\r\n            shouldInvalidate = true\r\n          }\r\n        })\r\n      })\r\n    }\r\n    if (shouldInvalidate) {\r\n      this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取图形标记信息\r\n   * @param id\r\n   * @return {{name, lock: *, styles, id, points: (*|*[])}[]|{name, lock: *, styles, id, points: (*|*[])}}\r\n   */\r\n  getInstanceInfo (shapeId) {\r\n    const create = (instance) => {\r\n      return {\r\n        name: instance.name(),\r\n        id: instance.id(),\r\n        totalStep: instance.totalStep(),\r\n        lock: instance.lock(),\r\n        mode: instance.mode(),\r\n        points: instance.points(),\r\n        styles: instance.styles(),\r\n        data: instance.data()\r\n      }\r\n    }\r\n    const progressInstance = this.progressInstance()\r\n    if (isValid(shapeId)) {\r\n      if (progressInstance.instance && progressInstance.instance.id() === shapeId) {\r\n        return create(progressInstance.instance)\r\n      }\r\n      const shape = this.getInstance(shapeId)\r\n      if (shape) {\r\n        return create(shape)\r\n      }\r\n    } else {\r\n      const infos = {}\r\n      this._instances.forEach((shapes, paneId) => {\r\n        infos[paneId] = shapes.map(shape => create(shape))\r\n        if (progressInstance.paneId === paneId && progressInstance.instance) {\r\n          infos[paneId].push(create(progressInstance.instance))\r\n        }\r\n      })\r\n      return infos\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 移除图形实例\r\n   * @param shapeId 参数\r\n   * @param isProgress\r\n   */\r\n  removeInstance (shapeId) {\r\n    let shouldInvalidate = false\r\n    const progressInstance = this.progressInstance().instance\r\n    if (progressInstance && (!isValid(shapeId) || progressInstance.id() === shapeId)) {\r\n      progressInstance.onRemove({ id: progressInstance.id() })\r\n      this._progressInstance = null\r\n      shouldInvalidate = true\r\n    }\r\n    if (isValid(shapeId)) {\r\n      for (const entry of this._instances) {\r\n        const shapes = entry[1] || []\r\n        const removeIndex = shapes.findIndex(shape => shape.id() === shapeId)\r\n        if (removeIndex > -1) {\r\n          shapes[removeIndex].onRemove({ id: shapes[removeIndex].id() })\r\n          shapes.splice(removeIndex, 1)\r\n          if (shapes.length === 0) {\r\n            this._instances.delete(entry[0])\r\n          }\r\n          shouldInvalidate = true\r\n          break\r\n        }\r\n      }\r\n    } else {\r\n      this._instances.forEach(shapes => {\r\n        if (shapes.length > 0) {\r\n          shapes.forEach(shape => {\r\n            shape.onRemove({ id: shape.id() })\r\n          })\r\n        }\r\n      })\r\n      this._instances.clear()\r\n      shouldInvalidate = true\r\n    }\r\n    if (shouldInvalidate) {\r\n      this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取图形标记鼠标操作信息\r\n   * @return {{hover: {id: string, elementIndex: number, element: string}, click: {id: string, elementIndex: number, element: string}}}\r\n   */\r\n  mouseOperate () {\r\n    return this._mouseOperate\r\n  }\r\n\r\n  /**\r\n   * 设置鼠标操作信息\r\n   * @param mouseOperate\r\n   * @return\r\n   */\r\n  setMouseOperate (mouseOperate) {\r\n    const { hover, click } = this._mouseOperate\r\n    if (mouseOperate.hover &&\r\n      (hover.id !== mouseOperate.hover.id || hover.element !== mouseOperate.hover.element || hover.elementIndex !== mouseOperate.hover.elementIndex)\r\n    ) {\r\n      this._mouseOperate.hover = { ...mouseOperate.hover }\r\n    }\r\n    if (mouseOperate.click &&\r\n      (click.id !== mouseOperate.click.id || click.element !== mouseOperate.click.element || click.elementIndex !== mouseOperate.click.elementIndex)\r\n    ) {\r\n      this._mouseOperate.click = { ...mouseOperate.click }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 是否为空\r\n   * @returns\r\n   */\r\n  isEmpty () {\r\n    return this._instances.size === 0 && !this.progressInstance().instance\r\n  }\r\n\r\n  /**\r\n   * 是否正在绘制\r\n   * @return\r\n   */\r\n  isDrawing () {\r\n    const instance = this.progressInstance().instance\r\n    return instance && instance.isDrawing()\r\n  }\r\n\r\n  /**\r\n   * 是否按住\r\n   * @returns\r\n   */\r\n  isPressed () {\r\n    return !!this.pressedInstance().instance\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isValid } from '../../utils/typeChecks'\r\n\r\nimport { InvalidateLevel } from '../constants'\r\n\r\nexport default class AnnotationStore {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n    // 注解标记\r\n    this._annotations = new Map()\r\n    // 注解标记\r\n    this._visibleAnnotations = new Map()\r\n    // 注解鼠标操作信息\r\n    this._mouseOperate = { id: '' }\r\n  }\r\n\r\n  /**\r\n   * 获取注解鼠标操作信息\r\n   * @return {null}\r\n   */\r\n  mouseOperate () {\r\n    return this._mouseOperate\r\n  }\r\n\r\n  /**\r\n   * 设置鼠标操作\r\n   * @param operate\r\n   */\r\n  setMouseOperate (operate) {\r\n    const { id } = this._mouseOperate\r\n    if (operate && id !== operate.id) {\r\n      this._mouseOperate = { ...operate }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建可见的注解数据\r\n   */\r\n  createVisibleAnnotations () {\r\n    this._visibleAnnotations.clear()\r\n    if (this._annotations.size > 0) {\r\n      this._chartData.visibleDataList().forEach(({ data, x }) => {\r\n        this._annotations.forEach((annotations, paneId) => {\r\n          if (annotations.size > 0) {\r\n            const annotation = annotations.get(data.timestamp) || []\r\n            if (annotation.length > 0) {\r\n              for (const an of annotation) {\r\n                an.createSymbolCoordinate(x)\r\n                if (this._visibleAnnotations.has(paneId)) {\r\n                  this._visibleAnnotations.get(paneId).push(an)\r\n                } else {\r\n                  this._visibleAnnotations.set(paneId, [an])\r\n                }\r\n              }\r\n            }\r\n          }\r\n        })\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建注解\r\n   * @param annotations\r\n   * @param paneId\r\n   */\r\n  add (annotations, paneId) {\r\n    if (!this._annotations.has(paneId)) {\r\n      this._annotations.set(paneId, new Map())\r\n    }\r\n    annotations.forEach(annotation => {\r\n      const idAnnotations = this._annotations.get(paneId)\r\n      if (idAnnotations.has(annotation.id())) {\r\n        idAnnotations.get(annotation.id()).push(annotation)\r\n      } else {\r\n        idAnnotations.set(annotation.id(), [annotation])\r\n      }\r\n    })\r\n    this.createVisibleAnnotations()\r\n    this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n  }\r\n\r\n  /**\r\n   * 获取注解\r\n   * @param paneId\r\n   * @returns\r\n   */\r\n  get (paneId) {\r\n    return this._visibleAnnotations.get(paneId)\r\n  }\r\n\r\n  /**\r\n   * 移除注解\r\n   * @param paneId\r\n   * @param point\r\n   */\r\n  remove (paneId, point) {\r\n    let shouldAdjust = false\r\n    if (isValid(paneId)) {\r\n      if (this._annotations.has(paneId)) {\r\n        if (isValid(point)) {\r\n          const paneAnnotations = this._annotations.get(paneId)\r\n          const points = [].concat(point)\r\n          points.forEach(({ timestamp }) => {\r\n            if (paneAnnotations.has(timestamp)) {\r\n              shouldAdjust = true\r\n              paneAnnotations.delete(timestamp)\r\n            }\r\n          })\r\n          if (paneAnnotations.size === 0) {\r\n            this._annotations.delete(paneId)\r\n          }\r\n          if (shouldAdjust) {\r\n            this.createVisibleAnnotations()\r\n          }\r\n        } else {\r\n          shouldAdjust = true\r\n          this._annotations.delete(paneId)\r\n          this._visibleAnnotations.delete(paneId)\r\n        }\r\n      }\r\n    } else {\r\n      shouldAdjust = true\r\n      this._annotations.clear()\r\n      this._visibleAnnotations.clear()\r\n    }\r\n    if (shouldAdjust) {\r\n      this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 是否为空\r\n   * @returns\r\n   */\r\n  isEmpty () {\r\n    return this._visibleAnnotations.size === 0\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isValid } from '../../utils/typeChecks'\r\n\r\nimport { InvalidateLevel } from '../constants'\r\n\r\nexport default class TagStore {\r\n  constructor (chartData) {\r\n    // 刷新回调\r\n    this._chartData = chartData\r\n    // 标签\r\n    this._tags = new Map()\r\n  }\r\n\r\n  /**\r\n   * 根据id获取tag实例\r\n   * @param id\r\n   * @param paneId\r\n   * @returns\r\n   */\r\n  _getById (id, paneId) {\r\n    const tags = this.get(paneId)\r\n    if (tags) {\r\n      return tags.get(id)\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 是否包含某一个标签\r\n   * @param id\r\n   * @param paneId\r\n   * @returns\r\n   */\r\n  has (id, paneId) {\r\n    return !!this._getById(id, paneId)\r\n  }\r\n\r\n  /**\r\n   * 更新tag\r\n   * @param id\r\n   * @param paneId\r\n   * @param options\r\n   */\r\n  update (id, paneId, options) {\r\n    const tag = this._getById(id, paneId)\r\n    if (tag) {\r\n      return tag.update(options)\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n  * 根据id获取标签实例\r\n  * @param tagId\r\n  * @param paneId\r\n  * @return\r\n  */\r\n  get (paneId) {\r\n    return this._tags.get(paneId)\r\n  }\r\n\r\n  /**\r\n  * 添加标签\r\n  * @param tags\r\n  * @param paneId\r\n  */\r\n  add (tags, paneId) {\r\n    if (!this._tags.has(paneId)) {\r\n      this._tags.set(paneId, new Map())\r\n    }\r\n    const idTags = this._tags.get(paneId)\r\n    tags.forEach(tag => {\r\n      idTags.set(tag.id(), tag)\r\n    })\r\n    this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n  }\r\n\r\n  /**\r\n  * 移除标签\r\n  * @param paneId\r\n  * @param tagId\r\n  */\r\n  remove (paneId, tagId) {\r\n    let shouldInvalidate = false\r\n    if (isValid(paneId)) {\r\n      if (this._tags.has(paneId)) {\r\n        if (isValid(tagId)) {\r\n          const paneTags = this._tags.get(paneId)\r\n          const ids = [].concat(tagId)\r\n          ids.forEach(id => {\r\n            if (paneTags.has(id)) {\r\n              shouldInvalidate = true\r\n              paneTags.delete(id)\r\n            }\r\n          })\r\n          if (paneTags.size === 0) {\r\n            this._tags.delete(paneId)\r\n          }\r\n        } else {\r\n          shouldInvalidate = true\r\n          this._tags.delete(paneId)\r\n        }\r\n      }\r\n    } else {\r\n      shouldInvalidate = true\r\n      this._tags.clear()\r\n    }\r\n    if (shouldInvalidate) {\r\n      this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isValid } from '../../utils/typeChecks'\r\n\r\nimport { InvalidateLevel } from '../constants'\r\n\r\nexport default class CrosshairStore {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n    // 十字光标信息\r\n    this._crosshair = {}\r\n  }\r\n\r\n  /**\r\n     * 设置十字光标点信息\r\n     * @param crosshair\r\n     * @param notInvalidate\r\n     */\r\n  set (crosshair, notInvalidate) {\r\n    const dataList = this._chartData.dataList()\r\n    const cr = crosshair || {}\r\n    let realDataIndex\r\n    let dataIndex\r\n    if (isValid(cr.x)) {\r\n      realDataIndex = this._chartData.timeScaleStore().coordinateToDataIndex(cr.x)\r\n      if (realDataIndex < 0) {\r\n        dataIndex = 0\r\n      } else if (realDataIndex > dataList.length - 1) {\r\n        dataIndex = dataList.length - 1\r\n      } else {\r\n        dataIndex = realDataIndex\r\n      }\r\n    } else {\r\n      realDataIndex = dataList.length - 1\r\n      dataIndex = realDataIndex\r\n    }\r\n    const kLineData = dataList[dataIndex]\r\n    const realX = this._chartData.timeScaleStore().dataIndexToCoordinate(realDataIndex)\r\n    const prevCrosshair = { x: this._crosshair.x, y: this._crosshair.y, paneId: this._crosshair.paneId }\r\n    this._crosshair = { ...cr, realX, kLineData, realDataIndex, dataIndex }\r\n    if (cr.paneId && kLineData) {\r\n      this._chartData.crosshairChange({\r\n        realDataIndex,\r\n        dataIndex,\r\n        kLineData,\r\n        x: cr.x,\r\n        y: cr.y\r\n      })\r\n    }\r\n    if (\r\n      (prevCrosshair.x !== cr.x || prevCrosshair.y !== cr.y || prevCrosshair.paneId !== cr.paneId) && !notInvalidate\r\n    ) {\r\n      this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重新计算十字光标\r\n   * @param notInvalidate\r\n   */\r\n  recalculate (notInvalidate) {\r\n    this.set(this._crosshair, notInvalidate)\r\n  }\r\n\r\n  /**\r\n   * 获取crosshair信息\r\n   * @returns\r\n   */\r\n  get () {\r\n    return this._crosshair\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport default class Delegate {\r\n  constructor () {\r\n    this._observers = []\r\n  }\r\n\r\n  subscribe (observer) {\r\n    if (this._observers.indexOf(observer) < 0) {\r\n      this._observers.push(observer)\r\n    }\r\n  }\r\n\r\n  unsubscribe (observer) {\r\n    const index = this._observers.indexOf(observer)\r\n    if (index > -1) {\r\n      this._observers.splice(index, 1)\r\n    } else {\r\n      this._observers = []\r\n    }\r\n  }\r\n\r\n  execute (data) {\r\n    this._observers.forEach(observer => {\r\n      observer(data)\r\n    })\r\n  }\r\n\r\n  hasObservers () {\r\n    return this._observers.length > 0\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { ActionType } from '../constants'\r\n\r\nimport Delegate from '../delegate/Delegate'\r\n\r\nexport default class ActionStore {\r\n  constructor () {\r\n    // 事件代理\r\n    this._delegates = new Map()\r\n  }\r\n\r\n  /**\r\n   * 事件执行\r\n   * @param type\r\n   * @param data\r\n   */\r\n  execute (type, data) {\r\n    if (this.has(type)) {\r\n      this._delegates.get(type).execute(data)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 是否有事件监听\r\n   * @param type\r\n   * @return {boolean}\r\n   */\r\n  has (type) {\r\n    return this._delegates.has(type) && this._delegates.get(type).hasObservers()\r\n  }\r\n\r\n  /**\r\n   * 订阅事件\r\n   * @param type\r\n   * @param callback\r\n   * @return {boolean}\r\n   */\r\n  subscribe (type, callback) {\r\n    if (Object.values(ActionType).indexOf(type) < 0) {\r\n      return false\r\n    }\r\n    if (!this._delegates.has(type)) {\r\n      this._delegates.set(type, new Delegate())\r\n    }\r\n    this._delegates.get(type).subscribe(callback)\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 取消事件订阅\r\n   * @param type\r\n   * @param callback\r\n   * @return {boolean}\r\n   */\r\n  unsubscribe (type, callback) {\r\n    if (Object.values(ActionType).indexOf(type) < 0) {\r\n      return false\r\n    }\r\n    if (this._delegates.has(type)) {\r\n      const delegate = this._delegates.get(type)\r\n      delegate.unsubscribe(callback)\r\n      if (!delegate.hasObservers()) {\r\n        this._delegates.delete(type)\r\n      }\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { isArray, isObject, isBoolean, merge, clone } from '../utils/typeChecks'\r\nimport { defaultStyleOptions } from '../options/styleOptions'\r\n\r\nimport TimeScaleStore from './store/TimeScaleStore'\r\nimport TechnicalIndicatorStore from './store/TechnicalIndicatorStore'\r\nimport ShapeStore from './store/ShapeStore'\r\nimport AnnotationStore from './store/AnnotationStore'\r\nimport TagStore from './store/TagStore'\r\nimport CrosshairStore from './store/CrosshairStore'\r\nimport ActionStore from './store/ActionStore'\r\n\r\nexport default class ChartData {\r\n  constructor (styleOptions, handler) {\r\n    // 持有者\r\n    this._handler = handler\r\n    // 样式配置\r\n    this._styleOptions = clone(defaultStyleOptions)\r\n    merge(this._styleOptions, styleOptions)\r\n\r\n    // 价格精度\r\n    this._pricePrecision = 2\r\n    // 数量精度\r\n    this._volumePrecision = 0\r\n\r\n    // 数据源\r\n    this._dataList = []\r\n    // 可见的数据(需要绘制的数据)\r\n    this._visibleDataList = []\r\n\r\n    // 调整pane标记\r\n    this._dragPaneFlag = false\r\n\r\n    // 时间轴缩放数据存储\r\n    this._timeScaleStore = new TimeScaleStore(this)\r\n    // 技术指标数据存储\r\n    this._technicalIndicatorStore = new TechnicalIndicatorStore(this)\r\n    // 图形数据存储\r\n    this._shapeStore = new ShapeStore(this)\r\n    // 注解数据存储\r\n    this._annotationStore = new AnnotationStore(this)\r\n    // 标签数据存储\r\n    this._tagStore = new TagStore(this)\r\n    // 十字光标数据存储\r\n    this._crosshairStore = new CrosshairStore(this)\r\n    // 事件存储\r\n    this._actionStore = new ActionStore()\r\n  }\r\n\r\n  /**\r\n   * 调整可见数据\r\n   */\r\n  adjustVisibleDataList () {\r\n    // 处理需要绘制的数据\r\n    this._visibleDataList = []\r\n    const from = this._timeScaleStore.from()\r\n    const to = this._timeScaleStore.to()\r\n    for (let i = from; i < to; i++) {\r\n      const kLineData = this._dataList[i]\r\n      const x = this._timeScaleStore.dataIndexToCoordinate(i)\r\n      this._visibleDataList.push({\r\n        index: i,\r\n        x,\r\n        data: kLineData\r\n      })\r\n    }\r\n    this._annotationStore.createVisibleAnnotations()\r\n  }\r\n\r\n  /**\r\n   * 获取样式配置\r\n   * @return {{}}\r\n   */\r\n  styleOptions () {\r\n    return this._styleOptions\r\n  }\r\n\r\n  /**\r\n   * 设置样式配置\r\n   * @param options\r\n   */\r\n  applyStyleOptions (options) {\r\n    merge(this._styleOptions, options)\r\n  }\r\n\r\n  /**\r\n   * 价格精度\r\n   * @returns {number}\r\n   */\r\n  pricePrecision () {\r\n    return this._pricePrecision\r\n  }\r\n\r\n  /**\r\n   * 数量精度\r\n   * @returns {number}\r\n   */\r\n  volumePrecision () {\r\n    return this._volumePrecision\r\n  }\r\n\r\n  /**\r\n   * 设置价格和数量精度\r\n   * @param pricePrecision\r\n   * @param volumePrecision\r\n   */\r\n  setPriceVolumePrecision (pricePrecision, volumePrecision) {\r\n    this._pricePrecision = pricePrecision\r\n    this._volumePrecision = volumePrecision\r\n    this._technicalIndicatorStore.setSeriesPrecision(pricePrecision, volumePrecision)\r\n  }\r\n\r\n  /**\r\n   * 获取数据源\r\n   * @returns {[]|*[]}\r\n   */\r\n  dataList () {\r\n    return this._dataList\r\n  }\r\n\r\n  /**\r\n   * 获取可见数据源\r\n   * @returns {[]|*[]}\r\n   */\r\n  visibleDataList () {\r\n    return this._visibleDataList\r\n  }\r\n\r\n  /**\r\n   * 添加数据\r\n   * @param data\r\n   * @param pos\r\n   * @param more\r\n   */\r\n  addData (data, pos, more) {\r\n    if (isObject(data)) {\r\n      if (isArray(data)) {\r\n        this._timeScaleStore.setLoading(false)\r\n        this._timeScaleStore.setMore(isBoolean(more) ? more : true)\r\n        const isFirstAdd = this._dataList.length === 0\r\n        this._dataList = data.concat(this._dataList)\r\n        if (isFirstAdd) {\r\n          this._timeScaleStore.resetOffsetRightSpace()\r\n        }\r\n        this._timeScaleStore.adjustFromTo()\r\n      } else {\r\n        const dataSize = this._dataList.length\r\n        if (pos >= dataSize) {\r\n          this._dataList.push(data)\r\n          let offsetRightBarCount = this._timeScaleStore.offsetRightBarCount()\r\n          if (offsetRightBarCount < 0) {\r\n            this._timeScaleStore.setOffsetRightBarCount(--offsetRightBarCount)\r\n          }\r\n          this._timeScaleStore.adjustFromTo()\r\n        } else {\r\n          this._dataList[pos] = data\r\n          this.adjustVisibleDataList()\r\n        }\r\n      }\r\n      this._crosshairStore.recalculate(true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 清空数据源\r\n   */\r\n  clearDataList () {\r\n    this._dataList = []\r\n    this._visibleDataList = []\r\n    this._timeScaleStore.clear()\r\n  }\r\n\r\n  /**\r\n   * 获取时间缩放存储\r\n   * @returns\r\n   */\r\n  timeScaleStore () {\r\n    return this._timeScaleStore\r\n  }\r\n\r\n  /**\r\n   * 获取技术指标存储\r\n   * @returns\r\n   */\r\n  technicalIndicatorStore () {\r\n    return this._technicalIndicatorStore\r\n  }\r\n\r\n  /**\r\n   * 获取图形存储\r\n   * @returns\r\n   */\r\n  shapeStore () {\r\n    return this._shapeStore\r\n  }\r\n\r\n  /**\r\n   * 获取注解存储\r\n   * @returns\r\n   */\r\n  annotationStore () {\r\n    return this._annotationStore\r\n  }\r\n\r\n  /**\r\n   * 获取标签数据存储\r\n   * @returns\r\n   */\r\n  tagStore () {\r\n    return this._tagStore\r\n  }\r\n\r\n  /**\r\n   * 获取十字光标数据存储\r\n   * @returns\r\n   */\r\n  crosshairStore () {\r\n    return this._crosshairStore\r\n  }\r\n\r\n  /**\r\n   * 获取事件数据存储\r\n   * @returns\r\n   */\r\n  actionStore () {\r\n    return this._actionStore\r\n  }\r\n\r\n  /**\r\n   * 刷新\r\n   * @param invalidateLevel\r\n   */\r\n  invalidate (invalidateLevel) {\r\n    this._handler.invalidate(invalidateLevel)\r\n  }\r\n\r\n  /**\r\n   * 十字光标变化\r\n   * @param data\r\n   */\r\n  crosshairChange (data) {\r\n    this._handler.crosshair(data)\r\n  }\r\n\r\n  /**\r\n   * 获取拖拽Pane标记\r\n   * @return {boolean}\r\n   */\r\n  dragPaneFlag () {\r\n    return this._dragPaneFlag\r\n  }\r\n\r\n  /**\r\n   * 设置拖拽Pane标记\r\n   * @param flag\r\n   */\r\n  setDragPaneFlag (flag) {\r\n    this._dragPaneFlag = flag\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 创建一个元素\r\n * @param name\r\n * @param styles\r\n * @return {*}\r\n */\r\nexport function createElement (name, styles = {}) {\r\n  const element = document.createElement(name)\r\n  for (const key in styles) {\r\n    (element.style)[key] = styles[key]\r\n  }\r\n  return element\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { getPixelRatio } from '../utils/canvas'\r\nimport { createElement } from '../utils/element'\r\n\r\nexport default class Pane {\r\n  constructor (props) {\r\n    this._height = -1\r\n    this._container = props.container\r\n    this._chartData = props.chartData\r\n    this._initBefore(props)\r\n    this._initElement()\r\n    this._mainWidget = this._createMainWidget(this._element, props)\r\n    this._yAxisWidget = this._createYAxisWidget(this._element, props)\r\n  }\r\n\r\n  _initBefore (props) {}\r\n\r\n  _initElement () {\r\n    this._element = createElement('div', {\r\n      width: '100%',\r\n      margin: '0',\r\n      padding: '0',\r\n      position: 'relative',\r\n      overflow: 'hidden'\r\n    })\r\n    const lastElement = this._container.lastChild\r\n    if (lastElement) {\r\n      this._container.insertBefore(this._element, lastElement)\r\n    } else {\r\n      this._container.appendChild(this._element)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建主组件\r\n   * @param container\r\n   * @param props\r\n   * @private\r\n   */\r\n  _createMainWidget (container, props) {}\r\n\r\n  /**\r\n   * 创建y轴组件\r\n   * @param container\r\n   * @param props\r\n   * @private\r\n   */\r\n  _createYAxisWidget (container, props) {}\r\n\r\n  /**\r\n   * 获取宽度\r\n   * @returns {number}\r\n   */\r\n  width () {\r\n    return this._element.offsetWidth\r\n  }\r\n\r\n  setWidth (mainWidgetWidth, yAxisWidgetWidth) {\r\n    this._mainWidget.setWidth(mainWidgetWidth)\r\n    this._yAxisWidget && this._yAxisWidget.setWidth(yAxisWidgetWidth)\r\n  }\r\n\r\n  /**\r\n   * 获取高度\r\n   */\r\n  height () {\r\n    return this._height\r\n  }\r\n\r\n  /**\r\n   * 设置临时高度\r\n   * @param height\r\n   */\r\n  setHeight (height) {\r\n    this._height = height\r\n    this._mainWidget.setHeight(height)\r\n    this._yAxisWidget && this._yAxisWidget.setHeight(height)\r\n  }\r\n\r\n  setOffsetLeft (mainWidgetOffsetLeft, yAxisWidgetOffsetLeft) {\r\n    this._mainWidget.setOffsetLeft(mainWidgetOffsetLeft)\r\n    this._yAxisWidget && this._yAxisWidget.setOffsetLeft(yAxisWidgetOffsetLeft)\r\n  }\r\n\r\n  layout () {\r\n    if (this._element.offsetHeight !== this._height) {\r\n      this._element.style.height = `${this._height}px`\r\n    }\r\n    this._mainWidget.layout()\r\n    this._yAxisWidget && this._yAxisWidget.layout()\r\n  }\r\n\r\n  /**\r\n   * 刷新\r\n   * @param level\r\n   */\r\n  invalidate (level) {\r\n    this._yAxisWidget && this._yAxisWidget.invalidate(level)\r\n    this._mainWidget.invalidate(level)\r\n  }\r\n\r\n  /**\r\n   * 将canvas转换成图片\r\n   * @param includeOverlay\r\n   * @return {HTMLCanvasElement}\r\n   */\r\n  getImage (includeOverlay) {\r\n    const width = this._element.offsetWidth\r\n    const height = this._element.offsetHeight\r\n    const canvas = createElement('canvas', {\r\n      width: `${width}px`,\r\n      height: `${height}px`\r\n    })\r\n    const ctx = canvas.getContext('2d')\r\n    const pixelRatio = getPixelRatio(canvas)\r\n    canvas.width = width * pixelRatio\r\n    canvas.height = height * pixelRatio\r\n    ctx.scale(pixelRatio, pixelRatio)\r\n\r\n    const mainWidgetElement = this._mainWidget.getElement()\r\n    const mainWidgetWidth = mainWidgetElement.offsetWidth\r\n    const mainWidgetHeight = mainWidgetElement.offsetHeight\r\n    const mainWidgetOffsetLeft = parseInt(mainWidgetElement.style.left, 10)\r\n\r\n    ctx.drawImage(\r\n      this._mainWidget.getImage(includeOverlay),\r\n      mainWidgetOffsetLeft, 0,\r\n      mainWidgetWidth, mainWidgetHeight\r\n    )\r\n    if (this._yAxisWidget) {\r\n      const yAxisWidgetElement = this._yAxisWidget.getElement()\r\n      const yAxisWidgetWidth = yAxisWidgetElement.offsetWidth\r\n      const yAxisWidgetHeight = yAxisWidgetElement.offsetHeight\r\n      const yAxisWidgetOffsetLeft = parseInt(yAxisWidgetElement.style.left, 10)\r\n      ctx.drawImage(\r\n        this._yAxisWidget.getImage(includeOverlay),\r\n        yAxisWidgetOffsetLeft, 0,\r\n        yAxisWidgetWidth, yAxisWidgetHeight\r\n      )\r\n    }\r\n    return canvas\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy () {\r\n    this._container.removeChild(this._element)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { InvalidateLevel } from '../data/constants'\r\nimport { getPixelRatio } from '../utils/canvas'\r\nimport { createElement } from '../utils/element'\r\n\r\nexport default class Widget {\r\n  constructor (props) {\r\n    this._width = 0\r\n    this._height = 0\r\n    this._initElement(props.container)\r\n    this._mainView = this._createMainView(this._element, props)\r\n    this._overlayView = this._createOverlayView(this._element, props)\r\n  }\r\n\r\n  /**\r\n   * 初始化element\r\n   * @param container\r\n   * @private\r\n   */\r\n  _initElement (container) {\r\n    this._element = createElement('div', {\r\n      margin: '0',\r\n      padding: '0',\r\n      position: 'absolute',\r\n      top: '0',\r\n      overflow: 'hidden'\r\n    })\r\n    container.appendChild(this._element)\r\n  }\r\n\r\n  /**\r\n   * 创建主view\r\n   * @param container\r\n   * @param props\r\n   * @private\r\n   */\r\n  _createMainView (container, props) {}\r\n\r\n  /**\r\n   * 创建浮层view\r\n   * @param container\r\n   * @param props\r\n   * @private\r\n   */\r\n  _createOverlayView (container, props) {}\r\n\r\n  getElement () {\r\n    return this._element\r\n  }\r\n\r\n  setWidth (width) {\r\n    this._width = width\r\n    this._mainView.setWidth(width)\r\n    this._overlayView.setWidth(width)\r\n  }\r\n\r\n  setHeight (height) {\r\n    this._height = height\r\n    this._mainView.setHeight(height)\r\n    this._overlayView.setHeight(height)\r\n  }\r\n\r\n  setOffsetLeft (offsetLeft) {\r\n    this._element.style.left = `${offsetLeft}px`\r\n  }\r\n\r\n  layout () {\r\n    if (this._element.offsetWidth !== this._width) {\r\n      this._element.style.width = `${this._width}px`\r\n    }\r\n    if (this._element.offsetHeight !== this._height) {\r\n      this._element.style.height = `${this._height}px`\r\n    }\r\n    this._mainView.layout()\r\n    this._overlayView.layout()\r\n  }\r\n\r\n  /**\r\n   * 更新\r\n   * @param level\r\n   */\r\n  invalidate (level) {\r\n    switch (level) {\r\n      case InvalidateLevel.OVERLAY: {\r\n        this._overlayView.flush()\r\n        break\r\n      }\r\n      case InvalidateLevel.MAIN:\r\n      case InvalidateLevel.FULL: {\r\n        this._mainView.flush()\r\n        this._overlayView.flush()\r\n        break\r\n      }\r\n      default: {\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 将widget转换成图片\r\n   * @param includeOverlay\r\n   * @returns {HTMLCanvasElement}\r\n   */\r\n  getImage (includeOverlay) {\r\n    const canvas = createElement('canvas', {\r\n      width: `${this._width}px`,\r\n      height: `${this._height}px`\r\n    })\r\n    const ctx = canvas.getContext('2d')\r\n    const pixelRatio = getPixelRatio(canvas)\r\n    canvas.width = this._width * pixelRatio\r\n    canvas.height = this._height * pixelRatio\r\n    ctx.scale(pixelRatio, pixelRatio)\r\n\r\n    ctx.drawImage(this._mainView.getImage(), 0, 0, this._width, this._height)\r\n\r\n    if (includeOverlay && this._overlayView) {\r\n      ctx.drawImage(this._overlayView.getImage(), 0, 0, this._width, this._height)\r\n    }\r\n    return canvas\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * requestAnimationFrame兼容\r\n * @param fn\r\n */\r\nexport function requestAnimationFrame (fn) {\r\n  if (!window.requestAnimationFrame) {\r\n    return window.setTimeout(fn, 20)\r\n  }\r\n  return window.requestAnimationFrame(fn)\r\n}\r\n\r\n/**\r\n * cancelAnimationFrame兼容\r\n * @param id\r\n */\r\nexport function cancelAnimationFrame (id) {\r\n  if (!window.cancelAnimationFrame) {\r\n    clearTimeout(id)\r\n  }\r\n  window.cancelAnimationFrame(id)\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { getPixelRatio } from '../utils/canvas'\r\nimport { createElement } from '../utils/element'\r\nimport { cancelAnimationFrame, requestAnimationFrame } from '../utils/compatible'\r\n\r\nclass View {\r\n  constructor (container, chartData) {\r\n    this._chartData = chartData\r\n    this._initCanvas(container)\r\n  }\r\n\r\n  /**\r\n   * 初始化画布\r\n   * @param container\r\n   * @private\r\n   */\r\n  _initCanvas (container) {\r\n    this._canvas = createElement('canvas', {\r\n      position: 'absolute',\r\n      top: '0',\r\n      left: '0',\r\n      zIndex: '2'\r\n    })\r\n    this._ctx = this._canvas.getContext('2d')\r\n    container.appendChild(this._canvas)\r\n  }\r\n\r\n  /**\r\n   * 重新绘制\r\n   * @param extendFun\r\n   * @private\r\n   */\r\n  _redraw (extendFun) {\r\n    this._ctx.clearRect(0, 0, this._canvas.offsetWidth, this._canvas.offsetHeight)\r\n    extendFun && extendFun()\r\n    this._draw()\r\n  }\r\n\r\n  /**\r\n   * 绘制\r\n   */\r\n  _draw () {\r\n  }\r\n\r\n  setWidth (width) {\r\n    this._width = width\r\n  }\r\n\r\n  setHeight (height) {\r\n    this._height = height\r\n  }\r\n\r\n  layout () {\r\n    if (this._height !== this._canvas.offsetHeight || this._width !== this._canvas.offsetWidth) {\r\n      this._redraw(() => {\r\n        const pixelRatio = getPixelRatio(this._canvas)\r\n        this._canvas.style.width = `${this._width}px`\r\n        this._canvas.style.height = `${this._height}px`\r\n        this._canvas.width = Math.floor(this._width * pixelRatio)\r\n        this._canvas.height = Math.floor(this._height * pixelRatio)\r\n        this._ctx.scale(pixelRatio, pixelRatio)\r\n      })\r\n    } else {\r\n      this.flush()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 刷新\r\n   */\r\n  flush () {\r\n    if (this.requestAnimationId) {\r\n      cancelAnimationFrame(this.requestAnimationId)\r\n      this.requestAnimationId = null\r\n    }\r\n    this.requestAnimationId = requestAnimationFrame(() => {\r\n      this._redraw()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取图片\r\n   * @returns {HTMLCanvasElement}\r\n   */\r\n  getImage () {\r\n    return this._canvas\r\n  }\r\n}\r\n\r\nexport default View\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport View from './View'\r\n\r\nimport { CandleType, LineStyle } from '../options/styleOptions'\r\nimport { TechnicalIndicatorPlotType } from '../component/technicalindicator/TechnicalIndicator'\r\nimport { renderHorizontalLine, renderVerticalLine, renderLine } from '../renderer/line'\r\nimport { isValid } from '../utils/typeChecks'\r\n\r\nexport default class TechnicalIndicatorView extends View {\r\n  constructor (container, chartData, xAxis, yAxis, paneId) {\r\n    super(container, chartData)\r\n    this._xAxis = xAxis\r\n    this._yAxis = yAxis\r\n    this._paneId = paneId\r\n  }\r\n\r\n  _draw () {\r\n    this._ctx.globalCompositeOperation = 'destination-over'\r\n    this._drawContent()\r\n  }\r\n\r\n  _drawContent () {\r\n    this._drawTechs()\r\n    this._drawGrid()\r\n  }\r\n\r\n  /**\r\n   * 绘制网格\r\n   */\r\n  _drawGrid () {\r\n    const gridOptions = this._chartData.styleOptions().grid\r\n    if (!gridOptions.show) {\r\n      return\r\n    }\r\n    const gridHorizontalOptions = gridOptions.horizontal\r\n    this._ctx.save()\r\n    if (gridHorizontalOptions.show) {\r\n      this._ctx.strokeStyle = gridHorizontalOptions.color\r\n      this._ctx.lineWidth = gridHorizontalOptions.size\r\n      if (gridHorizontalOptions.style === LineStyle.DASH) {\r\n        this._ctx.setLineDash(gridHorizontalOptions.dashValue)\r\n      } else {\r\n        this._ctx.setLineDash([])\r\n      }\r\n      this._yAxis.ticks().forEach(tick => {\r\n        renderHorizontalLine(this._ctx, tick.y, 0, this._width)\r\n      })\r\n    }\r\n\r\n    const gridVerticalOptions = gridOptions.vertical\r\n    if (gridVerticalOptions.show) {\r\n      this._ctx.strokeStyle = gridVerticalOptions.color\r\n      this._ctx.lineWidth = gridVerticalOptions.size\r\n      if (gridVerticalOptions.style === LineStyle.DASH) {\r\n        this._ctx.setLineDash(gridVerticalOptions.dashValue)\r\n      } else {\r\n        this._ctx.setLineDash([])\r\n      }\r\n      this._xAxis.ticks().forEach(tick => {\r\n        renderVerticalLine(this._ctx, tick.x, 0, this._height)\r\n      })\r\n    }\r\n    this._ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制指标\r\n   */\r\n  _drawTechs () {\r\n    this._ctx.globalCompositeOperation = 'source-over'\r\n    const techOptions = this._chartData.styleOptions().technicalIndicator\r\n    const techs = this._chartData.technicalIndicatorStore().instances(this._paneId)\r\n    techs.forEach(tech => {\r\n      const plots = tech.plots\r\n      const lines = []\r\n      const dataList = this._chartData.dataList()\r\n      const techResult = tech.result\r\n      const styles = tech.styles || techOptions\r\n      // 技术指标自定义绘制\r\n      if (tech.render) {\r\n        this._ctx.save()\r\n        tech.render({\r\n          ctx: this._ctx,\r\n          dataSource: {\r\n            from: this._chartData.timeScaleStore().from(),\r\n            to: this._chartData.timeScaleStore().to(),\r\n            kLineDataList: this._chartData.dataList(),\r\n            technicalIndicatorDataList: techResult\r\n          },\r\n          viewport: {\r\n            width: this._width,\r\n            height: this._height,\r\n            dataSpace: this._chartData.timeScaleStore().dataSpace(),\r\n            barSpace: this._chartData.timeScaleStore().barSpace()\r\n          },\r\n          styles,\r\n          xAxis: this._xAxis,\r\n          yAxis: this._yAxis\r\n        })\r\n        this._ctx.restore()\r\n      }\r\n      const isCandleYAxis = this._yAxis.isCandleYAxis()\r\n\r\n      this._ctx.lineWidth = 1\r\n      this._drawGraphics(\r\n        (x, i, kLineData, halfBarSpace, barSpace) => {\r\n          const techData = techResult[i] || {}\r\n          let lineValueIndex = 0\r\n          if (tech.shouldOhlc && !isCandleYAxis) {\r\n            this._drawCandleBar(x, halfBarSpace, barSpace, i, kLineData, styles.bar, CandleType.OHLC)\r\n          }\r\n          plots.forEach(plot => {\r\n            const value = techData[plot.key]\r\n            const valueY = this._yAxis.convertToPixel(value)\r\n            switch (plot.type) {\r\n              case TechnicalIndicatorPlotType.CIRCLE: {\r\n                if (isValid(value)) {\r\n                  const cbData = {\r\n                    prev: { kLineData: dataList[i - 1], technicalIndicatorData: techResult[i - 1] },\r\n                    current: { kLineData, technicalIndicatorData: techData },\r\n                    next: { kLineData: dataList[i + 1], technicalIndicatorData: techResult[i + 1] }\r\n                  }\r\n                  this._drawCircle({\r\n                    x,\r\n                    y: valueY,\r\n                    radius: halfBarSpace,\r\n                    color: (plot.color && plot.color(cbData, styles)) || styles.circle.noChangeColor,\r\n                    isStroke: plot.isStroke ? plot.isStroke(cbData) : true\r\n                  })\r\n                }\r\n                break\r\n              }\r\n              case TechnicalIndicatorPlotType.BAR: {\r\n                if (isValid(value)) {\r\n                  const cbData = {\r\n                    prev: { kLineData: dataList[i - 1], technicalIndicatorData: techResult[i - 1] },\r\n                    current: { kLineData, technicalIndicatorData: techData },\r\n                    next: { kLineData: dataList[i + 1], technicalIndicatorData: techResult[i + 1] }\r\n                  }\r\n                  let baseValue\r\n                  if (isValid(plot.baseValue)) {\r\n                    baseValue = plot.baseValue\r\n                  } else {\r\n                    baseValue = this._yAxis.min()\r\n                  }\r\n                  const baseValueY = this._yAxis.convertToPixel(baseValue)\r\n                  const height = Math.abs(baseValueY - valueY)\r\n                  const bar = {\r\n                    x: x - halfBarSpace,\r\n                    width: halfBarSpace * 2,\r\n                    height: Math.max(1, height)\r\n                  }\r\n                  if (valueY > baseValueY) {\r\n                    bar.y = baseValueY\r\n                  } else {\r\n                    bar.y = height < 1 ? baseValueY - 1 : valueY\r\n                  }\r\n                  bar.color = (plot.color && plot.color(cbData, styles)) || styles.bar.noChangeColor\r\n                  bar.isStroke = plot.isStroke ? plot.isStroke(cbData) : false\r\n                  this._drawBar(bar)\r\n                }\r\n                break\r\n              }\r\n              case TechnicalIndicatorPlotType.LINE: {\r\n                let line = null\r\n                if (isValid(value)) {\r\n                  line = { x: x, y: valueY }\r\n                }\r\n                if (lines[lineValueIndex]) {\r\n                  lines[lineValueIndex].push(line)\r\n                } else {\r\n                  lines[lineValueIndex] = [line]\r\n                }\r\n                lineValueIndex++\r\n                break\r\n              }\r\n              default: { break }\r\n            }\r\n          })\r\n        },\r\n        () => {\r\n          this._drawLines(lines, styles)\r\n        }\r\n      )\r\n    })\r\n    this._ctx.globalCompositeOperation = 'destination-over'\r\n  }\r\n\r\n  /**\r\n   * 绘制图形\r\n   * @param onDrawing\r\n   * @param onDrawEnd\r\n   */\r\n  _drawGraphics (onDrawing, onDrawEnd) {\r\n    const visibleDataList = this._chartData.visibleDataList()\r\n    const barSpace = this._chartData.timeScaleStore().barSpace()\r\n    const halfBarSpace = this._chartData.timeScaleStore().halfBarSpace()\r\n    visibleDataList.forEach(({ x, index, data }, n) => {\r\n      onDrawing(x, index, data, halfBarSpace, barSpace, n)\r\n    })\r\n    onDrawEnd && onDrawEnd()\r\n  }\r\n\r\n  /**\r\n   * 绘制线\r\n   * @param lines\r\n   * @param techOptions\r\n   */\r\n  _drawLines (lines, techOptions) {\r\n    const colors = techOptions.line.colors || []\r\n    const colorSize = colors.length\r\n    this._ctx.lineWidth = techOptions.line.size\r\n\r\n    lines.forEach((coordinates, i) => {\r\n      this._ctx.strokeStyle = colors[i % colorSize]\r\n      renderLine(this._ctx, coordinates)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 绘制柱\r\n   */\r\n  _drawBar (bar) {\r\n    if (bar.isStroke) {\r\n      this._ctx.strokeStyle = bar.color\r\n      this._ctx.strokeRect(bar.x + 0.5, bar.y, bar.width - 1, bar.height)\r\n    } else {\r\n      this._ctx.fillStyle = bar.color\r\n      this._ctx.fillRect(bar.x, bar.y, bar.width, bar.height)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制圆点\r\n   * @param circle\r\n   * @private\r\n   */\r\n  _drawCircle (circle) {\r\n    this._ctx.strokeStyle = circle.color\r\n    this._ctx.fillStyle = circle.color\r\n    this._ctx.beginPath()\r\n    this._ctx.arc(circle.x, circle.y, circle.radius, Math.PI * 2, 0, true)\r\n    if (circle.isStroke) {\r\n      this._ctx.stroke()\r\n    } else {\r\n      this._ctx.fill()\r\n    }\r\n    this._ctx.closePath()\r\n  }\r\n\r\n  /**\r\n   * 绘制蜡烛柱\r\n   * @param x\r\n   * @param halfBarSpace\r\n   * @param barSpace\r\n   * @param dataIndex\r\n   * @param kLineData\r\n   * @param barOptions\r\n   * @param barStyle\r\n   */\r\n  _drawCandleBar (x, halfBarSpace, barSpace, dataIndex, kLineData, barOptions, barStyle) {\r\n    const { open, close, high, low } = kLineData\r\n    if (close > open) {\r\n      this._ctx.strokeStyle = barOptions.upColor\r\n      this._ctx.fillStyle = barOptions.upColor\r\n    } else if (close < open) {\r\n      this._ctx.strokeStyle = barOptions.downColor\r\n      this._ctx.fillStyle = barOptions.downColor\r\n    } else {\r\n      this._ctx.strokeStyle = barOptions.noChangeColor\r\n      this._ctx.fillStyle = barOptions.noChangeColor\r\n    }\r\n    const openY = this._yAxis.convertToPixel(open)\r\n    const closeY = this._yAxis.convertToPixel(close)\r\n    const highY = this._yAxis.convertToPixel(high)\r\n    const lowY = this._yAxis.convertToPixel(low)\r\n\r\n    const highEndY = Math.min(openY, closeY)\r\n    const lowStartY = Math.max(openY, closeY)\r\n    this._ctx.fillRect(x - 0.5, highY, 1, highEndY - highY)\r\n    this._ctx.fillRect(x - 0.5, lowStartY, 1, lowY - lowStartY)\r\n\r\n    const barHeight = Math.max(1, lowStartY - highEndY)\r\n    switch (barStyle) {\r\n      case CandleType.CANDLE_SOLID: {\r\n        this._ctx.fillRect(x - halfBarSpace, highEndY, barSpace, barHeight)\r\n        break\r\n      }\r\n      case CandleType.CANDLE_STROKE: {\r\n        this._ctx.strokeRect(x - halfBarSpace + 0.5, highEndY, barSpace - 1, barHeight)\r\n        break\r\n      }\r\n      case CandleType.CANDLE_UP_STROKE: {\r\n        if (close > open) {\r\n          this._ctx.strokeRect(x - halfBarSpace + 0.5, highEndY, barSpace - 1, barHeight)\r\n        } else {\r\n          this._ctx.fillRect(x - halfBarSpace, highEndY, barSpace, barHeight)\r\n        }\r\n        break\r\n      }\r\n      case CandleType.CANDLE_DOWN_STROKE: {\r\n        if (close > open) {\r\n          this._ctx.fillRect(x - halfBarSpace, highEndY, barSpace, barHeight)\r\n        } else {\r\n          this._ctx.strokeRect(x - halfBarSpace + 0.5, highEndY, barSpace - 1, barHeight)\r\n        }\r\n        break\r\n      }\r\n      default: {\r\n        this._ctx.fillRect(x - 0.5, highY, 1, lowY - highY)\r\n        this._ctx.fillRect(x - halfBarSpace, openY - 0.5, halfBarSpace, 1)\r\n        this._ctx.fillRect(x, closeY - 0.5, halfBarSpace, 1)\r\n        break\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 绘制文字\r\n * @param ctx\r\n * @param color\r\n * @param x\r\n * @param y\r\n * @param text\r\n */\r\nexport function renderText (ctx, color, x, y, text) {\r\n  ctx.fillStyle = color\r\n  ctx.fillText(text, x, y)\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport View from './View'\r\nimport { TooltipShowRule, LineStyle } from '../options/styleOptions'\r\nimport { TechnicalIndicatorPlotType } from '../component/technicalindicator/TechnicalIndicator'\r\nimport { isValid } from '../utils/typeChecks'\r\nimport { renderHorizontalLine, renderVerticalLine } from '../renderer/line'\r\nimport { calcTextWidth, createFont } from '../utils/canvas'\r\nimport { getTechnicalIndicatorTooltipData } from '../data/store/TechnicalIndicatorStore'\r\nimport { renderText } from '../renderer/text'\r\n\r\nexport default class TechnicalIndicatorOverlayView extends View {\r\n  constructor (container, chartData, xAxis, yAxis, paneId) {\r\n    super(container, chartData)\r\n    this._xAxis = xAxis\r\n    this._yAxis = yAxis\r\n    this._paneId = paneId\r\n  }\r\n\r\n  _draw () {\r\n    this._ctx.textBaseline = 'alphabetic'\r\n    this._drawTag()\r\n    this._drawShape()\r\n    this._drawAnnotation()\r\n    const crosshair = this._chartData.crosshairStore().get()\r\n    if (crosshair.kLineData) {\r\n      const styleOptions = this._chartData.styleOptions()\r\n      const crosshairOptions = styleOptions.crosshair\r\n      if (crosshair.paneId === this._paneId) {\r\n        // 绘制十字光标水平线\r\n        this._drawCrosshairLine(crosshairOptions, 'horizontal', crosshair.y, 0, this._width, renderHorizontalLine)\r\n      }\r\n      if (crosshair.paneId) {\r\n        // 绘制十字光标垂直线\r\n        this._drawCrosshairLine(crosshairOptions, 'vertical', crosshair.realX, 0, this._height, renderVerticalLine)\r\n      }\r\n      this._drawTooltip(crosshair, this._chartData.technicalIndicatorStore().instances(this._paneId))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制注解\r\n   */\r\n  _drawAnnotation () {\r\n    const annotations = this._chartData.annotationStore().get(this._paneId)\r\n    if (annotations) {\r\n      annotations.forEach(annotation => {\r\n        annotation.draw(this._ctx)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制标签\r\n   */\r\n  _drawTag () {\r\n    const tags = this._chartData.tagStore().get(this._paneId)\r\n    if (tags) {\r\n      tags.forEach(tag => {\r\n        tag.drawMarkLine(this._ctx)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制图形标记\r\n   * @private\r\n   */\r\n  _drawShape () {\r\n    this._chartData.shapeStore().instances(this._paneId).forEach(shape => {\r\n      shape.draw(this._ctx)\r\n    })\r\n    const progressShape = this._chartData.shapeStore().progressInstance()\r\n    if (progressShape.paneId === this._paneId) {\r\n      progressShape.instance.draw(this._ctx)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制图例\r\n   * @param crosshair\r\n   * @param techs\r\n   * @private\r\n   */\r\n  _drawTooltip (crosshair, techs) {\r\n    const techOptions = this._chartData.styleOptions().technicalIndicator\r\n    this._drawBatchTechToolTip(\r\n      crosshair,\r\n      techs,\r\n      techOptions,\r\n      0,\r\n      this._shouldDrawTooltip(crosshair, techOptions.tooltip)\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 绘制十字光标线\r\n   * @param crosshairOptions\r\n   * @param optionsKey\r\n   * @param fixed\r\n   * @param start\r\n   * @param end\r\n   * @param drawLine\r\n   * @private\r\n   */\r\n  _drawCrosshairLine (crosshairOptions, optionsKey, fixed, start, end, drawLine) {\r\n    const crosshairDirectionOptions = crosshairOptions[optionsKey]\r\n    const crosshairLineOptions = crosshairDirectionOptions.line\r\n    if (!crosshairOptions.show || !crosshairDirectionOptions.show || !crosshairLineOptions.show) {\r\n      return\r\n    }\r\n    this._ctx.save()\r\n    this._ctx.lineWidth = crosshairLineOptions.size\r\n    this._ctx.strokeStyle = crosshairLineOptions.color\r\n\r\n    if (crosshairLineOptions.style === LineStyle.DASH) {\r\n      this._ctx.setLineDash(crosshairLineOptions.dashValue)\r\n    }\r\n    drawLine(this._ctx, fixed, start, end)\r\n    this._ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 批量绘制技术指标提示\r\n   * @param crosshair\r\n   * @param techs\r\n   * @param techOptions\r\n   * @param offsetTop\r\n   * @param isDrawTechTooltip\r\n   */\r\n  _drawBatchTechToolTip (crosshair, techs, techOptions, offsetTop = 0, isDrawTechTooltip) {\r\n    if (!isDrawTechTooltip) {\r\n      return\r\n    }\r\n    const techTooltipOptions = techOptions.tooltip\r\n    let top = offsetTop\r\n    techs.forEach(tech => {\r\n      this._drawTechTooltip(crosshair, tech, techOptions, top)\r\n      top += (\r\n        techTooltipOptions.text.marginTop +\r\n        techTooltipOptions.text.size +\r\n        techTooltipOptions.text.marginBottom\r\n      )\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 绘制指标图例\r\n   * @param crosshair\r\n   * @param tech\r\n   * @param techOptions\r\n   * @param offsetTop\r\n   * @private\r\n   */\r\n  _drawTechTooltip (crosshair, tech, techOptions, offsetTop = 0) {\r\n    const techTooltipOptions = techOptions.tooltip\r\n    const styles = tech.styles || techOptions\r\n    const techResult = tech.result\r\n    const techData = techResult[crosshair.dataIndex]\r\n    const tooltipData = getTechnicalIndicatorTooltipData(techData, tech)\r\n    const colors = styles.line.colors\r\n    const dataList = this._chartData.dataList()\r\n    const cbData = {\r\n      prev: { kLineData: dataList[crosshair.dataIndex - 1], technicalIndicatorData: techResult[crosshair.dataIndex - 1] },\r\n      current: { kLineData: dataList[crosshair.dataIndex], technicalIndicatorData: techData },\r\n      next: { kLineData: dataList[crosshair.dataIndex + 1], technicalIndicatorData: techResult[crosshair.dataIndex + 1] }\r\n    }\r\n    const plots = tech.plots\r\n    const techTooltipTextOptions = techTooltipOptions.text\r\n    const values = tooltipData.values\r\n    const textMarginLeft = techTooltipTextOptions.marginLeft\r\n    const textMarginRight = techTooltipTextOptions.marginRight\r\n    let labelX = 0\r\n    const labelY = techTooltipTextOptions.marginTop + offsetTop\r\n    const textSize = techTooltipTextOptions.size\r\n    const textColor = techTooltipTextOptions.color\r\n    const colorSize = colors.length\r\n    this._ctx.textBaseline = 'top'\r\n    this._ctx.font = createFont(textSize, techTooltipTextOptions.weight, techTooltipTextOptions.family)\r\n\r\n    if (techTooltipOptions.showName) {\r\n      const nameText = tooltipData.name\r\n      const nameTextWidth = calcTextWidth(this._ctx, nameText)\r\n      labelX += textMarginLeft\r\n      renderText(this._ctx, textColor, labelX, labelY, nameText)\r\n      labelX += nameTextWidth\r\n      if (!techTooltipOptions.showParams) {\r\n        labelX += textMarginRight\r\n      }\r\n    }\r\n    if (techTooltipOptions.showParams) {\r\n      const calcParamText = tooltipData.calcParamText\r\n      const calcParamTextWidth = calcTextWidth(this._ctx, calcParamText)\r\n      if (!techTooltipOptions.showName) {\r\n        labelX += textMarginLeft\r\n      }\r\n      renderText(this._ctx, textColor, labelX, labelY, calcParamText)\r\n      labelX += (calcParamTextWidth + textMarginRight)\r\n    }\r\n    let lineCount = 0\r\n    let valueColor\r\n    plots.forEach((plot, i) => {\r\n      switch (plot.type) {\r\n        case TechnicalIndicatorPlotType.CIRCLE: {\r\n          valueColor = (plot.color && plot.color(cbData, styles)) || styles.circle.noChangeColor\r\n          break\r\n        }\r\n        case TechnicalIndicatorPlotType.BAR: {\r\n          valueColor = (plot.color && plot.color(cbData, styles)) || styles.bar.noChangeColor\r\n          break\r\n        }\r\n        case TechnicalIndicatorPlotType.LINE: {\r\n          valueColor = colors[lineCount % colorSize] || textColor\r\n          lineCount++\r\n          break\r\n        }\r\n        default: { break }\r\n      }\r\n      const title = values[i].title\r\n      if (isValid(title)) {\r\n        labelX += textMarginLeft\r\n        const text = `${title}${values[i].value || techTooltipTextOptions.defaultValue}`\r\n        const textWidth = calcTextWidth(this._ctx, text)\r\n        renderText(this._ctx, valueColor, labelX, labelY, text)\r\n        labelX += (textWidth + textMarginRight)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 是否需要绘制图例\r\n   * @param crosshair\r\n   * @param tooltipOptions\r\n   * @return {boolean|boolean|*}\r\n   */\r\n  _shouldDrawTooltip (crosshair, tooltipOptions) {\r\n    const showRule = tooltipOptions.showRule\r\n    return showRule === TooltipShowRule.ALWAYS ||\r\n      (showRule === TooltipShowRule.FOLLOW_CROSS && (!!crosshair.paneId))\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Widget from './Widget'\r\nimport TechnicalIndicatorView from '../view/TechnicalIndicatorView'\r\nimport TechnicalIndicatorOverlayView from '../view/TechnicalIndicatorOverlayView'\r\n\r\nexport default class TechnicalIndicatorWidget extends Widget {\r\n  _createMainView (container, props) {\r\n    return new TechnicalIndicatorView(container, props.chartData, props.xAxis, props.yAxis, props.paneId)\r\n  }\r\n\r\n  _createOverlayView (container, props) {\r\n    return new TechnicalIndicatorOverlayView(container, props.chartData, props.xAxis, props.yAxis, props.paneId)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 绘制带边框的圆角填充矩形\r\n * @param ctx\r\n * @param fillColor\r\n * @param borderColor\r\n * @param borderSize\r\n * @param x\r\n * @param y\r\n * @param width\r\n * @param height\r\n * @param borderRadius\r\n */\r\nexport function renderStrokeFillRoundRect (\r\n  ctx, fillColor, borderColor, borderSize,\r\n  x, y, width, height, borderRadius\r\n) {\r\n  renderFillRoundRect(ctx, fillColor, x, y, width, height, borderRadius)\r\n  renderStrokeRoundRect(ctx, borderColor, borderSize, x, y, width, height, borderRadius)\r\n}\r\n\r\n/**\r\n * 绘制填充的矩形\r\n * @param ctx\r\n * @param color\r\n * @param x\r\n * @param y\r\n * @param width\r\n * @param height\r\n */\r\nexport function renderFillRect (ctx, color, x, y, width, height) {\r\n  ctx.fillStyle = color\r\n  ctx.fillRect(x, y, width, height)\r\n}\r\n\r\n/**\r\n * 绘制圆角空心矩形\r\n * @param ctx\r\n * @param borderColor\r\n * @param borderSize\r\n * @param x\r\n * @param y\r\n * @param w\r\n * @param h\r\n * @param r\r\n */\r\nexport function renderStrokeRoundRect (ctx, borderColor, borderSize, x, y, w, h, r) {\r\n  ctx.lineWidth = borderSize\r\n  ctx.strokeStyle = borderColor\r\n  renderRoundRect(ctx, x, y, w, h, r)\r\n  ctx.stroke()\r\n}\r\n\r\n/**\r\n * 绘制填充圆角矩形\r\n * @param ctx\r\n * @param color\r\n * @param x\r\n * @param y\r\n * @param w\r\n * @param h\r\n * @param r\r\n */\r\nexport function renderFillRoundRect (ctx, color, x, y, w, h, r) {\r\n  ctx.fillStyle = color\r\n  renderRoundRect(ctx, x, y, w, h, r)\r\n  ctx.fill()\r\n}\r\n\r\n/**\r\n * 绘制圆角矩形\r\n * @param ctx\r\n * @param x\r\n * @param y\r\n * @param w\r\n * @param h\r\n * @param r\r\n */\r\nexport function renderRoundRect (ctx, x, y, w, h, r) {\r\n  ctx.beginPath()\r\n  ctx.moveTo(x + r, y)\r\n  ctx.arcTo(x + w, y, x + w, y + h, r)\r\n  ctx.arcTo(x + w, y + h, x, y + h, r)\r\n  ctx.arcTo(x, y + h, x, y, r)\r\n  ctx.arcTo(x, y, x + w, y, r)\r\n  ctx.closePath()\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport View from './View'\r\nimport { YAxisType } from '../options/styleOptions'\r\nimport { TechnicalIndicatorPlotType } from '../component/technicalindicator/TechnicalIndicator'\r\nimport { calcTextWidth, createFont } from '../utils/canvas'\r\nimport { renderHorizontalLine, renderVerticalLine } from '../renderer/line'\r\nimport { formatBigNumber, formatPrecision } from '../utils/format'\r\nimport { isValid } from '../utils/typeChecks'\r\nimport { renderFillRoundRect } from '../renderer/rect'\r\nimport { renderText } from '../renderer/text'\r\n\r\nexport default class YAxisView extends View {\r\n  constructor (container, chartData, yAxis, paneId) {\r\n    super(container, chartData)\r\n    this._yAxis = yAxis\r\n    this._paneId = paneId\r\n  }\r\n\r\n  _draw () {\r\n    const yAxisOptions = this._chartData.styleOptions().yAxis\r\n    if (yAxisOptions.show) {\r\n      this._drawAxisLine(yAxisOptions)\r\n      this._drawTickLines(yAxisOptions)\r\n      this._drawTickLabels(yAxisOptions)\r\n      this._drawTechLastValue()\r\n      this._drawLastPriceLabel()\r\n    }\r\n  }\r\n\r\n  _drawAxisLine (yAxisOptions) {\r\n    const axisLine = yAxisOptions.axisLine\r\n    if (!axisLine.show) {\r\n      return\r\n    }\r\n    this._ctx.strokeStyle = axisLine.color\r\n    this._ctx.lineWidth = axisLine.size\r\n    let x\r\n    if (this._yAxis.isFromYAxisZero()) {\r\n      x = 0\r\n    } else {\r\n      x = this._width - 1\r\n    }\r\n    renderVerticalLine(this._ctx, x, 0, this._height)\r\n  }\r\n\r\n  _drawTickLines (yAxisOptions) {\r\n    const tickLine = yAxisOptions.tickLine\r\n    if (!tickLine.show) {\r\n      return\r\n    }\r\n    this._ctx.lineWidth = tickLine.size\r\n    this._ctx.strokeStyle = tickLine.color\r\n\r\n    const tickLineLength = tickLine.length\r\n\r\n    let startX\r\n    let endX\r\n    if (this._yAxis.isFromYAxisZero()) {\r\n      startX = 0\r\n      if (yAxisOptions.axisLine.show) {\r\n        startX += yAxisOptions.axisLine.size\r\n      }\r\n      endX = startX + tickLineLength\r\n    } else {\r\n      startX = this._width\r\n      if (yAxisOptions.axisLine.show) {\r\n        startX -= yAxisOptions.axisLine.size\r\n      }\r\n      endX = startX - tickLineLength\r\n    }\r\n    this._yAxis.ticks().forEach(tick => {\r\n      renderHorizontalLine(this._ctx, tick.y, startX, endX)\r\n    })\r\n  }\r\n\r\n  _drawTickLabels (yAxisOptions) {\r\n    const tickText = yAxisOptions.tickText\r\n    if (!tickText.show) {\r\n      return\r\n    }\r\n    const tickLine = yAxisOptions.tickLine\r\n    const tickLineShow = tickLine.show\r\n    const tickLineLength = tickLine.length\r\n    let labelX\r\n    if (this._yAxis.isFromYAxisZero()) {\r\n      labelX = tickText.paddingLeft\r\n      if (yAxisOptions.axisLine.show) {\r\n        labelX += yAxisOptions.axisLine.size\r\n      }\r\n      if (tickLineShow) {\r\n        labelX += tickLineLength\r\n      }\r\n      this._ctx.textAlign = 'left'\r\n    } else {\r\n      labelX = this._width - tickText.paddingRight\r\n      if (yAxisOptions.axisLine.show) {\r\n        labelX -= yAxisOptions.axisLine.size\r\n      }\r\n      if (tickLineShow) {\r\n        labelX -= tickLineLength\r\n      }\r\n      this._ctx.textAlign = 'right'\r\n    }\r\n    this._ctx.textBaseline = 'middle'\r\n    this._ctx.font = createFont(tickText.size, tickText.weight, tickText.family)\r\n    this._ctx.fillStyle = tickText.color\r\n    this._yAxis.ticks().forEach(tick => {\r\n      this._ctx.fillText(tick.v, labelX, tick.y)\r\n    })\r\n    this._ctx.textAlign = 'left'\r\n  }\r\n\r\n  /**\r\n   * 绘制技术指标最后值\r\n   * @private\r\n   */\r\n  _drawTechLastValue () {\r\n    const techOptions = this._chartData.styleOptions().technicalIndicator\r\n    const lastValueMarkOptions = techOptions.lastValueMark\r\n    if (!lastValueMarkOptions.show || !lastValueMarkOptions.text.show) {\r\n      return\r\n    }\r\n    const techs = this._chartData.technicalIndicatorStore().instances(this._paneId)\r\n    const dataList = this._chartData.dataList()\r\n    techs.forEach(tech => {\r\n      const techResult = tech.result || []\r\n      const dataSize = techResult.length\r\n      const techData = techResult[dataSize - 1] || {}\r\n      const plots = tech.plots\r\n      const cbData = {\r\n        prev: { kLineData: dataList[dataSize - 2], technicalIndicatorData: techResult[dataSize - 2] },\r\n        current: { kLineData: dataList[dataSize - 1], technicalIndicatorData: techData },\r\n        next: { kLineData: null, technicalIndicatorData: null }\r\n      }\r\n      const precision = tech.precision\r\n      const styles = tech.styles || techOptions\r\n      const colors = styles.line.colors || []\r\n      const colorSize = colors.length\r\n      let lineCount = 0\r\n      plots.forEach(plot => {\r\n        const value = techData[plot.key]\r\n        let backgroundColor\r\n        switch (plot.type) {\r\n          case TechnicalIndicatorPlotType.CIRCLE: {\r\n            backgroundColor = (plot.color && plot.color(cbData, styles)) || styles.circle.noChangeColor\r\n            break\r\n          }\r\n          case TechnicalIndicatorPlotType.BAR: {\r\n            backgroundColor = (plot.color && plot.color(cbData, styles)) || styles.bar.noChangeColor\r\n            break\r\n          }\r\n          case TechnicalIndicatorPlotType.LINE: {\r\n            backgroundColor = colors[lineCount % colorSize]\r\n            lineCount++\r\n            break\r\n          }\r\n          default: { break }\r\n        }\r\n        if (isValid(value)) {\r\n          this._drawMarkLabel(\r\n            value, precision, tech.shouldFormatBigNumber,\r\n            {\r\n              ...lastValueMarkOptions.text, backgroundColor\r\n            }\r\n          )\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 绘制最新价文字\r\n   * @private\r\n   */\r\n  _drawLastPriceLabel () {\r\n    if (!this._yAxis.isCandleYAxis()) {\r\n      return\r\n    }\r\n    const priceMarkOptions = this._chartData.styleOptions().candle.priceMark\r\n    const lastPriceMarkOptions = priceMarkOptions.last\r\n    if (!priceMarkOptions.show || !lastPriceMarkOptions.show || !lastPriceMarkOptions.text.show) {\r\n      return\r\n    }\r\n    const dataList = this._chartData.dataList()\r\n    const kLineData = dataList[dataList.length - 1]\r\n    if (!kLineData) {\r\n      return\r\n    }\r\n    const close = kLineData.close\r\n    const open = kLineData.open\r\n    let backgroundColor\r\n    if (close > open) {\r\n      backgroundColor = lastPriceMarkOptions.upColor\r\n    } else if (close < open) {\r\n      backgroundColor = lastPriceMarkOptions.downColor\r\n    } else {\r\n      backgroundColor = lastPriceMarkOptions.noChangeColor\r\n    }\r\n    this._drawMarkLabel(\r\n      close, this._chartData.pricePrecision(), false,\r\n      {\r\n        ...lastPriceMarkOptions.text, backgroundColor\r\n      }\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 绘制标记label\r\n   * @param value\r\n   * @param precision\r\n   * @param shouldFormatBigNumber\r\n   * @param size\r\n   * @param weight\r\n   * @param family\r\n   * @param color\r\n   * @param backgroundColor\r\n   * @param borderRadius\r\n   * @param paddingLeft\r\n   * @param paddingTop\r\n   * @param paddingRight\r\n   * @param paddingBottom\r\n   * @private\r\n   */\r\n  _drawMarkLabel (\r\n    value, precision, shouldFormatBigNumber,\r\n    {\r\n      size, weight, family, color, backgroundColor, borderRadius,\r\n      paddingLeft, paddingTop, paddingRight, paddingBottom\r\n    }\r\n  ) {\r\n    const valueY = this._yAxis.convertToNicePixel(value)\r\n    let text\r\n    if (this._yAxis.yAxisType() === YAxisType.PERCENTAGE) {\r\n      const fromData = (this._chartData.visibleDataList()[0] || {}).data || {}\r\n      const fromClose = fromData.close\r\n      text = `${((value - fromClose) / fromClose * 100).toFixed(2)}%`\r\n    } else {\r\n      text = formatPrecision(value, precision)\r\n      if (shouldFormatBigNumber) {\r\n        text = formatBigNumber(text)\r\n      }\r\n    }\r\n    this._ctx.font = createFont(size, weight, family)\r\n    const rectWidth = calcTextWidth(this._ctx, text) + paddingLeft + paddingRight\r\n    const rectHeight = paddingTop + size + paddingBottom\r\n    let rectStartX\r\n    if (this._yAxis.isFromYAxisZero()) {\r\n      rectStartX = 0\r\n    } else {\r\n      rectStartX = this._width - rectWidth\r\n    }\r\n    renderFillRoundRect(\r\n      this._ctx, backgroundColor,\r\n      rectStartX, valueY - paddingTop - size / 2, rectWidth, rectHeight, borderRadius\r\n    )\r\n    this._ctx.textBaseline = 'middle'\r\n    renderText(this._ctx, color, rectStartX + paddingLeft, valueY, text)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport View from './View'\r\nimport { calcTextWidth, createFont } from '../utils/canvas'\r\nimport { formatBigNumber, formatPrecision } from '../utils/format'\r\nimport { YAxisType } from '../options/styleOptions'\r\nimport { renderStrokeFillRoundRect } from '../renderer/rect'\r\nimport { renderText } from '../renderer/text'\r\n\r\nexport default class YAxisOverlayView extends View {\r\n  constructor (container, chartData, yAxis, paneId) {\r\n    super(container, chartData)\r\n    this._yAxis = yAxis\r\n    this._paneId = paneId\r\n  }\r\n\r\n  _draw () {\r\n    this._ctx.textBaseline = 'middle'\r\n    this._drawTag()\r\n    this._drawCrossHairLabel()\r\n  }\r\n\r\n  /**\r\n   * 绘制标签\r\n   * @private\r\n   */\r\n  _drawTag () {\r\n    const tags = this._chartData.tagStore().get(this._paneId)\r\n    if (tags) {\r\n      tags.forEach(tag => {\r\n        tag.drawText(this._ctx)\r\n      })\r\n    }\r\n  }\r\n\r\n  _drawCrossHairLabel () {\r\n    const crosshair = this._chartData.crosshairStore().get()\r\n    if (crosshair.paneId !== this._paneId || this._chartData.dataList().length === 0) {\r\n      return\r\n    }\r\n    const styleOptions = this._chartData.styleOptions()\r\n    const crosshairOptions = styleOptions.crosshair\r\n    const crosshairHorizontalOptions = crosshairOptions.horizontal\r\n    const crosshairHorizontalTextOptions = crosshairHorizontalOptions.text\r\n    if (!crosshairOptions.show || !crosshairHorizontalOptions.show || !crosshairHorizontalTextOptions.show) {\r\n      return\r\n    }\r\n    const value = this._yAxis.convertFromPixel(crosshair.y)\r\n    let text\r\n    if (this._yAxis.yAxisType() === YAxisType.PERCENTAGE) {\r\n      const fromData = (this._chartData.visibleDataList()[0] || {}).data || {}\r\n      text = `${((value - fromData.close) / fromData.close * 100).toFixed(2)}%`\r\n    } else {\r\n      const techs = this._chartData.technicalIndicatorStore().instances(this._paneId)\r\n      let precision = 0\r\n      let shouldFormatBigNumber = false\r\n      if (this._yAxis.isCandleYAxis()) {\r\n        precision = this._chartData.pricePrecision()\r\n      } else {\r\n        techs.forEach(tech => {\r\n          precision = Math.max(tech.precision, precision)\r\n          if (!shouldFormatBigNumber) {\r\n            shouldFormatBigNumber = tech.shouldFormatBigNumber\r\n          }\r\n        })\r\n      }\r\n      text = formatPrecision(value, precision)\r\n      if (shouldFormatBigNumber) {\r\n        text = formatBigNumber(text)\r\n      }\r\n    }\r\n    const textSize = crosshairHorizontalTextOptions.size\r\n    this._ctx.font = createFont(textSize, crosshairHorizontalTextOptions.weight, crosshairHorizontalTextOptions.family)\r\n    const yAxisDataLabelWidth = calcTextWidth(this._ctx, text)\r\n    let rectStartX\r\n\r\n    const paddingLeft = crosshairHorizontalTextOptions.paddingLeft\r\n    const paddingRight = crosshairHorizontalTextOptions.paddingRight\r\n    const paddingTop = crosshairHorizontalTextOptions.paddingTop\r\n    const paddingBottom = crosshairHorizontalTextOptions.paddingBottom\r\n    const borderSize = crosshairHorizontalTextOptions.borderSize\r\n\r\n    const rectWidth = yAxisDataLabelWidth + borderSize * 2 + paddingLeft + paddingRight\r\n    const rectHeight = textSize + borderSize * 2 + paddingTop + paddingBottom\r\n    if (this._yAxis.isFromYAxisZero()) {\r\n      rectStartX = 0\r\n    } else {\r\n      rectStartX = this._width - rectWidth\r\n    }\r\n\r\n    const rectY = crosshair.y - borderSize - paddingTop - textSize / 2\r\n    // 绘制y轴文字外的边框\r\n    renderStrokeFillRoundRect(\r\n      this._ctx, crosshairHorizontalTextOptions.backgroundColor,\r\n      crosshairHorizontalTextOptions.borderColor, borderSize,\r\n      rectStartX, rectY, rectWidth, rectHeight, crosshairHorizontalTextOptions.borderRadius\r\n    )\r\n    renderText(\r\n      this._ctx,\r\n      crosshairHorizontalTextOptions.color,\r\n      rectStartX + borderSize + paddingLeft,\r\n      crosshair.y,\r\n      text\r\n    )\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Widget from './Widget'\r\nimport YAxisView from '../view/YAxisView'\r\nimport YAxisOverlayView from '../view/YAxisOverlayView'\r\n\r\nexport default class YAxisWidget extends Widget {\r\n  _createMainView (container, props) {\r\n    return new YAxisView(container, props.chartData, props.yAxis, props.paneId)\r\n  }\r\n\r\n  _createOverlayView (container, props) {\r\n    return new YAxisOverlayView(container, props.chartData, props.yAxis, props.paneId)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { getPixelRatio } from '../../utils/canvas'\r\nimport { getPrecision, nice, round } from '../../utils/number'\r\nimport { createElement } from '../../utils/element'\r\n\r\nexport default class Axis {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n    this._width = 0\r\n    this._height = 0\r\n    this._cacheMinValue = 0\r\n    this._cacheMaxValue = 0\r\n    this._minValue = 0\r\n    this._maxValue = 0\r\n    this._range = 0\r\n    this._ticks = []\r\n    this._initMeasureCanvas()\r\n  }\r\n\r\n  _initMeasureCanvas () {\r\n    const measureCanvas = createElement('canvas')\r\n    const pixelRatio = getPixelRatio(measureCanvas)\r\n    this._measureCtx = measureCanvas.getContext('2d')\r\n    this._measureCtx.scale(pixelRatio, pixelRatio)\r\n  }\r\n\r\n  min () {\r\n    return this._minValue\r\n  }\r\n\r\n  max () {\r\n    return this._maxValue\r\n  }\r\n\r\n  width () {\r\n    return this._width\r\n  }\r\n\r\n  height () {\r\n    return this._height\r\n  }\r\n\r\n  setWidth (width) {\r\n    this._width = width\r\n  }\r\n\r\n  setHeight (height) {\r\n    this._height = height\r\n  }\r\n\r\n  /**\r\n   * 获取ticks\r\n   * @returns {[]|*[]}\r\n   */\r\n  ticks () {\r\n    return this._ticks\r\n  }\r\n\r\n  /**\r\n   * 计算轴\r\n   * @param forceCompute\r\n   */\r\n  computeAxis (forceCompute) {\r\n    const minMax = this._optimalMinMax(this._computeMinMax())\r\n    this._minValue = minMax.min\r\n    this._maxValue = minMax.max\r\n    this._range = minMax.range\r\n    if (this._cacheMinValue !== minMax.min || this._cacheMaxValue !== minMax.max || forceCompute) {\r\n      this._cacheMinValue = minMax.min\r\n      this._cacheMaxValue = minMax.max\r\n      this._ticks = this._optimalTicks(this._computeTicks())\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 计算最大最小值\r\n   * @private\r\n   */\r\n  _computeMinMax () {}\r\n\r\n  /**\r\n   * 优化最大最小值\r\n   * @param min\r\n   * @param max\r\n   * @param precision\r\n   * @private\r\n   */\r\n  _optimalMinMax ({ min, max, precision }) {}\r\n\r\n  /**\r\n   * 计算轴上的tick值\r\n   */\r\n  _computeTicks () {\r\n    const ticks = []\r\n    if (this._range >= 0) {\r\n      const intervalPrecision = this._computeInterval(this._range)\r\n      const interval = intervalPrecision.interval\r\n      const precision = intervalPrecision.precision\r\n      const first = round(Math.ceil(this._minValue / interval) * interval, precision)\r\n      const last = round(Math.floor(this._maxValue / interval) * interval, precision)\r\n      let n = 0\r\n      let f = first\r\n\r\n      if (interval !== 0) {\r\n        while (f <= last) {\r\n          ticks[n] = { v: f.toFixed(precision) }\r\n          ++n\r\n          f += interval\r\n        }\r\n      }\r\n    }\r\n    return ticks\r\n  }\r\n\r\n  /**\r\n   * 计算最佳的tick\r\n   * @param ticks\r\n   */\r\n  _optimalTicks (ticks) {}\r\n\r\n  /**\r\n   * 计算间隔\r\n   * @private\r\n   */\r\n  _computeInterval (range) {\r\n    const interval = nice(range / 8.0)\r\n    const precision = getPrecision(interval)\r\n    return {\r\n      interval, precision\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Axis from './Axis'\r\nimport { CandleType, YAxisPosition, YAxisType } from '../../options/styleOptions'\r\nimport { isNumber, isValid } from '../../utils/typeChecks'\r\nimport { calcTextWidth, createFont } from '../../utils/canvas'\r\nimport { formatBigNumber, formatPrecision } from '../../utils/format'\r\nimport { round, log10, index10 } from '../../utils/number'\r\n\r\nexport default class YAxis extends Axis {\r\n  constructor (chartData, isCandleYAxis, paneId) {\r\n    super(chartData)\r\n    this._realRange = 0\r\n    this._isCandleYAxis = isCandleYAxis\r\n    this._paneId = paneId\r\n  }\r\n\r\n  _computeMinMax () {\r\n    const minMaxArray = [Number.MAX_SAFE_INTEGER, Number.MIN_SAFE_INTEGER]\r\n    const plotsResult = []\r\n    let shouldOhlc = false\r\n    let minValue = Number.MAX_SAFE_INTEGER\r\n    let maxValue = Number.MIN_SAFE_INTEGER\r\n    let techPrecision = Number.MAX_SAFE_INTEGER\r\n    const techs = this._chartData.technicalIndicatorStore().instances(this._paneId)\r\n    techs.forEach(tech => {\r\n      if (!shouldOhlc) {\r\n        shouldOhlc = tech.shouldOhlc\r\n      }\r\n      techPrecision = Math.min(techPrecision, tech.precision)\r\n      if (isNumber(tech.minValue)) {\r\n        minValue = Math.min(minValue, tech.minValue)\r\n      }\r\n      if (isNumber(tech.maxValue)) {\r\n        maxValue = Math.max(maxValue, tech.maxValue)\r\n      }\r\n      plotsResult.push({\r\n        plots: tech.plots,\r\n        result: tech.result\r\n      })\r\n    })\r\n\r\n    let precision = 4\r\n    if (this._isCandleYAxis) {\r\n      const pricePrecision = this._chartData.pricePrecision()\r\n      if (techPrecision !== Number.MAX_SAFE_INTEGER) {\r\n        precision = Math.min(techPrecision, pricePrecision)\r\n      } else {\r\n        precision = pricePrecision\r\n      }\r\n    } else {\r\n      if (techPrecision !== Number.MAX_SAFE_INTEGER) {\r\n        precision = techPrecision\r\n      }\r\n    }\r\n    const visibleDataList = this._chartData.visibleDataList()\r\n    const candleOptions = this._chartData.styleOptions().candle\r\n    const isArea = candleOptions.type === CandleType.AREA\r\n    const areaValueKey = candleOptions.area.value\r\n    const shouldCompareHighLow = (this._isCandleYAxis && !isArea) || (!this._isCandleYAxis && shouldOhlc)\r\n    visibleDataList.forEach(({ index, data }) => {\r\n      if (shouldCompareHighLow) {\r\n        minMaxArray[0] = Math.min(minMaxArray[0], data.low)\r\n        minMaxArray[1] = Math.max(minMaxArray[1], data.high)\r\n      }\r\n      if (this._isCandleYAxis && isArea) {\r\n        minMaxArray[0] = Math.min(minMaxArray[0], data[areaValueKey])\r\n        minMaxArray[1] = Math.max(minMaxArray[1], data[areaValueKey])\r\n      }\r\n      plotsResult.forEach(({ plots, result }) => {\r\n        const techData = result[index] || {}\r\n        plots.forEach(plot => {\r\n          const value = techData[plot.key]\r\n          if (isValid(value)) {\r\n            minMaxArray[0] = Math.min(minMaxArray[0], value)\r\n            minMaxArray[1] = Math.max(minMaxArray[1], value)\r\n          }\r\n        })\r\n      })\r\n    })\r\n    if (minMaxArray[0] !== Number.MAX_SAFE_INTEGER && minMaxArray[1] !== Number.MIN_SAFE_INTEGER) {\r\n      minMaxArray[0] = Math.min(minValue, minMaxArray[0])\r\n      minMaxArray[1] = Math.max(maxValue, minMaxArray[1])\r\n    } else {\r\n      minMaxArray[0] = 0\r\n      minMaxArray[1] = 10\r\n    }\r\n    return { min: minMaxArray[0], max: minMaxArray[1], precision, specifyMin: minValue, specifyMax: maxValue }\r\n  }\r\n\r\n  _optimalMinMax ({ min, max, precision, specifyMin, specifyMax }) {\r\n    let minValue = min\r\n    let maxValue = max\r\n    const yAxisType = this.yAxisType()\r\n    let dif\r\n    switch (yAxisType) {\r\n      case YAxisType.PERCENTAGE: {\r\n        const fromData = (this._chartData.visibleDataList()[0] || {}).data || {}\r\n        if (isNumber(fromData.close)) {\r\n          minValue = (minValue - fromData.close) / fromData.close * 100\r\n          maxValue = (maxValue - fromData.close) / fromData.close * 100\r\n        }\r\n        dif = Math.pow(10, -2)\r\n        break\r\n      }\r\n      case YAxisType.LOG: {\r\n        minValue = log10(minValue)\r\n        maxValue = log10(maxValue)\r\n        dif = 0.05 * index10(-precision)\r\n        break\r\n      }\r\n      default: {\r\n        dif = index10(-precision)\r\n      }\r\n    }\r\n    if (\r\n      minValue === maxValue ||\r\n      Math.abs(minValue - maxValue) < dif\r\n    ) {\r\n      const minCheck = specifyMin === minValue\r\n      const maxCheck = specifyMax === maxValue\r\n      minValue = minCheck ? minValue : (maxCheck ? minValue - 8 * dif : minValue - 4 * dif)\r\n      maxValue = maxCheck ? maxValue : (minCheck ? maxValue + 8 * dif : maxValue + 4 * dif)\r\n    }\r\n    let marginOptions\r\n    if (this._isCandleYAxis) {\r\n      marginOptions = this._chartData.styleOptions().candle.margin\r\n    } else {\r\n      marginOptions = this._chartData.styleOptions().technicalIndicator.margin\r\n    }\r\n    let topRate\r\n    let bottomRate\r\n    if (marginOptions.top > 1) {\r\n      topRate = marginOptions.top / this._height\r\n    } else {\r\n      topRate = isNumber(marginOptions.top) ? marginOptions.top : 0.2\r\n    }\r\n    if (marginOptions.bottom > 1) {\r\n      bottomRate = marginOptions.bottom / this._height\r\n    } else {\r\n      bottomRate = isNumber(marginOptions.bottom) ? marginOptions.bottom : 0.1\r\n    }\r\n    let range = Math.abs(maxValue - minValue)\r\n    // 保证每次图形绘制上下都留间隙\r\n    minValue = minValue - range * bottomRate\r\n    maxValue = maxValue + range * topRate\r\n\r\n    range = Math.abs(maxValue - minValue)\r\n    if (yAxisType === YAxisType.LOG) {\r\n      this._realRange = Math.abs(index10(maxValue) - index10(minValue))\r\n    } else {\r\n      this._realRange = range\r\n    }\r\n    return {\r\n      min: minValue,\r\n      max: maxValue,\r\n      range\r\n    }\r\n  }\r\n\r\n  _optimalTicks (ticks) {\r\n    const optimalTicks = []\r\n    const yAxisType = this.yAxisType()\r\n    const techs = this._chartData.technicalIndicatorStore().instances(this._paneId)\r\n    let precision = 0\r\n    let shouldFormatBigNumber = false\r\n    if (this._isCandleYAxis) {\r\n      precision = this._chartData.pricePrecision()\r\n    } else {\r\n      techs.forEach(tech => {\r\n        precision = Math.max(precision, tech.precision)\r\n        if (!shouldFormatBigNumber) {\r\n          shouldFormatBigNumber = tech.shouldFormatBigNumber\r\n        }\r\n      })\r\n    }\r\n    const textHeight = this._chartData.styleOptions().xAxis.tickText.size\r\n    let intervalPrecision\r\n    if (yAxisType === YAxisType.LOG) {\r\n      intervalPrecision = this._computeInterval(this._realRange)\r\n    }\r\n    let validY\r\n    ticks.forEach(({ v }) => {\r\n      let value\r\n      let y = this._innerConvertToPixel(+v)\r\n      switch (yAxisType) {\r\n        case YAxisType.PERCENTAGE: {\r\n          value = `${formatPrecision(v, 2)}%`\r\n          break\r\n        }\r\n        case YAxisType.LOG: {\r\n          value = round(index10(v), intervalPrecision.precision)\r\n          y = this._innerConvertToPixel(log10(value))\r\n          value = formatPrecision(value, precision)\r\n          break\r\n        }\r\n        default: {\r\n          value = formatPrecision(v, precision)\r\n          if (shouldFormatBigNumber) {\r\n            value = formatBigNumber(value)\r\n          }\r\n          break\r\n        }\r\n      }\r\n      if (y > textHeight && y < this._height - textHeight && ((validY && (validY - y > textHeight * 2)) || !validY)) {\r\n        optimalTicks.push({ v: value, y })\r\n        validY = y\r\n      }\r\n    })\r\n    return optimalTicks\r\n  }\r\n\r\n  /**\r\n   * 内部值转换成坐标\r\n   * @param value\r\n   * @return {number}\r\n   * @private\r\n   */\r\n  _innerConvertToPixel (value) {\r\n    return Math.round((1.0 - (value - this._minValue) / this._range) * this._height)\r\n  }\r\n\r\n  /**\r\n   * 是否是蜡烛图轴\r\n   * @return {*}\r\n   */\r\n  isCandleYAxis () {\r\n    return this._isCandleYAxis\r\n  }\r\n\r\n  /**\r\n   * y轴类型\r\n   * @return {string|*}\r\n   */\r\n  yAxisType () {\r\n    if (this._isCandleYAxis) {\r\n      return this._chartData.styleOptions().yAxis.type\r\n    }\r\n    return YAxisType.NORMAL\r\n  }\r\n\r\n  /**\r\n   * 是否从y轴0开始\r\n   * @return {boolean|*|boolean}\r\n   */\r\n  isFromYAxisZero () {\r\n    const yAxisOptions = this._chartData.styleOptions().yAxis\r\n    return (\r\n      (yAxisOptions.position === YAxisPosition.LEFT && yAxisOptions.inside) ||\r\n      (yAxisOptions.position === YAxisPosition.RIGHT && !yAxisOptions.inside)\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 获取自身宽度\r\n   * @return {number}\r\n   */\r\n  getSelfWidth () {\r\n    const styleOptions = this._chartData.styleOptions()\r\n    const yAxisOptions = styleOptions.yAxis\r\n    const width = yAxisOptions.width\r\n    if (isNumber(width)) {\r\n      return width\r\n    }\r\n    let yAxisWidth = 0\r\n    if (yAxisOptions.show) {\r\n      if (yAxisOptions.axisLine.show) {\r\n        yAxisWidth += yAxisOptions.axisLine.size\r\n      }\r\n      if (yAxisOptions.tickLine.show) {\r\n        yAxisWidth += yAxisOptions.tickLine.length\r\n      }\r\n      if (yAxisOptions.tickText.show) {\r\n        let textWidth = 0\r\n        this._measureCtx.font = createFont(yAxisOptions.tickText.size, yAxisOptions.tickText.weight, yAxisOptions.tickText.family)\r\n        this._ticks.forEach(tick => {\r\n          textWidth = Math.max(textWidth, calcTextWidth(this._measureCtx, tick.v))\r\n        })\r\n        yAxisWidth += (yAxisOptions.tickText.paddingLeft + yAxisOptions.tickText.paddingRight + textWidth)\r\n      }\r\n    }\r\n    const crosshairOptions = styleOptions.crosshair\r\n    let crosshairVerticalTextWidth = 0\r\n    if (\r\n      crosshairOptions.show &&\r\n      crosshairOptions.horizontal.show &&\r\n      crosshairOptions.horizontal.text.show\r\n    ) {\r\n      const techs = this._chartData.technicalIndicatorStore().instances(this._paneId)\r\n      let techPrecision = 0\r\n      let shouldFormatBigNumber = false\r\n      techs.forEach(tech => {\r\n        techPrecision = Math.max(tech.precision, techPrecision)\r\n        if (!shouldFormatBigNumber) {\r\n          shouldFormatBigNumber = tech.shouldFormatBigNumber\r\n        }\r\n      })\r\n      this._measureCtx.font = createFont(\r\n        crosshairOptions.horizontal.text.size,\r\n        crosshairOptions.horizontal.text.weight,\r\n        crosshairOptions.horizontal.text.family\r\n      )\r\n      let precision = 2\r\n      if (this.yAxisType() !== YAxisType.PERCENTAGE) {\r\n        if (this._isCandleYAxis) {\r\n          const pricePrecision = this._chartData.pricePrecision()\r\n          const lastValueMarkOptions = styleOptions.technicalIndicator.lastValueMark\r\n          if (lastValueMarkOptions.show && lastValueMarkOptions.text.show) {\r\n            precision = Math.max(techPrecision, pricePrecision)\r\n          } else {\r\n            precision = pricePrecision\r\n          }\r\n        } else {\r\n          precision = techPrecision\r\n        }\r\n      }\r\n      let valueText = formatPrecision(this._maxValue, precision)\r\n      if (shouldFormatBigNumber) {\r\n        valueText = formatBigNumber(valueText)\r\n      }\r\n      crosshairVerticalTextWidth += (\r\n        crosshairOptions.horizontal.text.paddingLeft +\r\n        crosshairOptions.horizontal.text.paddingRight +\r\n        crosshairOptions.horizontal.text.borderSize * 2 +\r\n        calcTextWidth(this._measureCtx, valueText)\r\n      )\r\n    }\r\n    return Math.max(yAxisWidth, crosshairVerticalTextWidth)\r\n  }\r\n\r\n  convertFromPixel (pixel) {\r\n    const value = (1.0 - pixel / this._height) * this._range + this._minValue\r\n    switch (this.yAxisType()) {\r\n      case YAxisType.PERCENTAGE: {\r\n        const fromData = (this._chartData.visibleDataList()[0] || {}).data || {}\r\n        if (isNumber(fromData.close)) {\r\n          return fromData.close * value / 100 + fromData.close\r\n        }\r\n        break\r\n      }\r\n      case YAxisType.LOG: {\r\n        return index10(value)\r\n      }\r\n      default: {\r\n        return value\r\n      }\r\n    }\r\n  }\r\n\r\n  convertToPixel (value) {\r\n    let v\r\n    switch (this.yAxisType()) {\r\n      case YAxisType.PERCENTAGE: {\r\n        const fromData = (this._chartData.visibleDataList()[0] || {}).data || {}\r\n        if (isNumber(fromData.close)) {\r\n          v = (value - fromData.close) / fromData.close * 100\r\n        }\r\n        break\r\n      }\r\n      case YAxisType.LOG: {\r\n        v = log10(value)\r\n        break\r\n      }\r\n      default: {\r\n        v = value\r\n      }\r\n    }\r\n    return this._innerConvertToPixel(v)\r\n  }\r\n\r\n  /**\r\n   * 将值转换成坐标，即使坐标不在范围内，也会显示在顶部或者底部\r\n   * @param value\r\n   * @return {number}\r\n   */\r\n  convertToNicePixel (value) {\r\n    const y = this.convertToPixel(value)\r\n    return Math.round(Math.max(this._height * 0.05, Math.min(y, this._height * 0.98)))\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Pane from './Pane'\r\nimport TechnicalIndicatorWidget from '../widget/TechnicalIndicatorWidget'\r\nimport YAxisWidget from '../widget/YAxisWidget'\r\nimport YAxis from '../component/axis/YAxis'\r\n\r\nexport default class TechnicalIndicatorPane extends Pane {\r\n  constructor (props) {\r\n    super(props)\r\n    if ('height' in props) {\r\n      this.setHeight(props.height)\r\n    }\r\n  }\r\n\r\n  _initBefore (props) {\r\n    this._id = props.id\r\n    this._yAxis = this._createYAxis(props)\r\n  }\r\n\r\n  _createYAxis (props) {\r\n    return new YAxis(\r\n      props.chartData,\r\n      false,\r\n      props.id\r\n    )\r\n  }\r\n\r\n  _createMainWidget (container, props) {\r\n    return new TechnicalIndicatorWidget({\r\n      container,\r\n      chartData: props.chartData,\r\n      xAxis: props.xAxis,\r\n      yAxis: this._yAxis,\r\n      paneId: props.id\r\n    })\r\n  }\r\n\r\n  _createYAxisWidget (container, props) {\r\n    return new YAxisWidget({\r\n      container,\r\n      chartData: props.chartData,\r\n      yAxis: this._yAxis,\r\n      paneId: props.id\r\n    })\r\n  }\r\n\r\n  setHeight (height) {\r\n    super.setHeight(height)\r\n    this._yAxis.setHeight(height)\r\n  }\r\n\r\n  setWidth (mainWidgetWidth, yAxisWidgetWidth) {\r\n    super.setWidth(mainWidgetWidth, yAxisWidgetWidth)\r\n    this._yAxis.setWidth(yAxisWidgetWidth)\r\n  }\r\n\r\n  /**\r\n   * 获取id\r\n   * @returns {string}\r\n   */\r\n  id () {\r\n    return this._id\r\n  }\r\n\r\n  yAxis () {\r\n    return this._yAxis\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport TechnicalIndicatorView from './TechnicalIndicatorView'\r\nimport { CandleType, LineStyle } from '../options/styleOptions'\r\nimport { renderHorizontalLine, renderLine } from '../renderer/line'\r\nimport { renderFillPath } from '../renderer/path'\r\nimport { createFont } from '../utils/canvas'\r\nimport { formatPrecision, formatValue } from '../utils/format'\r\nimport { isArray, isNumber } from '../utils/typeChecks'\r\n\r\nexport default class CandleView extends TechnicalIndicatorView {\r\n  _drawContent () {\r\n    const candleOptions = this._chartData.styleOptions().candle\r\n    this._drawLastPriceLine(candleOptions.priceMark)\r\n    if (candleOptions.type === CandleType.AREA) {\r\n      this._drawArea(candleOptions)\r\n    } else {\r\n      this._drawLowHighPrice(\r\n        candleOptions.priceMark,\r\n        'high',\r\n        'high',\r\n        Number.MIN_SAFE_INTEGER,\r\n        [-2, -5],\r\n        (price, comparePrice) => {\r\n          if (price > comparePrice) {\r\n            return price\r\n          }\r\n        }\r\n      )\r\n      this._drawLowHighPrice(\r\n        candleOptions.priceMark,\r\n        'low',\r\n        'low',\r\n        Number.MAX_SAFE_INTEGER,\r\n        [2, 5],\r\n        (price, comparePrice) => {\r\n          if (price < comparePrice) {\r\n            return price\r\n          }\r\n        }\r\n      )\r\n      this._drawCandle(candleOptions)\r\n    }\r\n    this._drawTechs()\r\n    this._drawGrid()\r\n  }\r\n\r\n  /**\r\n   * 绘制面积图\r\n   * @param candleOptions\r\n   * @private\r\n   */\r\n  _drawArea (candleOptions) {\r\n    const lineCoordinates = []\r\n    const areaCoordinates = []\r\n    let minY = Number.MAX_SAFE_INTEGER\r\n    const areaOptions = candleOptions.area\r\n    const onDrawing = (x, i, kLineData, halfBarSpace, barSpace, n) => {\r\n      const value = kLineData[areaOptions.value]\r\n      if (isNumber(value)) {\r\n        const y = this._yAxis.convertToPixel(value)\r\n        if (n === 0) {\r\n          const startX = x - halfBarSpace\r\n          areaCoordinates.push({ x: startX, y: this._height })\r\n          areaCoordinates.push({ x: startX, y })\r\n          lineCoordinates.push({ x: startX, y })\r\n        }\r\n        lineCoordinates.push({ x, y })\r\n        areaCoordinates.push({ x, y })\r\n        minY = Math.min(minY, y)\r\n      }\r\n    }\r\n    const onDrawEnd = () => {\r\n      const areaCoordinateLength = areaCoordinates.length\r\n      if (areaCoordinateLength > 0) {\r\n        const lastCoordinate = areaCoordinates[areaCoordinateLength - 1]\r\n        const halfBarSpace = this._chartData.timeScaleStore().halfBarSpace()\r\n        const endX = lastCoordinate.x + halfBarSpace\r\n        lineCoordinates.push({ x: endX, y: lastCoordinate.y })\r\n        areaCoordinates.push({ x: endX, y: lastCoordinate.y })\r\n        areaCoordinates.push({ x: endX, y: this._height })\r\n      }\r\n\r\n      if (lineCoordinates.length > 0) {\r\n        // 绘制分时线\r\n        this._ctx.lineWidth = areaOptions.lineSize\r\n        this._ctx.strokeStyle = areaOptions.lineColor\r\n        renderLine(this._ctx, lineCoordinates)\r\n      }\r\n\r\n      if (areaCoordinates.length > 0) {\r\n        // 绘制分时线填充区域\r\n        const backgroundColor = areaOptions.backgroundColor\r\n        if (isArray(backgroundColor)) {\r\n          const gradient = this._ctx.createLinearGradient(0, this._height, 0, minY)\r\n          try {\r\n            backgroundColor.forEach(({ offset, color }) => {\r\n              gradient.addColorStop(offset, color)\r\n            })\r\n          } catch (e) {\r\n          }\r\n          this._ctx.fillStyle = gradient\r\n        } else {\r\n          this._ctx.fillStyle = backgroundColor\r\n        }\r\n        renderFillPath(this._ctx, areaCoordinates)\r\n      }\r\n    }\r\n    this._drawGraphics(onDrawing, onDrawEnd)\r\n  }\r\n\r\n  /**\r\n   * 绘制蜡烛\r\n   * @param candleOptions\r\n   * @private\r\n   */\r\n  _drawCandle (candleOptions) {\r\n    this._drawGraphics((x, i, kLineData, halfBarSpace, barSpace) => {\r\n      this._drawCandleBar(x, halfBarSpace, barSpace, i, kLineData, candleOptions.bar, candleOptions.type)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 渲染最高最低价格\r\n   * @param priceMarkOptions\r\n   * @param optionKey\r\n   * @param priceKey\r\n   * @param initPriceValue\r\n   * @param offsets\r\n   * @param compare\r\n   * @private\r\n   */\r\n  _drawLowHighPrice (priceMarkOptions, optionKey, priceKey, initPriceValue, offsets, compare) {\r\n    const lowHighPriceMarkOptions = priceMarkOptions[optionKey]\r\n    if (!priceMarkOptions.show || !lowHighPriceMarkOptions.show) {\r\n      return\r\n    }\r\n    const visibleDataList = this._chartData.visibleDataList()\r\n    let price = initPriceValue\r\n    let pos = -1\r\n    visibleDataList.forEach(({ index, data }) => {\r\n      const comparePrice = compare(formatValue(data, priceKey, initPriceValue), price)\r\n      if (comparePrice) {\r\n        price = comparePrice\r\n        pos = index\r\n      }\r\n    })\r\n    const pricePrecision = this._chartData.pricePrecision()\r\n    const priceY = this._yAxis.convertToPixel(price)\r\n    const startX = this._xAxis.convertToPixel(pos)\r\n    const startY = priceY + offsets[0]\r\n    this._ctx.textAlign = 'left'\r\n    this._ctx.lineWidth = 1\r\n    this._ctx.strokeStyle = lowHighPriceMarkOptions.color\r\n    this._ctx.fillStyle = lowHighPriceMarkOptions.color\r\n\r\n    renderLine(\r\n      this._ctx,\r\n      [\r\n        { x: startX - 2, y: startY + offsets[0] },\r\n        { x: startX, y: startY },\r\n        { x: startX + 2, y: startY + offsets[0] }\r\n      ]\r\n    )\r\n\r\n    // 绘制竖线\r\n    const y = startY + offsets[1]\r\n    renderLine(\r\n      this._ctx,\r\n      [\r\n        { x: startX, y: startY },\r\n        { x: startX, y },\r\n        { x: startX + 5, y }\r\n      ]\r\n    )\r\n\r\n    this._ctx.font = createFont(lowHighPriceMarkOptions.textSize, lowHighPriceMarkOptions.textWeight, lowHighPriceMarkOptions.textFamily)\r\n    const text = formatPrecision(price, pricePrecision)\r\n    this._ctx.textBaseline = 'middle'\r\n    this._ctx.fillText(text, startX + 5 + lowHighPriceMarkOptions.textMargin, y)\r\n  }\r\n\r\n  /**\r\n   * 绘制最新价线\r\n   * @param priceMarkOptions\r\n   * @private\r\n   */\r\n  _drawLastPriceLine (priceMarkOptions) {\r\n    const lastPriceMarkOptions = priceMarkOptions.last\r\n    if (!priceMarkOptions.show || !lastPriceMarkOptions.show || !lastPriceMarkOptions.line.show) {\r\n      return\r\n    }\r\n    const dataList = this._chartData.dataList()\r\n    const kLineData = dataList[dataList.length - 1]\r\n    if (!kLineData) {\r\n      return\r\n    }\r\n    const close = kLineData.close\r\n    const open = kLineData.open\r\n    const priceY = this._yAxis.convertToNicePixel(close)\r\n    let color\r\n    if (close > open) {\r\n      color = lastPriceMarkOptions.upColor\r\n    } else if (close < open) {\r\n      color = lastPriceMarkOptions.downColor\r\n    } else {\r\n      color = lastPriceMarkOptions.noChangeColor\r\n    }\r\n    this._ctx.save()\r\n    this._ctx.strokeStyle = color\r\n    this._ctx.lineWidth = lastPriceMarkOptions.line.size\r\n    if (lastPriceMarkOptions.line.style === LineStyle.DASH) {\r\n      this._ctx.setLineDash(lastPriceMarkOptions.line.dashValue)\r\n    }\r\n    renderHorizontalLine(this._ctx, priceY, 0, this._width)\r\n    this._ctx.restore()\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport TechnicalIndicatorOverlayView from './TechnicalIndicatorOverlayView'\r\nimport { isFunction, isObject, isArray, isValid } from '../utils/typeChecks'\r\nimport { formatBigNumber, formatDate, formatPrecision, formatValue } from '../utils/format'\r\nimport { calcTextWidth, createFont } from '../utils/canvas'\r\nimport { TooltipShowType } from '../options/styleOptions'\r\nimport { getTechnicalIndicatorTooltipData } from '../data/store/TechnicalIndicatorStore'\r\nimport { TechnicalIndicatorPlotType } from '../component/technicalindicator/TechnicalIndicator'\r\nimport { renderFillRoundRect, renderStrokeRoundRect } from '../renderer/rect'\r\nimport { renderText } from '../renderer/text'\r\n\r\nexport default class CandleOverlayView extends TechnicalIndicatorOverlayView {\r\n  _drawTooltip (crosshair, techs) {\r\n    const styleOptions = this._chartData.styleOptions()\r\n    const candleOptions = styleOptions.candle\r\n    const candleTooltipOptions = candleOptions.tooltip\r\n    const techOptions = styleOptions.technicalIndicator\r\n    const techTooltipOptions = techOptions.tooltip\r\n    const isDrawCandleTooltip = this._shouldDrawTooltip(crosshair, candleTooltipOptions)\r\n    const isDrawTechTooltip = this._shouldDrawTooltip(crosshair, techTooltipOptions)\r\n    if (\r\n      candleTooltipOptions.showType === TooltipShowType.RECT &&\r\n      techTooltipOptions.showType === TooltipShowType.RECT\r\n    ) {\r\n      this._drawCandleTooltipWithRect(\r\n        crosshair,\r\n        techs,\r\n        candleOptions,\r\n        isDrawCandleTooltip,\r\n        techOptions,\r\n        isDrawTechTooltip\r\n      )\r\n    } else {\r\n      if (candleTooltipOptions.showType === TooltipShowType.STANDARD) {\r\n        this._drawCandleTooltipWithStandard(crosshair.kLineData, candleOptions, isDrawCandleTooltip)\r\n        if (techTooltipOptions.showType === TooltipShowType.STANDARD) {\r\n          const offsetTop = isDrawCandleTooltip ? candleTooltipOptions.text.size + candleTooltipOptions.text.marginTop : 0\r\n          this._drawBatchTechToolTip(\r\n            crosshair,\r\n            techs,\r\n            techOptions,\r\n            offsetTop,\r\n            isDrawTechTooltip\r\n          )\r\n        } else {\r\n          this._drawCandleTooltipWithRect(\r\n            crosshair,\r\n            techs,\r\n            candleOptions,\r\n            false,\r\n            techOptions,\r\n            isDrawTechTooltip\r\n          )\r\n        }\r\n      } else {\r\n        this._drawCandleTooltipWithRect(\r\n          crosshair,\r\n          techs,\r\n          candleOptions,\r\n          isDrawCandleTooltip,\r\n          techOptions,\r\n          false\r\n        )\r\n        this._drawBatchTechToolTip(\r\n          crosshair,\r\n          techs,\r\n          techOptions,\r\n          0,\r\n          isDrawTechTooltip\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制蜡烛默认的图例\r\n   * @param kLineData\r\n   * @param candleOptions\r\n   * @param isDrawCandleTooltip\r\n   * @private\r\n   */\r\n  _drawCandleTooltipWithStandard (kLineData, candleOptions, isDrawCandleTooltip) {\r\n    if (!isDrawCandleTooltip) {\r\n      return\r\n    }\r\n    const values = this._getCandleTooltipData(kLineData, candleOptions)\r\n    const candleTooltipOptions = candleOptions.tooltip\r\n    const textMarginLeft = candleTooltipOptions.text.marginLeft\r\n    const textMarginRight = candleTooltipOptions.text.marginRight\r\n    const textSize = candleTooltipOptions.text.size\r\n    const textColor = candleTooltipOptions.text.color\r\n    const labels = candleTooltipOptions.labels\r\n    this._ctx.textBaseline = 'top'\r\n    this._ctx.font = createFont(textSize, candleTooltipOptions.text.weight, candleTooltipOptions.text.family)\r\n    let labelX = textMarginLeft\r\n    const labelY = candleTooltipOptions.text.marginTop\r\n    labels.forEach((label, i) => {\r\n      const labelWidth = calcTextWidth(this._ctx, label)\r\n      renderText(this._ctx, textColor, labelX, labelY, label)\r\n      labelX += labelWidth\r\n\r\n      const value = values[i] || candleTooltipOptions.defaultValue\r\n      let valueText\r\n      let valueColor\r\n      if (isObject(value)) {\r\n        valueText = value.value || candleTooltipOptions.defaultValue\r\n        valueColor = value.color || textColor\r\n      } else {\r\n        valueColor = textColor\r\n        valueText = value\r\n      }\r\n      const textWidth = calcTextWidth(this._ctx, valueText)\r\n      renderText(this._ctx, valueColor, labelX, labelY, valueText)\r\n      labelX += (textWidth + textMarginLeft + textMarginRight)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 绘制蜡烛图矩形类型图例\r\n   * @param crosshair\r\n   * @param techs\r\n   * @param candleOptions\r\n   * @param isDrawCandleTooltip\r\n   * @param techOptions\r\n   * @param isDrawTechTooltip\r\n   * @private\r\n   */\r\n  _drawCandleTooltipWithRect (\r\n    crosshair, techs, candleOptions, isDrawCandleTooltip,\r\n    techOptions, isDrawTechTooltip\r\n  ) {\r\n    if (!isDrawCandleTooltip && !isDrawTechTooltip) {\r\n      return\r\n    }\r\n    const candleTooltipOptions = candleOptions.tooltip\r\n    const baseLabels = candleTooltipOptions.labels\r\n    const baseValues = this._getCandleTooltipData(crosshair.kLineData, candleOptions)\r\n    const baseTextMarginLeft = candleTooltipOptions.text.marginLeft\r\n    const baseTextMarginRight = candleTooltipOptions.text.marginRight\r\n    const baseTextMarginTop = candleTooltipOptions.text.marginTop\r\n    const baseTextMarginBottom = candleTooltipOptions.text.marginBottom\r\n    const baseTextSize = candleTooltipOptions.text.size\r\n    const baseTextColor = candleTooltipOptions.text.color\r\n\r\n    const rectOptions = candleTooltipOptions.rect\r\n    const rectBorderSize = rectOptions.borderSize\r\n    const rectPaddingLeft = rectOptions.paddingLeft\r\n    const rectPaddingRight = rectOptions.paddingRight\r\n    const rectPaddingTop = rectOptions.paddingTop\r\n    const rectPaddingBottom = rectOptions.paddingBottom\r\n    const rectLeft = rectOptions.offsetLeft\r\n    const rectRight = rectOptions.offsetRight\r\n\r\n    let maxLabelWidth = 0\r\n    let rectWidth = 0\r\n    let rectHeight = 0\r\n    this._ctx.save()\r\n    this._ctx.textBaseline = 'top'\r\n    if (isDrawCandleTooltip) {\r\n      this._ctx.font = createFont(baseTextSize, candleTooltipOptions.text.weight, candleTooltipOptions.text.family)\r\n      baseLabels.forEach((label, i) => {\r\n        const value = baseValues[i]\r\n        let v\r\n        if (isObject(value)) {\r\n          v = value.value || candleTooltipOptions.defaultValue\r\n        } else {\r\n          v = value\r\n        }\r\n        const text = `${label}${v}`\r\n        const labelWidth = calcTextWidth(this._ctx, text) + baseTextMarginLeft + baseTextMarginRight\r\n        maxLabelWidth = Math.max(maxLabelWidth, labelWidth)\r\n      })\r\n      rectHeight += ((baseTextMarginBottom + baseTextMarginTop + baseTextSize) * baseLabels.length)\r\n    }\r\n\r\n    const techTooltipOptions = techOptions.tooltip\r\n\r\n    const techTooltipTextMarginLeft = techTooltipOptions.text.marginLeft\r\n    const techTooltipTextMarginRight = techTooltipOptions.text.marginRight\r\n    const techTooltipTextMarginTop = techTooltipOptions.text.marginTop\r\n    const techTooltipTextMarginBottom = techTooltipOptions.text.marginBottom\r\n    const techTooltipTextSize = techTooltipOptions.text.size\r\n\r\n    const techTooltipDataList = []\r\n    const dataList = this._chartData.dataList()\r\n    techs.forEach(tech => {\r\n      const result = tech.result\r\n      techTooltipDataList.push({\r\n        name: tech.name,\r\n        tooltipData: getTechnicalIndicatorTooltipData(result[crosshair.dataIndex], tech),\r\n        cbData: {\r\n          prev: { kLineData: dataList[crosshair.dataIndex - 1], technicalIndicatorData: result[crosshair.dataIndex - 1] },\r\n          current: { kLineData: dataList[crosshair.dataIndex], technicalIndicatorData: result[crosshair.dataIndex] },\r\n          next: { kLineData: dataList[crosshair.dataIndex + 1], technicalIndicatorData: result[crosshair.dataIndex + 1] }\r\n        }\r\n      })\r\n    })\r\n    if (isDrawTechTooltip) {\r\n      this._ctx.font = createFont(\r\n        techTooltipTextSize,\r\n        techTooltipOptions.text.weight,\r\n        techTooltipOptions.text.family\r\n      )\r\n      techTooltipDataList.forEach(({ tooltipData }) => {\r\n        tooltipData.values.forEach(({ title, value }) => {\r\n          if (isValid(title)) {\r\n            const v = value || techTooltipOptions.defaultValue\r\n            const text = `${title}${v}`\r\n            const labelWidth = calcTextWidth(this._ctx, text) + techTooltipTextMarginLeft + techTooltipTextMarginRight\r\n            maxLabelWidth = Math.max(maxLabelWidth, labelWidth)\r\n            rectHeight += (techTooltipTextMarginTop + techTooltipTextMarginBottom + techTooltipTextSize)\r\n          }\r\n        })\r\n      })\r\n    }\r\n    rectWidth += maxLabelWidth\r\n    if (rectWidth === 0 || rectHeight === 0) {\r\n      return\r\n    }\r\n    rectWidth += (rectBorderSize * 2 + rectPaddingLeft + rectPaddingRight)\r\n    rectHeight += (rectBorderSize * 2 + rectPaddingTop + rectPaddingBottom)\r\n    const centerX = this._width / 2\r\n    let rectX\r\n    if (crosshair.realX < centerX) {\r\n      rectX = this._width - rectRight - rectWidth\r\n    } else {\r\n      rectX = rectLeft\r\n    }\r\n    const rectY = rectOptions.offsetTop\r\n    const radius = rectOptions.borderRadius\r\n    renderFillRoundRect(this._ctx, rectOptions.backgroundColor, rectX, rectY, rectWidth, rectHeight, radius)\r\n    renderStrokeRoundRect(this._ctx, rectOptions.borderColor, rectBorderSize, rectX, rectY, rectWidth, rectHeight, radius)\r\n    const baseLabelX = rectX + rectBorderSize + rectPaddingLeft + baseTextMarginLeft\r\n    let labelY = rectY + rectBorderSize + rectPaddingTop\r\n    if (isDrawCandleTooltip) {\r\n      // 开始渲染基础数据文字\r\n      this._ctx.font = createFont(\r\n        baseTextSize,\r\n        candleTooltipOptions.text.weight,\r\n        candleTooltipOptions.text.family\r\n      )\r\n      baseLabels.forEach((label, i) => {\r\n        labelY += baseTextMarginTop\r\n        this._ctx.textAlign = 'left'\r\n        renderText(this._ctx, baseTextColor, baseLabelX, labelY, label)\r\n\r\n        const value = baseValues[i]\r\n        let text\r\n        let color\r\n        if (isObject(value)) {\r\n          color = value.color || baseTextColor\r\n          text = value.value || candleTooltipOptions.defaultValue\r\n        } else {\r\n          color = baseTextColor\r\n          text = value || candleTooltipOptions.defaultValue\r\n        }\r\n        this._ctx.textAlign = 'right'\r\n        renderText(\r\n          this._ctx,\r\n          color,\r\n          rectX + rectWidth - rectBorderSize - baseTextMarginRight - rectPaddingRight,\r\n          labelY,\r\n          text\r\n        )\r\n        labelY += (baseTextSize + baseTextMarginBottom)\r\n      })\r\n    }\r\n    if (isDrawTechTooltip) {\r\n      // 开始渲染指标数据文字\r\n      const techOptions = this._chartData.styleOptions().technicalIndicator\r\n      const indicatorLabelX = rectX + rectBorderSize + rectPaddingLeft + techTooltipTextMarginLeft\r\n      this._ctx.font = createFont(\r\n        techTooltipTextSize,\r\n        techTooltipOptions.text.weight,\r\n        techTooltipOptions.text.family\r\n      )\r\n      techTooltipDataList.forEach(({ name, tooltipData, cbData }) => {\r\n        const tech = techs.get(name)\r\n        const styles = tech.styles || techOptions\r\n        const colors = styles.line.colors\r\n        const colorSize = colors.length\r\n        const plots = tech.plots\r\n        let lineCount = 0\r\n        let valueColor\r\n        plots.forEach((plot, i) => {\r\n          switch (plot.type) {\r\n            case TechnicalIndicatorPlotType.CIRCLE: {\r\n              valueColor = (plot.color && plot.color(cbData, styles)) || styles.circle.noChangeColor\r\n              break\r\n            }\r\n            case TechnicalIndicatorPlotType.BAR: {\r\n              valueColor = (plot.color && plot.color(cbData, styles)) || styles.bar.noChangeColor\r\n              break\r\n            }\r\n            case TechnicalIndicatorPlotType.LINE: {\r\n              valueColor = colors[lineCount % colorSize] || styles.text.color\r\n              lineCount++\r\n              break\r\n            }\r\n            default: { break }\r\n          }\r\n          const value = tooltipData.values[i]\r\n          if (isValid(value.title)) {\r\n            labelY += techTooltipTextMarginTop\r\n            this._ctx.textAlign = 'left'\r\n            this._ctx.fillStyle = valueColor\r\n            this._ctx.fillText(`${value.title}`, indicatorLabelX, labelY)\r\n\r\n            this._ctx.textAlign = 'right'\r\n            this._ctx.fillText(\r\n              value.value || techTooltipOptions.defaultValue,\r\n              rectX + rectWidth - rectBorderSize - techTooltipTextMarginRight - rectPaddingRight,\r\n              labelY\r\n            )\r\n            labelY += (techTooltipTextSize + techTooltipTextMarginBottom)\r\n          }\r\n        })\r\n      })\r\n    }\r\n    this._ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 获取蜡烛提示数据\r\n   * @param kLineData\r\n   * @param candleOptions\r\n   * @returns {*}\r\n   * @private\r\n   */\r\n  _getCandleTooltipData (kLineData, candleOptions) {\r\n    const baseValues = candleOptions.tooltip.values\r\n    let values = []\r\n    if (baseValues) {\r\n      if (isFunction(baseValues)) {\r\n        values = baseValues(kLineData, candleOptions) || []\r\n      } else if (isArray(baseValues)) {\r\n        values = baseValues\r\n      }\r\n    } else {\r\n      const pricePrecision = this._chartData.pricePrecision()\r\n      const volumePrecision = this._chartData.volumePrecision()\r\n      values = [\r\n        formatValue(kLineData, 'timestamp'),\r\n        formatValue(kLineData, 'open'),\r\n        formatValue(kLineData, 'close'),\r\n        formatValue(kLineData, 'high'),\r\n        formatValue(kLineData, 'low'),\r\n        formatValue(kLineData, 'volume')\r\n      ]\r\n      values.forEach((value, index) => {\r\n        switch (index) {\r\n          case 0: {\r\n            values[index] = formatDate(this._chartData.timeScaleStore().dateTimeFormat(), value, 'YYYY-MM-DD hh:mm')\r\n            break\r\n          }\r\n          case values.length - 1: {\r\n            values[index] = formatBigNumber(formatPrecision(value, volumePrecision))\r\n            break\r\n          }\r\n          default: {\r\n            values[index] = formatPrecision(value, pricePrecision)\r\n            break\r\n          }\r\n        }\r\n      })\r\n    }\r\n    return values\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport CandleView from '../view/CandleView'\r\nimport CandleOverlayView from '../view/CandleOverlayView'\r\nimport TechnicalIndicatorWidget from './TechnicalIndicatorWidget'\r\n\r\nexport default class CandleWidget extends TechnicalIndicatorWidget {\r\n  _createMainView (container, props) {\r\n    return new CandleView(container, props.chartData, props.xAxis, props.yAxis, props.paneId)\r\n  }\r\n\r\n  _createOverlayView (container, props) {\r\n    return new CandleOverlayView(container, props.chartData, props.xAxis, props.yAxis, props.paneId)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport TechnicalIndicatorPane from './TechnicalIndicatorPane'\r\nimport CandleWidget from '../widget/CandleWidget'\r\nimport YAxis from '../component/axis/YAxis'\r\n\r\nexport default class CandlePane extends TechnicalIndicatorPane {\r\n  _createYAxis (props) {\r\n    return new YAxis(props.chartData, true, props.id)\r\n  }\r\n\r\n  _createMainWidget (container, props) {\r\n    return new CandleWidget({\r\n      container,\r\n      chartData: props.chartData,\r\n      xAxis: props.xAxis,\r\n      yAxis: this._yAxis,\r\n      paneId: props.id\r\n    })\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport View from './View'\r\nimport { renderHorizontalLine, renderVerticalLine } from '../renderer/line'\r\nimport { createFont } from '../utils/canvas'\r\n\r\nexport default class XAxisView extends View {\r\n  constructor (container, chartData, xAxis) {\r\n    super(container, chartData)\r\n    this._xAxis = xAxis\r\n  }\r\n\r\n  _draw () {\r\n    const xAxisOptions = this._chartData.styleOptions().xAxis\r\n    if (xAxisOptions.show) {\r\n      this._drawAxisLine(xAxisOptions)\r\n      this._drawTickLines(xAxisOptions)\r\n      this._drawTickLabels(xAxisOptions)\r\n    }\r\n  }\r\n\r\n  _drawAxisLine (xAxisOptions) {\r\n    const xAxisLine = xAxisOptions.axisLine\r\n    if (!xAxisLine.show) {\r\n      return\r\n    }\r\n    this._ctx.strokeStyle = xAxisLine.color\r\n    this._ctx.lineWidth = xAxisLine.size\r\n    renderHorizontalLine(this._ctx, 0, 0, this._width)\r\n  }\r\n\r\n  _drawTickLines (xAxisOptions) {\r\n    const tickLine = xAxisOptions.tickLine\r\n    if (!tickLine.show) {\r\n      return\r\n    }\r\n    this._ctx.lineWidth = tickLine.size\r\n    this._ctx.strokeStyle = tickLine.color\r\n\r\n    const startY = xAxisOptions.axisLine.show ? xAxisOptions.axisLine.size : 0\r\n\r\n    const endY = startY + tickLine.length\r\n    this._xAxis.ticks().forEach(tick => {\r\n      renderVerticalLine(this._ctx, tick.x, startY, endY)\r\n    })\r\n  }\r\n\r\n  _drawTickLabels (xAxisOptions) {\r\n    const tickText = xAxisOptions.tickText\r\n    if (!tickText.show) {\r\n      return\r\n    }\r\n    const tickLine = xAxisOptions.tickLine\r\n\r\n    this._ctx.textBaseline = 'top'\r\n    this._ctx.font = createFont(tickText.size, tickText.weight, tickText.family)\r\n    this._ctx.textAlign = 'center'\r\n    this._ctx.fillStyle = tickText.color\r\n\r\n    let labelY = tickText.paddingTop\r\n    if (xAxisOptions.axisLine.show) {\r\n      labelY += (xAxisOptions.axisLine.size)\r\n    }\r\n    if (tickLine.show) {\r\n      labelY += (tickLine.length)\r\n    }\r\n    const ticks = this._xAxis.ticks()\r\n    const tickLength = ticks.length\r\n    for (let i = 0; i < tickLength; i++) {\r\n      this._ctx.fillText(ticks[i].v, ticks[i].x, labelY)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport View from './View'\r\n\r\nimport { formatDate } from '../utils/format'\r\nimport { calcTextWidth, createFont } from '../utils/canvas'\r\nimport { renderStrokeFillRoundRect } from '../renderer/rect'\r\nimport { renderText } from '../renderer/text'\r\n\r\nexport default class XAxisOverlayView extends View {\r\n  constructor (container, chartData, xAxis) {\r\n    super(container, chartData)\r\n    this._xAxis = xAxis\r\n  }\r\n\r\n  _draw () {\r\n    this._drawCrosshairLabel()\r\n  }\r\n\r\n  _drawCrosshairLabel () {\r\n    const crosshair = this._chartData.crosshairStore().get()\r\n    if (!crosshair.paneId) {\r\n      return\r\n    }\r\n    const crosshairOptions = this._chartData.styleOptions().crosshair\r\n    const crosshairVerticalOptions = crosshairOptions.vertical\r\n    const crosshairVerticalTextOptions = crosshairVerticalOptions.text\r\n    if (\r\n      !crosshairOptions.show ||\r\n      !crosshairVerticalOptions.show ||\r\n      !crosshairVerticalTextOptions.show ||\r\n      crosshair.dataIndex !== crosshair.realDataIndex\r\n    ) {\r\n      return\r\n    }\r\n    const x = crosshair.realX\r\n    const timestamp = crosshair.kLineData.timestamp\r\n    const text = formatDate(this._chartData.timeScaleStore().dateTimeFormat(), timestamp, 'YYYY-MM-DD hh:mm')\r\n\r\n    const textSize = crosshairVerticalTextOptions.size\r\n    this._ctx.font = createFont(textSize, crosshairVerticalTextOptions.weight, crosshairVerticalTextOptions.family)\r\n    const labelWidth = calcTextWidth(this._ctx, text)\r\n    let labelX = x - labelWidth / 2\r\n\r\n    const paddingLeft = crosshairVerticalTextOptions.paddingLeft\r\n    const paddingRight = crosshairVerticalTextOptions.paddingRight\r\n    const paddingTop = crosshairVerticalTextOptions.paddingTop\r\n    const paddingBottom = crosshairVerticalTextOptions.paddingBottom\r\n    const borderSize = crosshairVerticalTextOptions.borderSize\r\n\r\n    // 保证整个x轴上的提示文字总是完全显示\r\n    if (labelX < paddingLeft + borderSize) {\r\n      labelX = paddingLeft + borderSize\r\n    } else if (labelX > this._width - labelWidth - borderSize - paddingRight) {\r\n      labelX = this._width - labelWidth - borderSize - paddingRight\r\n    }\r\n\r\n    const rectX = labelX - borderSize - paddingLeft\r\n    const rectWidth = labelWidth + borderSize * 2 + paddingRight + paddingLeft\r\n    const rectHeight = textSize + borderSize * 2 + paddingTop + paddingBottom\r\n\r\n    renderStrokeFillRoundRect(\r\n      this._ctx, crosshairVerticalTextOptions.backgroundColor,\r\n      crosshairVerticalTextOptions.borderColor, borderSize,\r\n      rectX, 0, rectWidth, rectHeight, crosshairVerticalTextOptions.borderRadius\r\n    )\r\n    // 绘制轴上的提示文字\r\n    this._ctx.textBaseline = 'top'\r\n    renderText(\r\n      this._ctx, crosshairVerticalTextOptions.color,\r\n      labelX, borderSize + paddingTop, text\r\n    )\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Widget from './Widget'\r\nimport XAxisView from '../view/XAxisView'\r\nimport XAxisOverlayView from '../view/XAxisOverlayView'\r\n\r\nexport default class XAxisWidget extends Widget {\r\n  _createMainView (container, props) {\r\n    return new XAxisView(container, props.chartData, props.xAxis)\r\n  }\r\n\r\n  _createOverlayView (container, props) {\r\n    return new XAxisOverlayView(container, props.chartData, props.xAxis)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Axis from './Axis'\r\nimport { calcTextWidth, createFont } from '../../utils/canvas'\r\nimport { formatDate } from '../../utils/format'\r\nimport { isNumber } from '../../utils/typeChecks'\r\n\r\nexport default class XAxis extends Axis {\r\n  _computeMinMax () {\r\n    return { min: this._chartData.timeScaleStore().from(), max: this._chartData.timeScaleStore().to() - 1 }\r\n  }\r\n\r\n  _optimalMinMax ({ min, max }) {\r\n    return {\r\n      min,\r\n      max,\r\n      range: max - min + 1\r\n    }\r\n  }\r\n\r\n  _optimalTicks (ticks) {\r\n    const optimalTicks = []\r\n    const tickLength = ticks.length\r\n    const dataList = this._chartData.dataList()\r\n    if (tickLength > 0) {\r\n      const dateTimeFormat = this._chartData.timeScaleStore().dateTimeFormat()\r\n      const tickText = this._chartData.styleOptions().xAxis.tickText\r\n      this._measureCtx.font = createFont(tickText.size, tickText.weight, tickText.family)\r\n      const defaultLabelWidth = calcTextWidth(this._measureCtx, '00-00 00:00')\r\n      const pos = parseInt(ticks[0].v, 10)\r\n      const x = this.convertToPixel(pos)\r\n      let tickCountDif = 1\r\n      if (tickLength > 1) {\r\n        const nextPos = parseInt(ticks[1].v, 10)\r\n        const nextX = this.convertToPixel(nextPos)\r\n        const xDif = Math.abs(nextX - x)\r\n        if (xDif < defaultLabelWidth) {\r\n          tickCountDif = Math.ceil(defaultLabelWidth / xDif)\r\n        }\r\n      }\r\n      for (let i = 0; i < tickLength; i += tickCountDif) {\r\n        const pos = parseInt(ticks[i].v, 10)\r\n        const kLineData = dataList[pos]\r\n        const timestamp = kLineData.timestamp\r\n        let label = formatDate(dateTimeFormat, timestamp, 'hh:mm')\r\n        if (i !== 0) {\r\n          const prePos = parseInt(ticks[i - tickCountDif].v, 10)\r\n          const preKLineData = dataList[prePos]\r\n          const preTimestamp = preKLineData.timestamp\r\n          label = this._optimalTickLabel(dateTimeFormat, timestamp, preTimestamp) || label\r\n        }\r\n        const x = this.convertToPixel(pos)\r\n        optimalTicks.push({ v: label, x, oV: timestamp })\r\n      }\r\n      const optimalTickLength = optimalTicks.length\r\n      if (optimalTickLength === 1) {\r\n        optimalTicks[0].v = formatDate(dateTimeFormat, optimalTicks[0].oV, 'YYYY-MM-DD hh:mm')\r\n      } else {\r\n        const firstTimestamp = optimalTicks[0].oV\r\n        const secondTimestamp = optimalTicks[1].oV\r\n        if (optimalTicks[2]) {\r\n          const thirdV = optimalTicks[2].v\r\n          if (/^[0-9]{2}-[0-9]{2}$/.test(thirdV)) {\r\n            optimalTicks[0].v = formatDate(dateTimeFormat, firstTimestamp, 'MM-DD')\r\n          } else if (/^[0-9]{4}-[0-9]{2}$/.test(thirdV)) {\r\n            optimalTicks[0].v = formatDate(dateTimeFormat, firstTimestamp, 'YYYY-MM')\r\n          } else if (/^[0-9]{4}$/.test(thirdV)) {\r\n            optimalTicks[0].v = formatDate(dateTimeFormat, firstTimestamp, 'YYYY')\r\n          }\r\n        } else {\r\n          optimalTicks[0].v = this._optimalTickLabel(dateTimeFormat, firstTimestamp, secondTimestamp) || optimalTicks[0].v\r\n        }\r\n      }\r\n    }\r\n    return optimalTicks\r\n  }\r\n\r\n  _optimalTickLabel (dateTimeFormat, timestamp, comparedTimestamp) {\r\n    const year = formatDate(dateTimeFormat, timestamp, 'YYYY')\r\n    const month = formatDate(dateTimeFormat, timestamp, 'YYYY-MM')\r\n    const day = formatDate(dateTimeFormat, timestamp, 'MM-DD')\r\n    if (year !== formatDate(dateTimeFormat, comparedTimestamp, 'YYYY')) {\r\n      return year\r\n    } else if (month !== formatDate(dateTimeFormat, comparedTimestamp, 'YYYY-MM')) {\r\n      return month\r\n    } else if (day !== formatDate(dateTimeFormat, comparedTimestamp, 'MM-DD')) {\r\n      return day\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 获取自身高度\r\n   */\r\n  getSelfHeight () {\r\n    const stylOptions = this._chartData.styleOptions()\r\n    const xAxisOptions = stylOptions.xAxis\r\n    const height = xAxisOptions.height\r\n    if (isNumber(height)) {\r\n      return height\r\n    }\r\n    const crosshairOptions = stylOptions.crosshair\r\n    let xAxisHeight = 0\r\n    if (xAxisOptions.show) {\r\n      if (xAxisOptions.axisLine.show) {\r\n        xAxisHeight += xAxisOptions.axisLine.size\r\n      }\r\n      if (xAxisOptions.tickLine.show) {\r\n        xAxisHeight += xAxisOptions.tickLine.length\r\n      }\r\n      if (xAxisOptions.tickText.show) {\r\n        xAxisHeight += (xAxisOptions.tickText.paddingTop + xAxisOptions.tickText.paddingBottom + xAxisOptions.tickText.size)\r\n      }\r\n    }\r\n    let crosshairVerticalTextHeight = 0\r\n    if (\r\n      crosshairOptions.show &&\r\n      crosshairOptions.vertical.show &&\r\n      crosshairOptions.vertical.text.show\r\n    ) {\r\n      crosshairVerticalTextHeight += (\r\n        crosshairOptions.vertical.text.paddingTop +\r\n        crosshairOptions.vertical.text.paddingBottom +\r\n        crosshairOptions.vertical.text.borderSize * 2 +\r\n        crosshairOptions.vertical.text.size\r\n      )\r\n    }\r\n    return Math.max(xAxisHeight, crosshairVerticalTextHeight)\r\n  }\r\n\r\n  convertFromPixel (pixel) {\r\n    return this._chartData.timeScaleStore().coordinateToDataIndex(pixel)\r\n  }\r\n\r\n  convertToPixel (value) {\r\n    return this._chartData.timeScaleStore().dataIndexToCoordinate(value)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Pane from './Pane'\r\nimport XAxisWidget from '../widget/XAxisWidget'\r\nimport XAxis from '../component/axis/XAxis'\r\n\r\nexport default class XAxisPane extends Pane {\r\n  _initBefore () {\r\n    this._xAxis = new XAxis(this._chartData)\r\n  }\r\n\r\n  _createMainWidget (container, props) {\r\n    return new XAxisWidget({ container, chartData: props.chartData, xAxis: this._xAxis })\r\n  }\r\n\r\n  xAxis () {\r\n    return this._xAxis\r\n  }\r\n\r\n  setWidth (mainWidgetWidth, yAxisWidgetWidth) {\r\n    super.setWidth(mainWidgetWidth, yAxisWidgetWidth)\r\n    this._xAxis.setWidth(mainWidgetWidth)\r\n  }\r\n\r\n  setHeight (height) {\r\n    super.setHeight(height)\r\n    this._xAxis.setHeight(height)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * The file comes from tradingview/lightweight-charts\r\n * https://www.tradingview.com/\r\n * Convert files from typescript to javascript.\r\n * Modified the class name.\r\n * The use of the source code of this file is also subject to the terms\r\n * and consitions of the license of \"lightweight-charts\" (Apache License V2, see\r\n * </licenses/LICENSE-lightweight-charts>).\r\n */\r\n\r\nconst MouseEventButton = {\r\n  LEFT: 0,\r\n  RIGHT: 2\r\n}\r\n\r\nconst DELAY_RESET_CLICK = 500\r\nconst DELAY_LONG_TAG = 600\r\n\r\nfunction getBoundingClientRect (element) {\r\n  return element.getBoundingClientRect() || { left: 0, top: 0 }\r\n}\r\n\r\nfunction isTouchEvent (event) {\r\n  return Boolean(event.touches)\r\n}\r\n\r\nfunction preventDefault (event) {\r\n  if (event.cancelable) {\r\n    event.preventDefault()\r\n  }\r\n}\r\n\r\nfunction checkTouchEvents () {\r\n  if ('ontouchstart' in window) {\r\n    return true\r\n  }\r\n\r\n  return Boolean(window.DocumentTouch && document instanceof window.DocumentTouch)\r\n}\r\n\r\nconst touch = !!navigator.maxTouchPoints || !!navigator.msMaxTouchPoints || checkTouchEvents()\r\nconst mobileTouch = 'onorientationchange' in window && touch\r\n\r\nfunction getDistance (p1, p2) {\r\n  const xDiff = p1.clientX - p2.clientX\r\n  const yDiff = p1.clientY - p2.clientY\r\n  return Math.sqrt(xDiff * xDiff + yDiff * yDiff)\r\n}\r\n\r\nexport const EventType = {\r\n  MOUSE: 'mouse',\r\n  TOUCH: 'touch'\r\n}\r\n\r\nexport default class EventBase {\r\n  constructor (target, eventHandler, options) {\r\n    this._target = target\r\n    this._handler = eventHandler\r\n    this._options = options\r\n\r\n    this._clickCount = 0\r\n    this._clickTimeoutId = null\r\n    this._longTapTimeoutId = null\r\n    this._longTapActive = false\r\n    this._mouseMoveStartPosition = null\r\n    this._moveExceededManhattanDistance = false\r\n    this._cancelClick = false\r\n    this._unsubscribeOutsideEvents = null\r\n    this._unsubscribeMousemove = null\r\n    this._unsubscribeRoot = null\r\n\r\n    this._startPinchMiddleCoordinate = null\r\n    this._startPinchDistance = 0\r\n    this._pinchPrevented = false\r\n    this._preventDragProcess = false\r\n\r\n    this._mousePressed = false\r\n\r\n    this._init()\r\n  }\r\n\r\n  destroy () {\r\n    if (this._unsubscribeOutsideEvents !== null) {\r\n      this._unsubscribeOutsideEvents()\r\n      this._unsubscribeOutsideEvents = null\r\n    }\r\n\r\n    if (this._unsubscribeMousemove !== null) {\r\n      this._unsubscribeMousemove()\r\n      this._unsubscribeMousemove = null\r\n    }\r\n\r\n    if (this._unsubscribeRoot !== null) {\r\n      this._unsubscribeRoot()\r\n      this._unsubscribeRoot = null\r\n    }\r\n\r\n    this._clearLongTapTimeout()\r\n    this._resetClickTimeout()\r\n  }\r\n\r\n  _mouseEnterHandler (enterEvent) {\r\n    if (this._unsubscribeMousemove) {\r\n      this._unsubscribeMousemove()\r\n    }\r\n\r\n    {\r\n      const boundMouseMoveHandler = this._mouseMoveHandler.bind(this)\r\n      const boundMouseWheelHandler = this._mouseWheelHandler.bind(this)\r\n      this._unsubscribeMousemove = () => {\r\n        this._target.removeEventListener('mousemove', boundMouseMoveHandler)\r\n        this._target.removeEventListener('wheel', boundMouseWheelHandler)\r\n      }\r\n      this._target.addEventListener('mousemove', boundMouseMoveHandler)\r\n      this._target.addEventListener('wheel', boundMouseWheelHandler, { passive: false })\r\n    }\r\n\r\n    if (isTouchEvent(enterEvent)) {\r\n      this._mouseMoveHandler(enterEvent)\r\n    }\r\n\r\n    const compatEvent = this._makeCompatEvent(enterEvent)\r\n    this._processEvent(compatEvent, this._handler.mouseEnterEvent)\r\n  }\r\n\r\n  _resetClickTimeout () {\r\n    if (this._clickTimeoutId !== null) {\r\n      clearTimeout(this._clickTimeoutId)\r\n    }\r\n\r\n    this._clickCount = 0\r\n    this._clickTimeoutId = null\r\n  }\r\n\r\n  _mouseMoveHandler (moveEvent) {\r\n    if (this._mousePressed && !isTouchEvent(moveEvent)) {\r\n      return\r\n    }\r\n\r\n    const compatEvent = this._makeCompatEvent(moveEvent)\r\n    this._processEvent(compatEvent, this._handler.mouseMoveEvent)\r\n  }\r\n\r\n  _mouseWheelHandler (wheelEvent) {\r\n    const compatEvent = this._makeCompatEvent(wheelEvent)\r\n    wheelEvent.localX = compatEvent.localX\r\n    wheelEvent.localY = compatEvent.localY\r\n    this._processEvent(wheelEvent, this._handler.mouseWheelEvent)\r\n  }\r\n\r\n  _mouseMoveWithDownHandler (moveEvent) {\r\n    if ('button' in moveEvent && moveEvent.button !== MouseEventButton.LEFT) {\r\n      return\r\n    }\r\n\r\n    if (this._startPinchMiddleCoordinate !== null) {\r\n      return\r\n    }\r\n\r\n    const isTouch = isTouchEvent(moveEvent)\r\n    if (this._preventDragProcess && isTouch) {\r\n      return\r\n    }\r\n\r\n    this._pinchPrevented = true\r\n\r\n    const compatEvent = this._makeCompatEvent(moveEvent)\r\n\r\n    const startMouseMovePos = this._mouseMoveStartPosition\r\n    const xOffset = Math.abs(startMouseMovePos.x - compatEvent.pageX)\r\n    const yOffset = Math.abs(startMouseMovePos.y - compatEvent.pageY)\r\n\r\n    const moveExceededManhattanDistance = xOffset + yOffset > 5\r\n\r\n    if (!moveExceededManhattanDistance && isTouch) {\r\n      return\r\n    }\r\n\r\n    if (moveExceededManhattanDistance && !this._moveExceededManhattanDistance && isTouch) {\r\n      // vertical drag is more important than horizontal drag\r\n      // because we scroll the page vertically often than horizontally\r\n      const correctedXOffset = xOffset * 0.5\r\n\r\n      // a drag can be only if touch page scroll isn't allowed\r\n      const isVertDrag = yOffset >= correctedXOffset && !this._options.treatVertTouchDragAsPageScroll\r\n      const isHorzDrag = correctedXOffset > yOffset && !this._options.treatHorzTouchDragAsPageScroll\r\n\r\n      // if drag event happened then we should revert preventDefault state to original one\r\n      // and try to process the drag event\r\n      // else we shouldn't prevent default of the event and ignore processing the drag event\r\n      if (!isVertDrag && !isHorzDrag) {\r\n        this._preventDragProcess = true\r\n      }\r\n    }\r\n\r\n    if (moveExceededManhattanDistance) {\r\n      this._moveExceededManhattanDistance = true\r\n\r\n      // if manhattan distance is more that 5 - we should cancel click event\r\n      this._cancelClick = true\r\n\r\n      if (isTouch) {\r\n        this._clearLongTapTimeout()\r\n      }\r\n    }\r\n\r\n    if (!this._preventDragProcess) {\r\n      this._processEvent(compatEvent, this._handler.pressedMouseMoveEvent)\r\n\r\n      // we should prevent default in case of touch only\r\n      // to prevent scroll of the page\r\n      if (isTouch) {\r\n        preventDefault(moveEvent)\r\n      }\r\n    }\r\n  }\r\n\r\n  _mouseUpHandler (mouseUpEvent) {\r\n    if ('button' in mouseUpEvent && mouseUpEvent.button !== MouseEventButton.LEFT) {\r\n      return\r\n    }\r\n    const compatEvent = this._makeCompatEvent(mouseUpEvent)\r\n\r\n    this._clearLongTapTimeout()\r\n\r\n    this._mouseMoveStartPosition = null\r\n\r\n    this._mousePressed = false\r\n\r\n    if (this._unsubscribeRoot) {\r\n      this._unsubscribeRoot()\r\n      this._unsubscribeRoot = null\r\n    }\r\n\r\n    if (isTouchEvent(mouseUpEvent)) {\r\n      this._mouseLeaveHandler(mouseUpEvent)\r\n    }\r\n\r\n    this._processEvent(compatEvent, this._handler.mouseUpEvent)\r\n    ++this._clickCount\r\n    if (this._clickTimeoutId && this._clickCount > 1) {\r\n      this._processEvent(compatEvent, this._handler.mouseDoubleClickEvent)\r\n      this._resetClickTimeout()\r\n    } else {\r\n      if (!this._cancelClick) {\r\n        this._processEvent(compatEvent, this._handler.mouseClickEvent)\r\n      }\r\n    }\r\n\r\n    // prevent safari's dblclick-to-zoom\r\n    // we handle mouseDoubleClickEvent here ourself\r\n    if (isTouchEvent(mouseUpEvent)) {\r\n      preventDefault(mouseUpEvent)\r\n\r\n      this._mouseLeaveHandler(mouseUpEvent)\r\n\r\n      if (mouseUpEvent.touches.length === 0) {\r\n        this._longTapActive = false\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearLongTapTimeout () {\r\n    if (this._longTapTimeoutId === null) {\r\n      return\r\n    }\r\n\r\n    clearTimeout(this._longTapTimeoutId)\r\n    this._longTapTimeoutId = null\r\n  }\r\n\r\n  _mouseDownHandler (downEvent) {\r\n    if ('button' in downEvent && downEvent.button !== MouseEventButton.LEFT && downEvent.button !== MouseEventButton.RIGHT) {\r\n      return\r\n    }\r\n    const compatEvent = this._makeCompatEvent(downEvent)\r\n    if ('button' in downEvent && downEvent.button === MouseEventButton.RIGHT) {\r\n      this._processEvent(compatEvent, this._handler.mouseRightDownEvent)\r\n      return\r\n    }\r\n    this._cancelClick = false\r\n    this._moveExceededManhattanDistance = false\r\n    this._preventDragProcess = false\r\n\r\n    if (isTouchEvent(downEvent)) {\r\n      this._mouseEnterHandler(downEvent)\r\n    }\r\n\r\n    this._mouseMoveStartPosition = {\r\n      x: compatEvent.pageX,\r\n      y: compatEvent.pageY\r\n    }\r\n\r\n    if (this._unsubscribeRoot) {\r\n      this._unsubscribeRoot()\r\n      this._unsubscribeRoot = null\r\n    }\r\n\r\n    {\r\n      const boundMouseMoveWithDownHandler = this._mouseMoveWithDownHandler.bind(this)\r\n      const boundMouseUpHandler = this._mouseUpHandler.bind(this)\r\n      const rootElement = this._target.ownerDocument.documentElement\r\n\r\n      this._unsubscribeRoot = () => {\r\n        rootElement.removeEventListener('touchmove', boundMouseMoveWithDownHandler)\r\n        rootElement.removeEventListener('touchend', boundMouseUpHandler)\r\n\r\n        rootElement.removeEventListener('mousemove', boundMouseMoveWithDownHandler)\r\n        rootElement.removeEventListener('mouseup', boundMouseUpHandler)\r\n      }\r\n\r\n      rootElement.addEventListener('touchmove', boundMouseMoveWithDownHandler, { passive: false })\r\n      rootElement.addEventListener('touchend', boundMouseUpHandler, { passive: false })\r\n\r\n      this._clearLongTapTimeout()\r\n\r\n      if (isTouchEvent(downEvent) && downEvent.touches.length === 1) {\r\n        this._longTapTimeoutId = setTimeout(this._longTapHandler.bind(this, downEvent), DELAY_LONG_TAG)\r\n      } else {\r\n        rootElement.addEventListener('mousemove', boundMouseMoveWithDownHandler)\r\n        rootElement.addEventListener('mouseup', boundMouseUpHandler)\r\n      }\r\n    }\r\n\r\n    this._mousePressed = true\r\n    this._processEvent(compatEvent, this._handler.mouseDownEvent)\r\n\r\n    if (!this._clickTimeoutId) {\r\n      this._clickCount = 0\r\n      this._clickTimeoutId = setTimeout(this._resetClickTimeout.bind(this), DELAY_RESET_CLICK)\r\n    }\r\n  }\r\n\r\n  _init () {\r\n    this._target.addEventListener('mouseenter', this._mouseEnterHandler.bind(this))\r\n\r\n    this._target.addEventListener('touchcancel', this._clearLongTapTimeout.bind(this))\r\n\r\n    {\r\n      const doc = this._target.ownerDocument\r\n\r\n      const outsideHandler = (event) => {\r\n        if (!this._handler.mouseDownOutsideEvent) {\r\n          return\r\n        }\r\n        if (event.target && this._target.contains(event.target)) {\r\n          return\r\n        }\r\n        this._handler.mouseDownOutsideEvent()\r\n      }\r\n\r\n      this._unsubscribeOutsideEvents = () => {\r\n        doc.removeEventListener('mousedown', outsideHandler)\r\n        doc.removeEventListener('touchstart', outsideHandler)\r\n      }\r\n\r\n      doc.addEventListener('mousedown', outsideHandler)\r\n      doc.addEventListener('touchstart', outsideHandler, { passive: true })\r\n    }\r\n\r\n    this._target.addEventListener('mouseleave', this._mouseLeaveHandler.bind(this))\r\n\r\n    this._target.addEventListener('touchstart', this._mouseDownHandler.bind(this), { passive: true })\r\n    if (!mobileTouch) {\r\n      this._target.addEventListener('mousedown', this._mouseDownHandler.bind(this))\r\n    }\r\n\r\n    this._initPinch()\r\n\r\n    // Hey mobile Safari, what's up?\r\n    // If mobile Safari doesn't have any touchmove handler with passive=false\r\n    // it treats a touchstart and the following touchmove events as cancelable=false,\r\n    // so we can't prevent them (as soon we subscribe on touchmove inside handler of touchstart).\r\n    // And we'll get scroll of the page along with chart's one instead of only chart's scroll.\r\n    this._target.addEventListener('touchmove', () => {}, { passive: false })\r\n  }\r\n\r\n  _initPinch () {\r\n    if (this._handler.pinchStartEvent === undefined &&\r\n      this._handler.pinchEvent === undefined &&\r\n      this._handler.pinchEndEvent === undefined\r\n    ) {\r\n      return\r\n    }\r\n\r\n    this._target.addEventListener(\r\n      'touchstart',\r\n      (event) => this._checkPinchState(event.touches),\r\n      { passive: true }\r\n    )\r\n\r\n    this._target.addEventListener(\r\n      'touchmove',\r\n      (event) => {\r\n        if (event.touches.length !== 2 || this._startPinchMiddleCoordinate === null) {\r\n          return\r\n        }\r\n\r\n        if (this._handler.pinchEvent !== undefined) {\r\n          const currentDistance = getDistance(event.touches[0], event.touches[1])\r\n          const scale = currentDistance / this._startPinchDistance\r\n          this._handler.pinchEvent(this._startPinchMiddleCoordinate, scale)\r\n          preventDefault(event)\r\n        }\r\n      },\r\n      { passive: false }\r\n    )\r\n\r\n    this._target.addEventListener('touchend', (event) => {\r\n      this._checkPinchState(event.touches)\r\n    })\r\n  }\r\n\r\n  _checkPinchState (touches) {\r\n    if (touches.length === 1) {\r\n      this._pinchPrevented = false\r\n    }\r\n\r\n    if (touches.length !== 2 || this._pinchPrevented || this._longTapActive) {\r\n      this._stopPinch()\r\n    } else {\r\n      this._startPinch(touches)\r\n    }\r\n  }\r\n\r\n  _startPinch (touches) {\r\n    const box = getBoundingClientRect(this._target)\r\n    this._startPinchMiddleCoordinate = {\r\n      x: ((touches[0].clientX - box.left) + (touches[1].clientX - box.left)) / 2,\r\n      y: ((touches[0].clientY - box.top) + (touches[1].clientY - box.top)) / 2\r\n    }\r\n\r\n    this._startPinchDistance = getDistance(touches[0], touches[1])\r\n\r\n    if (this._handler.pinchStartEvent !== undefined) {\r\n      this._handler.pinchStartEvent()\r\n    }\r\n\r\n    this._clearLongTapTimeout()\r\n  }\r\n\r\n  _stopPinch () {\r\n    if (this._startPinchMiddleCoordinate === null) {\r\n      return\r\n    }\r\n\r\n    this._startPinchMiddleCoordinate = null\r\n\r\n    if (this._handler.pinchEndEvent !== undefined) {\r\n      this._handler.pinchEndEvent()\r\n    }\r\n  }\r\n\r\n  _mouseLeaveHandler (event) {\r\n    if (this._unsubscribeMousemove) {\r\n      this._unsubscribeMousemove()\r\n    }\r\n    const compatEvent = this._makeCompatEvent(event)\r\n    this._processEvent(compatEvent, this._handler.mouseLeaveEvent)\r\n  }\r\n\r\n  _longTapHandler (event) {\r\n    const compatEvent = this._makeCompatEvent(event)\r\n    this._processEvent(compatEvent, this._handler.longTapEvent)\r\n    this._cancelClick = true\r\n\r\n    // long tap is active untill touchend event with 0 touches occured\r\n    this._longTapActive = true\r\n  }\r\n\r\n  _processEvent (event, callback) {\r\n    if (!callback) {\r\n      return\r\n    }\r\n    callback.call(this._handler, event)\r\n  }\r\n\r\n  _makeCompatEvent (event) {\r\n  // TouchEvent has no clientX/Y coordinates:\r\n  // We have to use the last Touch instead\r\n    let eventLike\r\n    if ('touches' in event && event.touches.length) {\r\n      eventLike = event.touches[0]\r\n    } else if ('changedTouches' in event && event.changedTouches.length) {\r\n      eventLike = event.changedTouches[0]\r\n    } else {\r\n      eventLike = event\r\n    }\r\n\r\n    const box = getBoundingClientRect(this._target)\r\n\r\n    return {\r\n      clientX: eventLike.clientX,\r\n      clientY: eventLike.clientY,\r\n      pageX: eventLike.pageX,\r\n      pageY: eventLike.pageY,\r\n      screenX: eventLike.screenX,\r\n      screenY: eventLike.screenY,\r\n      localX: eventLike.clientX - box.left,\r\n      localY: eventLike.clientY - box.top,\r\n\r\n      ctrlKey: event.ctrlKey,\r\n      altKey: event.altKey,\r\n      shiftKey: event.shiftKey,\r\n      metaKey: event.metaKey,\r\n\r\n      type: event.type.startsWith('mouse') ? EventType.MOUSE : EventType.TOUCH,\r\n\r\n      target: eventLike.target,\r\n      view: event.view\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport EventBase from '../event/EventBase'\r\nimport { getPixelRatio } from '../utils/canvas'\r\nimport { isValid } from '../utils/typeChecks'\r\nimport { createElement } from '../utils/element'\r\n\r\nexport default class SeparatorPane {\r\n  constructor (container, chartData, topPaneId, bottomPaneId, dragEnabled, dragEventHandler) {\r\n    this._chartData = chartData\r\n    this._topPaneId = topPaneId\r\n    this._bottomPaneId = bottomPaneId\r\n    this._dragEnabled = dragEnabled\r\n    this._width = 0\r\n    this._offsetLeft = 0\r\n    this._dragEventHandler = dragEventHandler\r\n    this._dragFlag = false\r\n    this._initElement(container)\r\n    this._initEvent(dragEnabled)\r\n  }\r\n\r\n  /**\r\n   * 初始化dom元素\r\n   * @param container\r\n   * @private\r\n   */\r\n  _initElement (container) {\r\n    this._container = container\r\n    this._wrapper = createElement('div', {\r\n      margin: '0', padding: '0', position: 'relative'\r\n    })\r\n    this._element = createElement('div', {\r\n      width: '100%',\r\n      height: '7px',\r\n      margin: '0',\r\n      padding: '0',\r\n      position: 'absolute',\r\n      top: '-3px',\r\n      zIndex: '20'\r\n    })\r\n    this._wrapper.appendChild(this._element)\r\n    const lastElement = container.lastChild\r\n    if (lastElement) {\r\n      container.insertBefore(this._wrapper, lastElement)\r\n    } else {\r\n      container.appendChild(this._wrapper)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 初始化事件\r\n   * @param dragEnabled\r\n   * @private\r\n   */\r\n  _initEvent (dragEnabled) {\r\n    if (dragEnabled) {\r\n      this._element.style.cursor = 'ns-resize'\r\n      this._dragEvent = new EventBase(this._element, {\r\n        mouseDownEvent: this._mouseDownEvent.bind(this),\r\n        mouseUpEvent: this._mouseUpEvent.bind(this),\r\n        pressedMouseMoveEvent: this._pressedMouseMoveEvent.bind(this),\r\n        mouseEnterEvent: this._mouseEnterEvent.bind(this),\r\n        mouseLeaveEvent: this._mouseLeaveEvent.bind(this)\r\n      }, {\r\n        treatVertTouchDragAsPageScroll: false,\r\n        treatHorzTouchDragAsPageScroll: true\r\n      })\r\n    }\r\n  }\r\n\r\n  _mouseDownEvent (event) {\r\n    this._dragFlag = true\r\n    this._startY = event.pageY\r\n    this._dragEventHandler.startDrag(this._topPaneId, this._bottomPaneId)\r\n  }\r\n\r\n  _mouseUpEvent () {\r\n    this._dragFlag = false\r\n    this._chartData.setDragPaneFlag(false)\r\n  }\r\n\r\n  _pressedMouseMoveEvent (event) {\r\n    const dragDistance = event.pageY - this._startY\r\n    this._dragEventHandler.drag(dragDistance, this._topPaneId, this._bottomPaneId)\r\n    this._chartData.setDragPaneFlag(true)\r\n    this._chartData.crosshairStore().set()\r\n  }\r\n\r\n  _mouseEnterEvent () {\r\n    const separatorOptions = this._chartData.styleOptions().separator\r\n    this._element.style.background = separatorOptions.activeBackgroundColor\r\n    this._chartData.setDragPaneFlag(true)\r\n    this._chartData.crosshairStore().set()\r\n  }\r\n\r\n  _mouseLeaveEvent () {\r\n    if (!this._dragFlag) {\r\n      this._element.style.background = null\r\n      this._chartData.setDragPaneFlag(false)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取高度\r\n   * @returns {number}\r\n   */\r\n  height () {\r\n    return this._wrapper.offsetHeight\r\n  }\r\n\r\n  /**\r\n   * 设置尺寸\r\n   * 用于fill属性\r\n   * @param offsetLeft\r\n   * @param width\r\n   */\r\n  setSize (offsetLeft, width) {\r\n    this._offsetLeft = offsetLeft\r\n    this._width = width\r\n    this.invalidate()\r\n  }\r\n\r\n  /**\r\n   * 设置是否可以拖拽\r\n   * @param dragEnabled\r\n   */\r\n  setDragEnabled (dragEnabled) {\r\n    if (dragEnabled !== this._dragEnabled) {\r\n      this._dragEnabled = dragEnabled\r\n      if (dragEnabled) {\r\n        !this._dragEvent && this._initEvent(dragEnabled)\r\n      } else {\r\n        this._element.style.cursor = 'default'\r\n        this._dragEvent && this._dragEvent.destroy()\r\n        this._dragEvent = null\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 顶部paneId\r\n   * @return {*}\r\n   */\r\n  topPaneId () {\r\n    return this._topPaneId\r\n  }\r\n\r\n  /**\r\n   * 底部paneId\r\n   * @return {*}\r\n   */\r\n  bottomPaneId () {\r\n    return this._bottomPaneId\r\n  }\r\n\r\n  /**\r\n   * 更新上下两个图表的索引\r\n   * @param topPaneId\r\n   * @param bottomPaneId\r\n   */\r\n  updatePaneId (topPaneId, bottomPaneId) {\r\n    if (isValid(topPaneId)) {\r\n      this._topPaneId = topPaneId\r\n    }\r\n    if (isValid(bottomPaneId)) {\r\n      this._bottomPaneId = bottomPaneId\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 刷新\r\n   */\r\n  invalidate () {\r\n    const separatorOptions = this._chartData.styleOptions().separator\r\n    this._element.style.top = `${-Math.floor((7 - separatorOptions.size) / 2)}px`\r\n    this._wrapper.style.backgroundColor = separatorOptions.color\r\n    this._wrapper.style.height = `${separatorOptions.size}px`\r\n    this._wrapper.style.marginLeft = `${separatorOptions.fill ? 0 : this._offsetLeft}px`\r\n    this._wrapper.style.width = separatorOptions.fill ? '100%' : `${this._width}px`\r\n  }\r\n\r\n  /**\r\n   * 将图形转换成图片\r\n   * @returns {HTMLCanvasElement}\r\n   */\r\n  getImage () {\r\n    const separatorOptions = this._chartData.styleOptions().separator\r\n    const width = this._wrapper.offsetWidth\r\n    const height = separatorOptions.size\r\n    const canvas = createElement('canvas', {\r\n      width: `${width}px`,\r\n      height: `${height}px`\r\n    })\r\n    const ctx = canvas.getContext('2d')\r\n    const pixelRatio = getPixelRatio(canvas)\r\n    canvas.width = width * pixelRatio\r\n    canvas.height = height * pixelRatio\r\n    ctx.scale(pixelRatio, pixelRatio)\r\n    ctx.fillStyle = separatorOptions.color\r\n    ctx.fillRect(this._offsetLeft, 0, width, height)\r\n    return canvas\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy () {\r\n    if (this._dragEvent) {\r\n      this._dragEvent.destroy()\r\n    }\r\n    this._container.removeChild(this._wrapper)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { EventType } from './EventBase'\r\n\r\nexport function isTouch (event) {\r\n  return event.type === EventType.TOUCH\r\n}\r\n\r\nexport function isMouse (event) {\r\n  return event.type === EventType.MOUSE\r\n}\r\n\r\nexport default class EventHandler {\r\n  constructor (chartData) {\r\n    this._chartData = chartData\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport EventHandler, { isMouse, isTouch } from './EventHandler'\r\n\r\nconst TOUCH_MIN_RADIUS = 10\r\n\r\nexport default class ZoomScrollEventHandler extends EventHandler {\r\n  constructor (chartData) {\r\n    super(chartData)\r\n    // 开始滚动时坐标点\r\n    this._startScrollCoordinate = {}\r\n    // 开始触摸时坐标\r\n    this._touchCoordinate = null\r\n    // 是否是取消了十字光标\r\n    this._touchCancelCrosshair = false\r\n    // 是否缩放过\r\n    this._touchZoomed = false\r\n    // 用来记录捏合缩放的尺寸\r\n    this._pinchScale = 1\r\n  }\r\n\r\n  pinchStartEvent () {\r\n    this._pinchScale = 1\r\n    this._touchZoomed = true\r\n  }\r\n\r\n  pinchEvent (middleCoordinate, scale) {\r\n    const zoomScale = (scale - this._pinchScale) * 5\r\n    this._pinchScale = scale\r\n    this._chartData.timeScaleStore().zoom(zoomScale, middleCoordinate)\r\n  }\r\n\r\n  mouseLeaveEvent (event) {\r\n    if (isMouse(event)) {\r\n      this._chartData.crosshairStore().set()\r\n    }\r\n  }\r\n\r\n  mouseMoveEvent (event) {\r\n    if (!isMouse(event)) {\r\n      return\r\n    }\r\n    this._chartData.crosshairStore().set({ x: event.localX, y: event.paneY, paneId: event.paneId })\r\n  }\r\n\r\n  mouseWheelEvent (event) {\r\n    if (Math.abs(event.deltaX) > Math.abs(event.deltaY)) {\r\n      if (event.cancelable) {\r\n        event.preventDefault()\r\n      }\r\n      if (Math.abs(event.deltaX) === 0) {\r\n        return\r\n      }\r\n      this._chartData.timeScaleStore().startScroll()\r\n      this._chartData.timeScaleStore().scroll(-event.deltaX)\r\n    } else {\r\n      let deltaY = -(event.deltaY / 100)\r\n      if (deltaY === 0) {\r\n        return\r\n      }\r\n      if (event.cancelable) {\r\n        event.preventDefault()\r\n      }\r\n\r\n      switch (event.deltaMode) {\r\n        case event.DOM_DELTA_PAGE:\r\n          deltaY *= 120\r\n          break\r\n\r\n        case event.DOM_DELTA_LINE:\r\n          deltaY *= 32\r\n          break\r\n      }\r\n\r\n      if (deltaY !== 0) {\r\n        const scale = Math.sign(deltaY) * Math.min(1, Math.abs(deltaY))\r\n        this._chartData.timeScaleStore().zoom(scale, { x: event.localX, y: event.localY })\r\n      }\r\n    }\r\n  }\r\n\r\n  mouseClickEvent (event) {\r\n    if (!isTouch(event)) {\r\n      return\r\n    }\r\n    if (!this._touchCoordinate && !this._touchCancelCrosshair && !this._touchZoomed) {\r\n      this._touchCoordinate = { x: event.localX, y: event.localY }\r\n      this._chartData.crosshairStore().set({ x: event.localX, y: event.paneY, paneId: event.paneId })\r\n    }\r\n  }\r\n\r\n  mouseDownEvent (event) {\r\n    this._startScrollCoordinate = { x: event.localX, y: event.localY }\r\n    this._chartData.timeScaleStore().startScroll()\r\n    if (isTouch(event)) {\r\n      this._touchZoomed = false\r\n      if (this._touchCoordinate) {\r\n        const xDif = event.localX - this._touchCoordinate.x\r\n        const yDif = event.localY - this._touchCoordinate.y\r\n        const radius = Math.sqrt(xDif * xDif + yDif * yDif)\r\n        if (radius < TOUCH_MIN_RADIUS) {\r\n          this._touchCoordinate = { x: event.localX, y: event.localY }\r\n          this._chartData.crosshairStore().set({ x: event.localX, y: event.paneY, paneId: event.paneId })\r\n        } else {\r\n          this._touchCancelCrosshair = true\r\n          this._touchCoordinate = null\r\n          this._chartData.crosshairStore().set()\r\n        }\r\n      } else {\r\n        this._touchCancelCrosshair = false\r\n      }\r\n    }\r\n  }\r\n\r\n  pressedMouseMoveEvent (event) {\r\n    let crosshair = { x: event.localX, y: event.paneY, paneId: event.paneId }\r\n    if (isTouch(event)) {\r\n      if (this._touchCoordinate) {\r\n        this._touchCoordinate = { x: event.localX, y: event.localY }\r\n        this._chartData.crosshairStore().set(crosshair)\r\n        return\r\n      } else {\r\n        crosshair = null\r\n      }\r\n    }\r\n    const distance = event.localX - this._startScrollCoordinate.x\r\n    this._chartData.timeScaleStore().scroll(distance, crosshair)\r\n  }\r\n\r\n  longTapEvent (event) {\r\n    if (!isTouch(event)) {\r\n      return\r\n    }\r\n    this._touchCoordinate = { x: event.localX, y: event.localY }\r\n    this._chartData.crosshairStore().set({ x: event.localX, y: event.paneY, paneId: event.paneId })\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport EventHandler, { isMouse } from './EventHandler'\r\nimport { InvalidateLevel } from '../data/constants'\r\nimport { ShapeMouseOperateElement } from '../component/overlay/Shape'\r\n\r\nexport default class OverlayEventHandler extends EventHandler {\r\n  constructor (chartData, yAxis) {\r\n    super(chartData)\r\n    this._yAxis = yAxis\r\n  }\r\n\r\n  /**\r\n   * 处理覆盖物鼠标hover事件\r\n   * @param overlays\r\n   * @param preHoverOperate\r\n   * @param coordinate\r\n   * @param event\r\n   * @return {*}\r\n   * @private\r\n   */\r\n  _performOverlayMouseHover (overlays, preHoverOperate, coordinate, event) {\r\n    let hoverOperate\r\n    if (overlays) {\r\n      for (const overlay of overlays) {\r\n        hoverOperate = overlay.checkEventCoordinateOn(coordinate)\r\n        if (hoverOperate) {\r\n          break\r\n        }\r\n      }\r\n      if (!hoverOperate || preHoverOperate.id !== hoverOperate.id) {\r\n        if (preHoverOperate.id && preHoverOperate.instance && isMouse(event)) {\r\n          preHoverOperate.instance.onMouseLeave({\r\n            id: preHoverOperate.id,\r\n            points: preHoverOperate.instance.points(),\r\n            event\r\n          })\r\n        }\r\n        if (hoverOperate && hoverOperate.id !== preHoverOperate.id && hoverOperate.instance && isMouse(event)) {\r\n          hoverOperate.instance.onMouseEnter({\r\n            id: hoverOperate.id,\r\n            points: hoverOperate.instance.points(),\r\n            event\r\n          })\r\n        }\r\n      }\r\n    }\r\n    return hoverOperate\r\n  }\r\n\r\n  /**\r\n   * 鼠标抬起事件\r\n   */\r\n  mouseUpEvent () {\r\n    this._chartData.shapeStore().updatePressedInstance()\r\n  }\r\n\r\n  mouseMoveEvent (event) {\r\n    if (this._waitingForMouseMove) {\r\n      return false\r\n    }\r\n    this._waitingForMouseMove = true\r\n    const coordinate = { x: event.localX, y: event.paneY }\r\n    const { paneId, instance } = this._chartData.shapeStore().progressInstance()\r\n    let shapeHoverOperate\r\n    let shapeClickOperate\r\n    let annotationHoverOperate\r\n    if (instance && instance.isDrawing()) {\r\n      if (event.paneId) {\r\n        if (instance.isStart()) {\r\n          this._chartData.shapeStore().updateProgressInstance(this._yAxis(event.paneId), event.paneId)\r\n        }\r\n        if (paneId === event.paneId) {\r\n          instance.mouseMoveForDrawing(coordinate, event)\r\n        }\r\n        shapeHoverOperate = instance.checkEventCoordinateOn(coordinate)\r\n      }\r\n      shapeClickOperate = {\r\n        id: '',\r\n        element: ShapeMouseOperateElement.NONE,\r\n        elementIndex: -1\r\n      }\r\n    } else {\r\n      const annotations = this._chartData.annotationStore().get(event.paneId)\r\n      const shapes = this._chartData.shapeStore().instances(event.paneId)\r\n      const prevShapeHoverOperate = this._chartData.shapeStore().mouseOperate().hover\r\n      const prevAnnotationHoverOperate = this._chartData.annotationStore().mouseOperate()\r\n      shapeHoverOperate = this._performOverlayMouseHover(shapes, prevShapeHoverOperate, coordinate, event)\r\n      annotationHoverOperate = this._performOverlayMouseHover(annotations, prevAnnotationHoverOperate, coordinate, event)\r\n    }\r\n    this._chartData.shapeStore().setMouseOperate({\r\n      hover: shapeHoverOperate || {\r\n        id: '',\r\n        element: ShapeMouseOperateElement.NONE,\r\n        elementIndex: -1\r\n      },\r\n      click: shapeClickOperate\r\n    })\r\n    this._chartData.annotationStore().setMouseOperate(annotationHoverOperate || { id: '' })\r\n    this._waitingForMouseMove = false\r\n  }\r\n\r\n  /**\r\n   * 鼠标按下事件\r\n   * @param event\r\n   */\r\n  mouseDownEvent (event) {\r\n    const coordinate = { x: event.localX, y: event.paneY }\r\n    const { instance, paneId } = this._chartData.shapeStore().progressInstance()\r\n    let shapeHoverOperate = {\r\n      id: '',\r\n      element: ShapeMouseOperateElement.NONE,\r\n      elementIndex: -1\r\n    }\r\n    let shapeClickOperate\r\n    if (instance && instance.isDrawing() && paneId === event.paneId) {\r\n      instance.mouseLeftButtonDownForDrawing()\r\n      shapeClickOperate = instance.checkEventCoordinateOn(coordinate)\r\n    } else {\r\n      const shapes = this._chartData.shapeStore().instances(event.paneId)\r\n      for (const shape of shapes) {\r\n        shapeClickOperate = shape.checkEventCoordinateOn(coordinate)\r\n        if (shapeClickOperate) {\r\n          this._chartData.shapeStore().updatePressedInstance(shape, event.paneId, shapeClickOperate.element)\r\n          if (shapeClickOperate.element === ShapeMouseOperateElement.POINT) {\r\n            shapeHoverOperate = {\r\n              ...shapeClickOperate\r\n            }\r\n          } else {\r\n            shape.startPressedOtherMove(coordinate)\r\n          }\r\n          shape.onClick({\r\n            id: shapeClickOperate.id,\r\n            points: shape.points(),\r\n            event\r\n          })\r\n          break\r\n        }\r\n      }\r\n      const visibleAnnotations = this._chartData.annotationStore().get(event.paneId)\r\n      if (visibleAnnotations) {\r\n        for (const an of visibleAnnotations) {\r\n          const annotationOperate = an.checkEventCoordinateOn(coordinate)\r\n          if (annotationOperate) {\r\n            an.onClick({\r\n              id: annotationOperate.id,\r\n              points: an.points(),\r\n              event\r\n            })\r\n            break\r\n          }\r\n        }\r\n      }\r\n    }\r\n    const shapeOperateValid = this._chartData.shapeStore().setMouseOperate({\r\n      hover: shapeHoverOperate,\r\n      click: shapeClickOperate || {\r\n        id: '',\r\n        element: ShapeMouseOperateElement.NONE,\r\n        elementIndex: -1\r\n      }\r\n    })\r\n    if (shapeOperateValid) {\r\n      this._chartData.invalidate(InvalidateLevel.OVERLAY)\r\n    }\r\n  }\r\n\r\n  mouseRightDownEvent (event) {\r\n    const { instance } = this._chartData.shapeStore().progressInstance()\r\n    let removeShape\r\n    if (instance) {\r\n      removeShape = instance\r\n    } else {\r\n      const shapes = this._chartData.shapeStore().instances(event.paneId)\r\n      removeShape = shapes.find(s => s.checkEventCoordinateOn({ x: event.localX, y: event.paneY }))\r\n    }\r\n    if (removeShape && !removeShape.onRightClick({ id: removeShape.id(), points: removeShape.points(), event })) {\r\n      this._chartData.shapeStore().removeInstance(removeShape.id())\r\n    }\r\n    const visibleAnnotations = this._chartData.annotationStore().get(event.paneId)\r\n    if (visibleAnnotations) {\r\n      const annotation = visibleAnnotations.find(an => an.checkEventCoordinateOn({ x: event.localX, y: event.paneY }))\r\n      if (annotation) {\r\n        annotation.onRightClick({ id: annotation.id(), points: annotation.points(), event })\r\n      }\r\n    }\r\n  }\r\n\r\n  pressedMouseMoveEvent (event) {\r\n    const { instance, paneId, element } = this._chartData.shapeStore().pressedInstance()\r\n    if (instance && paneId === event.paneId) {\r\n      const coordinate = { x: event.localX, y: event.paneY }\r\n      if (element === ShapeMouseOperateElement.POINT) {\r\n        instance.mousePressedPointMove(coordinate, event)\r\n      } else {\r\n        instance.mousePressedOtherMove(coordinate)\r\n      }\r\n      this._chartData.crosshairStore().set({ x: event.localX, y: event.paneY, paneId: event.paneId })\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport EventHandler from './EventHandler'\r\n\r\nconst KeyBoardCode = {\r\n  EQUAL: 'Equal',\r\n  MINUS: 'Minus',\r\n  ARROW_LEFT: 'ArrowLeft',\r\n  ARROW_RIGHT: 'ArrowRight'\r\n}\r\n\r\nexport default class KeyBoardEventHandler extends EventHandler {\r\n  /**\r\n   * 键盘事件\r\n   * @param event\r\n   */\r\n  keyBoardDownEvent (event) {\r\n    if (event.shiftKey) {\r\n      switch (event.code) {\r\n        case KeyBoardCode.EQUAL: {\r\n          this._chartData.timeScaleStore().zoom(0.5)\r\n          break\r\n        }\r\n        case KeyBoardCode.MINUS: {\r\n          this._chartData.timeScaleStore().zoom(-0.5)\r\n          break\r\n        }\r\n        case KeyBoardCode.ARROW_LEFT: {\r\n          this._chartData.timeScaleStore().startScroll()\r\n          this._chartData.timeScaleStore().scroll(-3 * this._chartData.timeScaleStore().dataSpace())\r\n          break\r\n        }\r\n        case KeyBoardCode.ARROW_RIGHT: {\r\n          this._chartData.timeScaleStore().startScroll()\r\n          this._chartData.timeScaleStore().scroll(3 * this._chartData.timeScaleStore().dataSpace())\r\n          break\r\n        }\r\n        default: {\r\n          break\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport EventBase from './EventBase'\r\nimport ZoomScrollEventHandler from './ZoomScrollEventHandler'\r\nimport OverlayEventHandler from './OverlayEventHandler'\r\nimport KeyBoardEventHandler from './KeyBoardEventHandler'\r\n\r\nexport default class ChartEvent {\r\n  constructor (target, chartData, yAxis) {\r\n    this._target = target\r\n    this._chartData = chartData\r\n    this._chartContentLeftRight = {}\r\n    this._chartContentTopBottom = {}\r\n    this._paneContentSize = {}\r\n    this._event = new EventBase(this._target, {\r\n      pinchStartEvent: this._pinchStartEvent.bind(this),\r\n      pinchEvent: this._pinchEvent.bind(this),\r\n      mouseUpEvent: this._mouseUpEvent.bind(this),\r\n      mouseClickEvent: this._mouseClickEvent.bind(this),\r\n      mouseDownEvent: this._mouseDownEvent.bind(this),\r\n      mouseRightDownEvent: this._mouseRightDownEvent.bind(this),\r\n      mouseLeaveEvent: this._mouseLeaveEvent.bind(this),\r\n      mouseMoveEvent: this._mouseMoveEvent.bind(this),\r\n      mouseWheelEvent: this._mouseWheelEvent.bind(this),\r\n      pressedMouseMoveEvent: this._pressedMouseMoveEvent.bind(this),\r\n      longTapEvent: this._longTapEvent.bind(this)\r\n    }, {\r\n      treatVertTouchDragAsPageScroll: false,\r\n      treatHorzTouchDragAsPageScroll: false\r\n    })\r\n    this._boundKeyBoardDownEvent = this._keyBoardDownEvent.bind(this)\r\n    this._target.addEventListener('keydown', this._boundKeyBoardDownEvent)\r\n    this._boundContextMenuEvent = (e) => { e.preventDefault() }\r\n    this._target.addEventListener('contextmenu', this._boundContextMenuEvent, false)\r\n    this._zoomScrollEventHandler = new ZoomScrollEventHandler(chartData)\r\n    this._overlayEventHandler = new OverlayEventHandler(chartData, yAxis)\r\n    this._keyBoardEventHandler = new KeyBoardEventHandler(chartData)\r\n  }\r\n\r\n  _keyBoardDownEvent (event) {\r\n    this._keyBoardEventHandler.keyBoardDownEvent(event)\r\n  }\r\n\r\n  _pinchStartEvent () {\r\n    this._zoomScrollEventHandler.pinchStartEvent()\r\n  }\r\n\r\n  _pinchEvent (middleCoordinate, scale) {\r\n    this._zoomScrollEventHandler.pinchEvent(middleCoordinate, scale)\r\n  }\r\n\r\n  _mouseUpEvent (event) {\r\n    if (this._checkEventInChartContent(event)) {\r\n      this._target.style.cursor = 'crosshair'\r\n    }\r\n    if (this._shouldPerformOverlayEvent()) {\r\n      this._overlayEventHandler.mouseUpEvent(event)\r\n    }\r\n  }\r\n\r\n  _mouseLeaveEvent (event) {\r\n    this._zoomScrollEventHandler.mouseLeaveEvent(event)\r\n  }\r\n\r\n  _mouseMoveEvent (event) {\r\n    if (this._checkEventInChartContent(event)) {\r\n      this._target.style.cursor = 'crosshair'\r\n      const compatEvent = this._compatChartEvent(event, true)\r\n      if (this._shouldPerformOverlayEvent()) {\r\n        this._overlayEventHandler.mouseMoveEvent(compatEvent)\r\n      }\r\n      if (!this._chartData.dragPaneFlag()) {\r\n        this._zoomScrollEventHandler.mouseMoveEvent(compatEvent)\r\n      }\r\n    } else {\r\n      this._target.style.cursor = 'default'\r\n      this._zoomScrollEventHandler.mouseLeaveEvent(event)\r\n    }\r\n  }\r\n\r\n  _mouseWheelEvent (event) {\r\n    if (this._checkZoomScroll() && this._checkEventInChartContent(event)) {\r\n      this._zoomScrollEventHandler.mouseWheelEvent(this._compatChartEvent(event))\r\n    }\r\n  }\r\n\r\n  _mouseClickEvent (event) {\r\n    if (this._checkZoomScroll() && this._checkEventInChartContent(event)) {\r\n      this._zoomScrollEventHandler.mouseClickEvent(this._compatChartEvent(event, true))\r\n    }\r\n  }\r\n\r\n  _mouseDownEvent (event) {\r\n    if (this._checkEventInChartContent(event)) {\r\n      this._target.style.cursor = 'pointer'\r\n      const compatEvent = this._compatChartEvent(event, true)\r\n      if (this._shouldPerformOverlayEvent()) {\r\n        this._overlayEventHandler.mouseDownEvent(compatEvent)\r\n      }\r\n      if (this._checkZoomScroll()) {\r\n        this._zoomScrollEventHandler.mouseDownEvent(compatEvent)\r\n      }\r\n    }\r\n  }\r\n\r\n  _mouseRightDownEvent (event) {\r\n    if (this._shouldPerformOverlayEvent() && this._checkEventInChartContent(event)) {\r\n      this._overlayEventHandler.mouseRightDownEvent(this._compatChartEvent(event, true))\r\n    }\r\n  }\r\n\r\n  _pressedMouseMoveEvent (event) {\r\n    if (this._checkEventInChartContent(event)) {\r\n      const compatEvent = this._compatChartEvent(event, true)\r\n      if (this._checkZoomScroll()) {\r\n        this._zoomScrollEventHandler.pressedMouseMoveEvent(compatEvent)\r\n      } else {\r\n        this._overlayEventHandler.pressedMouseMoveEvent(compatEvent)\r\n      }\r\n    }\r\n  }\r\n\r\n  _longTapEvent (event) {\r\n    if (this._checkZoomScroll() && this._checkEventInChartContent(event)) {\r\n      this._zoomScrollEventHandler.longTapEvent(this._compatChartEvent(event, true))\r\n    }\r\n  }\r\n\r\n  _checkZoomScroll () {\r\n    return !this._chartData.dragPaneFlag() && !this._chartData.shapeStore().isPressed() && !this._chartData.shapeStore().isDrawing()\r\n  }\r\n\r\n  /**\r\n   * 是否需要处理图形标记事件\r\n   * @return {boolean}\r\n   * @private\r\n   */\r\n  _shouldPerformOverlayEvent () {\r\n    return !this._chartData.shapeStore().isEmpty() || !this._chartData.annotationStore().isEmpty()\r\n  }\r\n\r\n  /**\r\n   * 事件信息兼容\r\n   * @param {*} event\r\n   * @param {*} compatY\r\n   * @returns\r\n   */\r\n  _compatChartEvent (event, compatY) {\r\n    if (compatY) {\r\n      for (const id in this._paneContentSize) {\r\n        if (Object.prototype.hasOwnProperty.call(this._paneContentSize, id)) {\r\n          const size = this._paneContentSize[id]\r\n          if (event.localY > size.contentTop && event.localY < size.contentBottom) {\r\n            event.paneY = event.localY - size.contentTop\r\n            event.paneId = id\r\n            break\r\n          }\r\n        }\r\n      }\r\n    }\r\n    event.localX -= this._chartContentLeftRight.contentLeft\r\n    return event\r\n  }\r\n\r\n  /**\r\n   * 检查事件是否在图表内容内\r\n   * @param {*} event\r\n   * @returns\r\n   */\r\n  _checkEventInChartContent (event) {\r\n    return (event.localX > this._chartContentLeftRight.contentLeft && event.localX < this._chartContentLeftRight.contentRight) &&\r\n      (event.localY > this._chartContentTopBottom.contentTop && event.localY < this._chartContentTopBottom.contentBottom)\r\n  }\r\n\r\n  setChartContentLeftRight (chartContentLeftRight) {\r\n    this._chartContentLeftRight = chartContentLeftRight\r\n  }\r\n\r\n  setChartContentTopBottom (chartContentTopBottom) {\r\n    this._chartContentTopBottom = chartContentTopBottom\r\n  }\r\n\r\n  setPaneContentSize (paneContentSize) {\r\n    this._paneContentSize = paneContentSize\r\n  }\r\n\r\n  destroy () {\r\n    this._event.destroy()\r\n    this._target.removeEventListener('keydown', this._boundKeyBoardDownEvent)\r\n    this._target.removeEventListener('contextmenu', this._boundContextMenuEvent)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport function throttle (func, wait = 20) {\r\n  let previous = 0\r\n  return function () {\r\n    const now = Date.now()\r\n    const context = this\r\n    const args = arguments\r\n    if (now - previous > wait) {\r\n      func.apply(context, args)\r\n      previous = now\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 渲染填充菱形\r\n * @param ctx\r\n * @param color\r\n * @param centerCoordinate\r\n * @param width\r\n * @param height\r\n */\r\nexport function renderFillDiamond (ctx, color, centerCoordinate, width, height) {\r\n  ctx.fillStyle = color\r\n  ctx.beginPath()\r\n  ctx.moveTo(centerCoordinate.x - width / 2, centerCoordinate.y)\r\n  ctx.lineTo(centerCoordinate.x, centerCoordinate.y - height / 2)\r\n  ctx.lineTo(centerCoordinate.x + width / 2, centerCoordinate.y)\r\n  ctx.lineTo(centerCoordinate.x, centerCoordinate.y + height / 2)\r\n  ctx.closePath()\r\n  ctx.fill()\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * 渲染填充菱形\r\n * @param ctx\r\n * @param color\r\n * @param centerCoordinate\r\n * @param width\r\n * @param height\r\n */\r\nexport function renderFillTriangle (ctx, color, centerCoordinate, width, height) {\r\n  ctx.fillStyle = color\r\n  ctx.beginPath()\r\n  ctx.moveTo(centerCoordinate.x - width / 2, centerCoordinate.y + height / 2)\r\n  ctx.lineTo(centerCoordinate.x, centerCoordinate.y - height / 2)\r\n  ctx.lineTo(centerCoordinate.x + width / 2, centerCoordinate.y + height / 2)\r\n  ctx.closePath()\r\n  ctx.fill()\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Overlay from './Overlay'\r\n\r\nimport { renderFillCircle } from '../../renderer/circle'\r\nimport { renderFillRect } from '../../renderer/rect'\r\nimport { renderFillDiamond } from '../../renderer/diamond'\r\nimport { renderFillTriangle } from '../../renderer/triangle'\r\nimport {\r\n  checkCoordinateInCircle, checkCoordinateInDiamond,\r\n  checkCoordinateInRect, checkCoordinateInTriangle\r\n} from '../../extension/shape/shapeHelper'\r\n\r\nimport { isNumber } from '../../utils/typeChecks'\r\n\r\nimport {\r\n  OverlayPosition,\r\n  AnnotationSymbolType\r\n} from '../../options/styleOptions'\r\n\r\n/**\r\n * 注解\r\n */\r\nexport default class Annotation extends Overlay {\r\n  constructor ({\r\n    id, point, chartData, xAxis, yAxis, styles\r\n  }) {\r\n    super({ id, chartData, xAxis, yAxis })\r\n    this._point = point\r\n    this._symbolCoordinate = {}\r\n    this.setStyles(styles, chartData.styleOptions().annotation)\r\n  }\r\n\r\n  /**\r\n   * 绘制标识\r\n   * @param ctx\r\n   * @param isActive\r\n   * @param styles\r\n   * @private\r\n   */\r\n  _drawSymbol (ctx, isActive, styles) {\r\n    const barSpace = this._chartData.timeScaleStore().barSpace()\r\n    const symbolOptions = styles.symbol\r\n    const styleSize = symbolOptions.size\r\n    const styleActiveSize = symbolOptions.activeSize\r\n    const size = isActive\r\n      ? (isNumber(styleActiveSize) ? styleActiveSize : barSpace)\r\n      : (isNumber(styleSize) ? styleSize : barSpace)\r\n    const color = isActive ? symbolOptions.activeColor : symbolOptions.color\r\n    switch (symbolOptions.type) {\r\n      case AnnotationSymbolType.CIRCLE: {\r\n        renderFillCircle(ctx, color, this._symbolCoordinate, size / 2)\r\n        break\r\n      }\r\n      case AnnotationSymbolType.RECT: {\r\n        renderFillRect(\r\n          ctx, color,\r\n          this._symbolCoordinate.x - size / 2,\r\n          this._symbolCoordinate.y - size / 2,\r\n          size, size\r\n        )\r\n        break\r\n      }\r\n      case AnnotationSymbolType.DIAMOND: {\r\n        renderFillDiamond(ctx, color, this._symbolCoordinate, size, size)\r\n        break\r\n      }\r\n      case AnnotationSymbolType.TRIANGLE: {\r\n        renderFillTriangle(ctx, color, this._symbolCoordinate, size, size)\r\n        break\r\n      }\r\n      case AnnotationSymbolType.CUSTOM: {\r\n        ctx.save()\r\n        this.drawCustomSymbol({\r\n          ctx,\r\n          point: this._point,\r\n          coordinate: this._symbolCoordinate,\r\n          viewport: {\r\n            width: this._xAxis.width(),\r\n            height: this._yAxis.height(),\r\n            barSpace\r\n          },\r\n          styles: symbolOptions,\r\n          isActive\r\n        })\r\n        ctx.restore()\r\n        break\r\n      }\r\n      default: {\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  draw (ctx) {\r\n    const styles = this._styles || this._chartData.styleOptions().annotation\r\n    const offset = styles.offset || [0, 0]\r\n    let y = 0\r\n    switch (styles.position) {\r\n      case OverlayPosition.POINT: {\r\n        y = this._yAxis.convertToPixel(this._point.value)\r\n        break\r\n      }\r\n      case OverlayPosition.TOP: {\r\n        y = 0\r\n        break\r\n      }\r\n      case OverlayPosition.BOTTOM: {\r\n        y = this._yAxis.height()\r\n        break\r\n      }\r\n    }\r\n    this._symbolCoordinate.y = y + offset[0]\r\n    const isActive = this._id === this._chartData.annotationStore().mouseOperate().id\r\n    this._drawSymbol(ctx, isActive, styles)\r\n    if (this.drawExtend) {\r\n      ctx.save()\r\n      this.drawExtend({\r\n        ctx,\r\n        point: this._point,\r\n        coordinate: this._symbolCoordinate,\r\n        viewport: {\r\n          width: this._xAxis.width(),\r\n          height: this._yAxis.height()\r\n        },\r\n        styles,\r\n        isActive\r\n      })\r\n      ctx.restore()\r\n    }\r\n  }\r\n\r\n  checkEventCoordinateOn (eventCoordinate) {\r\n    const barSpace = this._chartData.timeScaleStore().barSpace()\r\n    const styles = this._styles || this._chartData.styleOptions().annotation\r\n    const symbolOptions = styles.symbol\r\n    const size = isNumber(symbolOptions.size) ? symbolOptions.size : barSpace\r\n    let isOn\r\n    switch (symbolOptions.type) {\r\n      case AnnotationSymbolType.CIRCLE: {\r\n        isOn = checkCoordinateInCircle(this._symbolCoordinate, size / 2, eventCoordinate)\r\n        break\r\n      }\r\n      case AnnotationSymbolType.RECT: {\r\n        const coordinate1 = { x: this._symbolCoordinate.x - size / 2, y: this._symbolCoordinate.y - size / 2 }\r\n        const coordinate2 = { x: this._symbolCoordinate.x + size / 2, y: this._symbolCoordinate.y + size / 2 }\r\n        isOn = checkCoordinateInRect(coordinate1, coordinate2, eventCoordinate)\r\n        break\r\n      }\r\n      case AnnotationSymbolType.DIAMOND: {\r\n        isOn = checkCoordinateInDiamond(this._symbolCoordinate, size, size, eventCoordinate)\r\n        break\r\n      }\r\n      case AnnotationSymbolType.TRIANGLE: {\r\n        isOn = checkCoordinateInTriangle(\r\n          [\r\n            { x: this._symbolCoordinate.x - size / 2, y: this._symbolCoordinate.y + size / 2 },\r\n            { x: this._symbolCoordinate.x, y: this._symbolCoordinate.y - size / 2 },\r\n            { x: this._symbolCoordinate.x + size / 2, y: this._symbolCoordinate.y + size / 2 }\r\n          ],\r\n          eventCoordinate\r\n        )\r\n        break\r\n      }\r\n      case AnnotationSymbolType.CUSTOM: {\r\n        isOn = this.checkEventCoordinateOnCustomSymbol({\r\n          eventCoordinate,\r\n          coordinate: this._symbolCoordinate,\r\n          size\r\n        })\r\n        break\r\n      }\r\n      default: {\r\n        break\r\n      }\r\n    }\r\n    if (isOn) {\r\n      return {\r\n        id: this._id,\r\n        instance: this\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 生成标识坐标\r\n   * @param x\r\n   */\r\n  createSymbolCoordinate (x) {\r\n    const styles = this._styles || this._chartData.styleOptions().annotation\r\n    const offset = styles.offset || [0, 0]\r\n    this._symbolCoordinate = { x: x + offset[1] }\r\n  }\r\n\r\n  /**\r\n   * 获取点\r\n   * @return {*}\r\n   */\r\n  points () {\r\n    return this._point\r\n  }\r\n\r\n  /**\r\n   * 检查鼠标点是否在自定义标识内\r\n   * @param eventCoordinate\r\n   * @param coordinate\r\n   * @param size\r\n   */\r\n  checkEventCoordinateOnCustomSymbol ({ eventCoordinate, coordinate, size }) {}\r\n\r\n  /**\r\n   * 绘制自定义标识\r\n   * @param ctx\r\n   * @param point\r\n   * @param coordinate\r\n   * @param viewport\r\n   * @param styles\r\n   * @param isActive\r\n   */\r\n  drawCustomSymbol ({ ctx, point, coordinate, viewport, styles, isActive }) {}\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Overlay from './Overlay'\r\nimport { LineStyle, OverlayPosition, YAxisPosition } from '../../options/styleOptions'\r\nimport { renderHorizontalLine } from '../../renderer/line'\r\nimport { isValid, isObject } from '../../utils/typeChecks'\r\nimport { calcTextWidth, createFont } from '../../utils/canvas'\r\nimport { renderFillRoundRect } from '../../renderer/rect'\r\nimport { renderText } from '../../renderer/text'\r\n\r\nexport default class Tag extends Overlay {\r\n  constructor ({\r\n    id, point, text, mark, chartData, xAxis, yAxis, styles\r\n  }) {\r\n    super({ id, chartData, xAxis, yAxis })\r\n    this._point = point || {}\r\n    this._text = text\r\n    this._mark = mark\r\n    this.setStyles(styles, chartData.styleOptions().tag)\r\n  }\r\n\r\n  /**\r\n   * 更新\r\n   * @param point\r\n   * @param text\r\n   * @param mark\r\n   * @param styles\r\n   * @return {boolean}\r\n   */\r\n  update ({ point, text, mark, styles }) {\r\n    let success = false\r\n    if (isObject(point)) {\r\n      this._point = point\r\n      success = true\r\n    }\r\n    if (isValid(text)) {\r\n      this._text = text\r\n      success = true\r\n    }\r\n    if (isValid(mark)) {\r\n      this._mark = mark\r\n      success = true\r\n    }\r\n    if (this.setStyles(styles, this._chartData.styleOptions().tag)) {\r\n      success = true\r\n    }\r\n    return success\r\n  }\r\n\r\n  /**\r\n   * 绘制标记和线\r\n   * @param ctx\r\n   */\r\n  drawMarkLine (ctx) {\r\n    const options = this._chartData.styleOptions()\r\n    const yAxisOptions = options.yAxis\r\n    const tagOptions = this._styles || options.tag\r\n    const y = this._getY(tagOptions)\r\n    ctx.save()\r\n    this._drawLine(ctx, y, tagOptions.line)\r\n    this._drawMark(ctx, y, tagOptions, yAxisOptions)\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制值\r\n   */\r\n  drawText (ctx) {\r\n    if (!isValid(this._text)) {\r\n      return\r\n    }\r\n    const options = this._chartData.styleOptions()\r\n    const tagOptions = this._styles || options.tag\r\n    const tagTextOptions = tagOptions.text\r\n    ctx.save()\r\n    ctx.font = createFont(tagTextOptions.size, tagTextOptions.weight, tagTextOptions.family)\r\n    const rectWidth = this._getTextRectWidth(ctx, tagTextOptions)\r\n    const rectHeight = tagTextOptions.paddingTop + tagTextOptions.paddingBottom + tagTextOptions.size\r\n    let x\r\n    if (this._yAxis.isFromYAxisZero()) {\r\n      x = 0\r\n    } else {\r\n      x = this._yAxis.width() - rectWidth\r\n    }\r\n    const y = this._getY(tagOptions)\r\n    renderFillRoundRect(\r\n      ctx,\r\n      tagTextOptions.backgroundColor,\r\n      x,\r\n      y - rectHeight / 2,\r\n      rectWidth,\r\n      rectHeight,\r\n      tagTextOptions.borderRadius\r\n    )\r\n    renderText(ctx, tagTextOptions.color, x + tagTextOptions.paddingLeft, y, this._text)\r\n    ctx.restore()\r\n  }\r\n\r\n  /**\r\n   * 绘制线\r\n   * @param ctx\r\n   * @param y\r\n   * @param tagLineOptions\r\n   * @private\r\n   */\r\n  _drawLine (ctx, y, tagLineOptions) {\r\n    if (!tagLineOptions.show) {\r\n      return\r\n    }\r\n    ctx.strokeStyle = tagLineOptions.color\r\n    ctx.lineWidth = tagLineOptions.size\r\n    if (tagLineOptions.style === LineStyle.DASH) {\r\n      ctx.setLineDash(tagLineOptions.dashValue)\r\n    }\r\n    renderHorizontalLine(ctx, y, 0, this._xAxis.width())\r\n  }\r\n\r\n  /**\r\n   * 绘制标记\r\n   * @param ctx\r\n   * @param y\r\n   * @param tagOptions\r\n   * @param yAxisOptions\r\n   * @private\r\n   */\r\n  _drawMark (ctx, y, tagOptions, yAxisOptions) {\r\n    if (!isValid(this._mark)) {\r\n      return\r\n    }\r\n    const tagMarkOptions = tagOptions.mark\r\n    ctx.font = createFont(tagMarkOptions.size, tagMarkOptions.weight, tagMarkOptions.family)\r\n    const rectWidth = tagMarkOptions.paddingLeft + tagMarkOptions.paddingRight + calcTextWidth(ctx, this._mark)\r\n    const rectHeight = tagMarkOptions.paddingTop + tagMarkOptions.paddingBottom + tagMarkOptions.size\r\n    let x\r\n    if (yAxisOptions.inside) {\r\n      let valueRectWidth = 0\r\n      if (isValid(this._text)) {\r\n        valueRectWidth = this._getTextRectWidth(ctx, tagOptions.text)\r\n      }\r\n      if (yAxisOptions.position === YAxisPosition.LEFT) {\r\n        x = valueRectWidth\r\n      } else {\r\n        x = this._xAxis.width() - valueRectWidth - rectWidth\r\n      }\r\n    } else {\r\n      if (yAxisOptions.position === YAxisPosition.LEFT) {\r\n        x = 0\r\n      } else {\r\n        x = this._xAxis.width() - rectWidth\r\n      }\r\n    }\r\n    renderFillRoundRect(\r\n      ctx,\r\n      tagMarkOptions.backgroundColor,\r\n      x,\r\n      y - rectHeight / 2,\r\n      rectWidth,\r\n      rectHeight,\r\n      tagMarkOptions.borderRadius\r\n    )\r\n    ctx.textBaseline = 'middle'\r\n    ctx.font = createFont(tagMarkOptions.size, tagMarkOptions.weight, tagMarkOptions.family)\r\n    renderText(ctx, tagMarkOptions.color, x + tagMarkOptions.paddingLeft, y, this._mark)\r\n  }\r\n\r\n  /**\r\n   * 获取坐标y值\r\n   * @param tagOptions\r\n   * @return {*}\r\n   * @private\r\n   */\r\n  _getY (tagOptions) {\r\n    const offset = tagOptions.offset\r\n    switch (tagOptions.position) {\r\n      case OverlayPosition.TOP: {\r\n        return offset\r\n      }\r\n      case OverlayPosition.BOTTOM: {\r\n        return this._yAxis.height() + offset\r\n      }\r\n      default: {\r\n        return this._yAxis.convertToNicePixel(this._point.value) + offset\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取值的矩形宽度\r\n   * @param ctx\r\n   * @param textOptions\r\n   * @return {*}\r\n   * @private\r\n   */\r\n  _getTextRectWidth (ctx, textOptions) {\r\n    ctx.font = createFont(textOptions.size, textOptions.weight, textOptions.family)\r\n    return textOptions.paddingLeft + textOptions.paddingRight + calcTextWidth(ctx, this._text)\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport ChartData from '../data/ChartData'\r\n\r\nimport CandlePane from './CandlePane'\r\nimport XAxisPane from './XAxisPane'\r\n\r\nimport { YAxisPosition } from '../options/styleOptions'\r\nimport { isArray, isBoolean, isFunction, isValid, isNumber } from '../utils/typeChecks'\r\nimport TechnicalIndicatorPane from './TechnicalIndicatorPane'\r\nimport SeparatorPane from './SeparatorPane'\r\n\r\nimport ChartEvent from '../event/ChartEvent'\r\nimport { getPixelRatio } from '../utils/canvas'\r\nimport { throttle } from '../utils/performance'\r\nimport { createElement } from '../utils/element'\r\nimport Annotation from '../component/overlay/Annotation'\r\nimport Tag from '../component/overlay/Tag'\r\nimport { perfectOverlayFunc } from '../component/overlay/Overlay'\r\n\r\nimport {\r\n  CANDLE_PANE_ID,\r\n  DEFAULT_TECHNICAL_INDICATOR_PANE_HEIGHT,\r\n  TECHNICAL_INDICATOR_PANE_ID_PREFIX,\r\n  SHAPE_ID_PREFIX,\r\n  ActionType, InvalidateLevel\r\n} from '../data/constants'\r\n\r\nexport default class ChartPane {\r\n  constructor (container, styleOptions) {\r\n    this._initChartContainer(container)\r\n    this._shapeBaseId = 0\r\n    this._paneBaseId = 0\r\n    this._separatorDragStartTopPaneHeight = 0\r\n    this._separatorDragStartBottomPaneHeight = 0\r\n    this._chartData = new ChartData(styleOptions, {\r\n      invalidate: this._invalidatePane.bind(this),\r\n      crosshair: this._crosshairObserver.bind(this)\r\n    })\r\n    this._xAxisPane = new XAxisPane({ container: this._chartContainer, chartData: this._chartData })\r\n    this._panes = new Map([[CANDLE_PANE_ID, new CandlePane({\r\n      container: this._chartContainer,\r\n      chartData: this._chartData,\r\n      xAxis: this._xAxisPane.xAxis(),\r\n      id: CANDLE_PANE_ID\r\n    })]])\r\n    this._separators = new Map()\r\n    this._chartWidth = {}\r\n    this._chartHeight = {}\r\n    this._chartEvent = new ChartEvent(\r\n      this._chartContainer,\r\n      this._chartData,\r\n      (paneId) => this._panes.get(paneId).yAxis()\r\n    )\r\n    this.adjustPaneViewport(true, true, true)\r\n  }\r\n\r\n  /**\r\n   * 初始化图表容器\r\n   * @param container\r\n   * @private\r\n   */\r\n  _initChartContainer (container) {\r\n    this._container = container\r\n    this._chartContainer = createElement('div', {\r\n      userSelect: 'none',\r\n      webkitUserSelect: 'none',\r\n      msUserSelect: 'none',\r\n      MozUserSelect: 'none',\r\n      webkitTapHighlightColor: 'transparent',\r\n      position: 'relative',\r\n      outline: 'none',\r\n      borderStyle: 'none',\r\n      width: '100%',\r\n      cursor: 'crosshair'\r\n    })\r\n    this._chartContainer.tabIndex = 1\r\n    container.appendChild(this._chartContainer)\r\n  }\r\n\r\n  /**\r\n   * 十字光标观察者\r\n   * @private\r\n   */\r\n  _crosshairObserver ({ dataIndex, kLineData, x, y }) {\r\n    if (this.chartData().actionStore().has(ActionType.CROSSHAIR)) {\r\n      const techDatas = {}\r\n      this._panes.forEach((_, id) => {\r\n        const data = {}\r\n        const techs = this.chartData().technicalIndicatorStore().instances(id)\r\n        techs.forEach(tech => {\r\n          const result = tech.result\r\n          data[tech.name] = result[dataIndex]\r\n        })\r\n        techDatas[id] = data\r\n      })\r\n      this._chartData.actionStore().execute(ActionType.CROSSHAIR, {\r\n        coordinate: { x, y },\r\n        dataIndex,\r\n        kLineData,\r\n        technicalIndicatorData: techDatas\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分割线拖拽开始\r\n   * @param topPaneId\r\n   * @param bottomPaneId\r\n   * @private\r\n   */\r\n  _separatorStartDrag (topPaneId, bottomPaneId) {\r\n    this._separatorDragStartTopPaneHeight = this._panes.get(topPaneId).height()\r\n    this._separatorDragStartBottomPaneHeight = this._panes.get(bottomPaneId).height()\r\n  }\r\n\r\n  /**\r\n   * 分割线拖拽\r\n   * @param dragDistance\r\n   * @param topPaneId\r\n   * @param bottomPaneId\r\n   * @private\r\n   */\r\n  _separatorDrag (dragDistance, topPaneId, bottomPaneId) {\r\n    let topPaneHeight = this._separatorDragStartTopPaneHeight + dragDistance\r\n    let bottomPaneHeight = this._separatorDragStartBottomPaneHeight - dragDistance\r\n    if (topPaneHeight > this._separatorDragStartTopPaneHeight + this._separatorDragStartBottomPaneHeight) {\r\n      topPaneHeight = this._separatorDragStartTopPaneHeight + this._separatorDragStartBottomPaneHeight\r\n      bottomPaneHeight = 0\r\n    }\r\n    if (topPaneHeight < 0) {\r\n      topPaneHeight = 0\r\n      bottomPaneHeight = this._separatorDragStartTopPaneHeight + this._separatorDragStartBottomPaneHeight\r\n    }\r\n    this._panes.get(topPaneId).setHeight(topPaneHeight)\r\n    this._panes.get(bottomPaneId).setHeight(bottomPaneHeight)\r\n    this._chartData.actionStore().execute(ActionType.PANE_DRAG, { topPaneId, bottomPaneId, topPaneHeight, bottomPaneHeight })\r\n    this.adjustPaneViewport(true, true, true, true, true)\r\n  }\r\n\r\n  /**\r\n   * 更新所有pane\r\n   * @private\r\n   */\r\n  _invalidatePane (invalidateLevel = InvalidateLevel.FULL) {\r\n    if (invalidateLevel === InvalidateLevel.OVERLAY) {\r\n      this._xAxisPane.invalidate(invalidateLevel)\r\n      this._panes.forEach((pane) => {\r\n        pane.invalidate(invalidateLevel)\r\n      })\r\n    } else {\r\n      let shouldMeasureWidth = false\r\n      this._panes.forEach((pane) => {\r\n        const should = pane.yAxis().computeAxis()\r\n        if (should) {\r\n          shouldMeasureWidth = should\r\n        }\r\n      })\r\n      this.adjustPaneViewport(false, shouldMeasureWidth, true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 测量pane高度\r\n   * @private\r\n   */\r\n  _measurePaneHeight () {\r\n    const styleOptions = this._chartData.styleOptions()\r\n    const paneHeight = this._container.offsetHeight\r\n    const separatorSize = styleOptions.separator.size\r\n    const separatorTotalHeight = separatorSize * this._separators.size\r\n    const xAxisHeight = this._xAxisPane.xAxis().getSelfHeight()\r\n    const paneExcludeXAxisSeparatorHeight = paneHeight - xAxisHeight - separatorTotalHeight\r\n    let techPaneTotalHeight = 0\r\n    this._panes.forEach(pane => {\r\n      if (pane.id() !== CANDLE_PANE_ID) {\r\n        const paneHeight = pane.height()\r\n        if (techPaneTotalHeight + paneHeight > paneExcludeXAxisSeparatorHeight) {\r\n          pane.setHeight(paneExcludeXAxisSeparatorHeight - techPaneTotalHeight)\r\n          techPaneTotalHeight = paneExcludeXAxisSeparatorHeight\r\n        } else {\r\n          techPaneTotalHeight += paneHeight\r\n        }\r\n      }\r\n    })\r\n\r\n    const candlePaneHeight = paneExcludeXAxisSeparatorHeight - techPaneTotalHeight\r\n\r\n    const paneContentSize = {}\r\n    paneContentSize[CANDLE_PANE_ID] = { contentTop: 0, contentBottom: candlePaneHeight }\r\n    let contentTop = candlePaneHeight\r\n    let contentBottom = candlePaneHeight\r\n    this._panes.get(CANDLE_PANE_ID).setHeight(candlePaneHeight)\r\n    this._chartHeight[CANDLE_PANE_ID] = candlePaneHeight\r\n    this._panes.forEach(pane => {\r\n      if (pane.id() !== CANDLE_PANE_ID) {\r\n        const paneHeight = pane.height()\r\n        contentBottom += (paneHeight + separatorSize)\r\n        paneContentSize[pane.id()] = { contentTop, contentBottom }\r\n        this._chartHeight[pane.id()] = paneHeight\r\n        contentTop = contentBottom\r\n      }\r\n    })\r\n    this._xAxisPane.setHeight(xAxisHeight)\r\n    this._chartHeight.xAxis = xAxisHeight\r\n    this._chartHeight.total = paneHeight\r\n    this._chartEvent.setPaneContentSize(paneContentSize)\r\n    this._chartEvent.setChartContentTopBottom({ contentTop: 0, contentBottom })\r\n  }\r\n\r\n  /**\r\n   * 测量pan宽度\r\n   * @private\r\n   */\r\n  _measurePaneWidth () {\r\n    const styleOptions = this._chartData.styleOptions()\r\n    const yAxisOptions = styleOptions.yAxis\r\n    const isYAxisLeft = yAxisOptions.position === YAxisPosition.LEFT\r\n    const isOutside = !yAxisOptions.inside\r\n    const paneWidth = this._container.offsetWidth\r\n    let mainWidth\r\n    let yAxisWidth = Number.MIN_SAFE_INTEGER\r\n    let yAxisOffsetLeft\r\n    let mainOffsetLeft\r\n    if (isOutside) {\r\n      this._panes.forEach(pane => {\r\n        yAxisWidth = Math.max(yAxisWidth, pane.yAxis().getSelfWidth())\r\n      })\r\n      mainWidth = paneWidth - yAxisWidth\r\n      if (isYAxisLeft) {\r\n        yAxisOffsetLeft = 0\r\n        mainOffsetLeft = yAxisWidth\r\n      } else {\r\n        mainOffsetLeft = 0\r\n        yAxisOffsetLeft = paneWidth - yAxisWidth\r\n      }\r\n    } else {\r\n      mainWidth = paneWidth\r\n      yAxisWidth = paneWidth\r\n      yAxisOffsetLeft = 0\r\n      mainOffsetLeft = 0\r\n    }\r\n\r\n    this._chartData.timeScaleStore().setTotalDataSpace(mainWidth)\r\n\r\n    this._panes.forEach((pane, paneId) => {\r\n      pane.setWidth(mainWidth, yAxisWidth)\r\n      pane.setOffsetLeft(mainOffsetLeft, yAxisOffsetLeft)\r\n      const separator = this._separators.get(paneId)\r\n      separator && separator.setSize(mainOffsetLeft, mainWidth)\r\n    })\r\n    this._chartWidth = { content: mainWidth, yAxis: yAxisWidth, total: paneWidth }\r\n    this._xAxisPane.setWidth(mainWidth, yAxisWidth)\r\n    this._xAxisPane.setOffsetLeft(mainOffsetLeft, yAxisOffsetLeft)\r\n    this._chartEvent.setChartContentLeftRight({ contentLeft: mainOffsetLeft, contentRight: mainOffsetLeft + mainWidth })\r\n  }\r\n\r\n  /**\r\n   * 调整窗口尺寸\r\n   * @param shouldMeasureHeight\r\n   * @param shouldMeasureWidth\r\n   * @param shouldLayout\r\n   * @param shouldComputeAxis\r\n   * @param shouldForceComputeAxis\r\n   */\r\n  adjustPaneViewport (\r\n    shouldMeasureHeight, shouldMeasureWidth, shouldLayout, shouldComputeAxis, shouldForceComputeAxis\r\n  ) {\r\n    if (shouldMeasureHeight) {\r\n      this._measurePaneHeight()\r\n    }\r\n    let isAdjust = false\r\n    if (shouldComputeAxis) {\r\n      this._panes.forEach(pane => {\r\n        const adjust = pane.yAxis().computeAxis(shouldForceComputeAxis)\r\n        if (!isAdjust) {\r\n          isAdjust = adjust\r\n        }\r\n      })\r\n    }\r\n    if ((!shouldComputeAxis && shouldMeasureWidth) || (shouldComputeAxis && isAdjust)) {\r\n      this._measurePaneWidth()\r\n    }\r\n    if (shouldLayout) {\r\n      this._xAxisPane.xAxis().computeAxis(true)\r\n      this._xAxisPane.layout()\r\n      this._panes.forEach(pane => {\r\n        pane.layout()\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 窗口是否存在\r\n   * @param paneId\r\n   * @return {boolean}\r\n   */\r\n  hasPane (paneId) {\r\n    return this._panes.has(paneId)\r\n  }\r\n\r\n  /**\r\n   * 获取图表上的数据\r\n   * @returns {ChartData}\r\n   */\r\n  chartData () {\r\n    return this._chartData\r\n  }\r\n\r\n  /**\r\n   * 移除指标\r\n   * @param paneId\r\n   * @param name\r\n   */\r\n  removeTechnicalIndicator (paneId, name) {\r\n    const removed = this._chartData.technicalIndicatorStore().removeInstance(paneId, name)\r\n    if (removed) {\r\n      let shouldMeasureHeight = false\r\n      if (paneId !== CANDLE_PANE_ID) {\r\n        if (!this._chartData.technicalIndicatorStore().hasInstance(paneId)) {\r\n          shouldMeasureHeight = true\r\n          this._panes.get(paneId).destroy()\r\n          const deleteSeparatorTopPaneId = this._separators.get(paneId).topPaneId()\r\n          this._separators.get(paneId).destroy()\r\n          this._panes.delete(paneId)\r\n          this._separators.delete(paneId)\r\n          this._separators.forEach(separator => {\r\n            const topPaneId = separator.topPaneId()\r\n            if (!this._separators.has(topPaneId)) {\r\n              separator.updatePaneId(deleteSeparatorTopPaneId)\r\n            }\r\n          })\r\n        }\r\n      }\r\n      this.adjustPaneViewport(shouldMeasureHeight, true, true, true, true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置指标类型\r\n   * @param tech 技术指标实例\r\n   * @param isStack 是否叠加\r\n   * @param options 配置\r\n   */\r\n  createTechnicalIndicator (tech, isStack, options = {}) {\r\n    if (this._panes.has(options.id)) {\r\n      let shouldAdjust = false\r\n      if (this._chartData.technicalIndicatorStore().addInstance(options.id, tech, isStack)) {\r\n        shouldAdjust = this._panes.get(options.id).yAxis().computeAxis()\r\n      }\r\n      this.setPaneOptions(options, shouldAdjust)\r\n      return options.id\r\n    }\r\n    const id = options.id || `${TECHNICAL_INDICATOR_PANE_ID_PREFIX}${++this._paneBaseId}`\r\n    const dragEnabled = isBoolean(options.dragEnabled) ? options.dragEnabled : true\r\n    this._separators.set(id, new SeparatorPane(\r\n      this._chartContainer,\r\n      this._chartData,\r\n      Array.from(this._panes.keys()).pop(),\r\n      id,\r\n      dragEnabled,\r\n      {\r\n        startDrag: this._separatorStartDrag.bind(this),\r\n        drag: throttle(this._separatorDrag.bind(this), 50)\r\n      }\r\n    ))\r\n    const pane = new TechnicalIndicatorPane({\r\n      container: this._chartContainer,\r\n      chartData: this._chartData,\r\n      xAxis: this._xAxisPane.xAxis(),\r\n      id,\r\n      height: options.height || DEFAULT_TECHNICAL_INDICATOR_PANE_HEIGHT\r\n    })\r\n    this._panes.set(id, pane)\r\n    this._chartData.technicalIndicatorStore().addInstance(id, tech, isStack)\r\n    this.adjustPaneViewport(true, true, true, true, true)\r\n    return id\r\n  }\r\n\r\n  /**\r\n   * 创建图形\r\n   * @param ShapeTemplateClass\r\n   * @param shapeOptions\r\n   * @param paneId\r\n   */\r\n  createShape (ShapeTemplateClass, shapeOptions, paneId) {\r\n    const {\r\n      id, points, styles, lock, data,\r\n      onDrawStart, onDrawing,\r\n      onDrawEnd, onClick,\r\n      onRightClick, onPressedMove,\r\n      onMouseEnter, onMouseLeave,\r\n      onRemove\r\n    } = shapeOptions\r\n    const shapeId = id || `${SHAPE_ID_PREFIX}${++this._shapeBaseId}`\r\n    if (!this._chartData.shapeStore().hasInstance(shapeId)) {\r\n      let yAxis = null\r\n      if (this.hasPane(paneId)) {\r\n        yAxis = this._panes.get(paneId).yAxis()\r\n      } else {\r\n        if (points && points.length > 0) {\r\n          paneId = CANDLE_PANE_ID\r\n          yAxis = this._panes.get(CANDLE_PANE_ID).yAxis()\r\n        }\r\n      }\r\n      const shapeInstance = new ShapeTemplateClass({\r\n        id: shapeId,\r\n        chartData: this._chartData,\r\n        xAxis: this._xAxisPane.xAxis(),\r\n        yAxis,\r\n        points,\r\n        styles,\r\n        lock,\r\n        data\r\n      })\r\n      if (isFunction(onDrawStart)) {\r\n        onDrawStart({ id: shapeId })\r\n      }\r\n      perfectOverlayFunc(shapeInstance, [\r\n        { key: 'onDrawing', fn: onDrawing },\r\n        { key: 'onDrawEnd', fn: onDrawEnd },\r\n        { key: 'onClick', fn: onClick },\r\n        { key: 'onRightClick', fn: onRightClick },\r\n        { key: 'onPressedMove', fn: onPressedMove },\r\n        { key: 'onMouseEnter', fn: onMouseEnter },\r\n        { key: 'onMouseLeave', fn: onMouseLeave },\r\n        { key: 'onRemove', fn: onRemove }\r\n      ])\r\n      this._chartData.shapeStore().addInstance(shapeInstance, paneId)\r\n      return shapeId\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 创建注解\r\n   * @param annotations\r\n   * @param paneId\r\n   */\r\n  createAnnotation (annotations, paneId) {\r\n    const instances = []\r\n    annotations.forEach(({\r\n      point,\r\n      styles,\r\n      checkEventCoordinateOnCustomSymbol,\r\n      drawCustomSymbol,\r\n      drawExtend,\r\n      onClick,\r\n      onRightClick,\r\n      onMouseEnter,\r\n      onMouseLeave\r\n    }) => {\r\n      if (point && point.timestamp) {\r\n        const annotationInstance = new Annotation({\r\n          id: point.timestamp,\r\n          chartData: this._chartData,\r\n          point,\r\n          xAxis: this._xAxisPane.xAxis(),\r\n          yAxis: this._panes.get(paneId).yAxis(),\r\n          styles\r\n        })\r\n\r\n        perfectOverlayFunc(annotationInstance, [\r\n          { key: 'drawExtend', fn: drawExtend },\r\n          { key: 'drawCustomSymbol', fn: drawCustomSymbol },\r\n          { key: 'checkEventCoordinateOnCustomSymbol', fn: checkEventCoordinateOnCustomSymbol },\r\n          { key: 'onClick', fn: onClick },\r\n          { key: 'onRightClick', fn: onRightClick },\r\n          { key: 'onMouseEnter', fn: onMouseEnter },\r\n          { key: 'onMouseLeave', fn: onMouseLeave }\r\n        ])\r\n        instances.push(annotationInstance)\r\n      }\r\n    })\r\n    if (instances.length > 0) {\r\n      this._chartData.annotationStore().add(instances, paneId)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建标签\r\n   * @param tags\r\n   * @param paneId\r\n   */\r\n  createTag (tags, paneId) {\r\n    const instances = []\r\n    let shouldUpdate = false\r\n    let shouldAdd = false\r\n    tags.forEach(({ id, point, text, mark, styles }) => {\r\n      if (isValid(id)) {\r\n        if (this._chartData.tagStore().has(id, paneId)) {\r\n          const updateSuccess = this._chartData.tagStore().update(id, paneId, { point, text, mark, styles })\r\n          if (!shouldUpdate) {\r\n            shouldUpdate = updateSuccess\r\n          }\r\n        } else {\r\n          shouldAdd = true\r\n          instances.push(new Tag({\r\n            id,\r\n            point,\r\n            text,\r\n            mark,\r\n            styles,\r\n            chartData: this._chartData,\r\n            xAxis: this._xAxisPane.xAxis(),\r\n            yAxis: this._panes.get(paneId).yAxis()\r\n          }))\r\n        }\r\n      }\r\n    })\r\n    if (shouldAdd) {\r\n      this._chartData.tagStore().add(instances, paneId)\r\n    } else {\r\n      if (shouldUpdate) {\r\n        this._invalidatePane(InvalidateLevel.OVERLAY)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置窗体参数\r\n   * @param options\r\n   * @param forceShouldAdjust\r\n   */\r\n  setPaneOptions (options, forceShouldAdjust) {\r\n    let shouldAdjust = forceShouldAdjust\r\n    let shouldMeasureHeight = false\r\n    if (options.id !== CANDLE_PANE_ID) {\r\n      const pane = this._panes.get(options.id)\r\n      if (pane) {\r\n        if (isNumber(options.height) && options.height > 0 && pane.height() !== options.height) {\r\n          shouldAdjust = true\r\n          pane.setHeight(options.height)\r\n          shouldMeasureHeight = true\r\n        }\r\n        if (isBoolean(options.dragEnabled)) {\r\n          this._separators.get(options.id).setDragEnabled(options.dragEnabled)\r\n        }\r\n      }\r\n    }\r\n    if (shouldAdjust) {\r\n      this.adjustPaneViewport(shouldMeasureHeight, true, true, true, true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置时区\r\n   * @param timezone\r\n   */\r\n  setTimezone (timezone) {\r\n    this._chartData.timeScaleStore().setTimezone(timezone)\r\n    this._xAxisPane.xAxis().computeAxis(true)\r\n    this._xAxisPane.invalidate(InvalidateLevel.FULL)\r\n  }\r\n\r\n  /**\r\n   * 将值装换成像素\r\n   * @param timestamp\r\n   * @param point\r\n   * @param paneId\r\n   * @param absoluteYAxis\r\n   */\r\n  convertToPixel (point, { paneId = CANDLE_PANE_ID, absoluteYAxis }) {\r\n    const points = [].concat(point)\r\n    let coordinates = []\r\n    const separatorSize = this._chartData.styleOptions().separator.size\r\n    let absoluteTop = 0\r\n    const panes = this._panes.values()\r\n    for (const pane of panes) {\r\n      if (pane.id() === paneId) {\r\n        coordinates = points.map(({ timestamp, dataIndex, value }) => {\r\n          const coordinate = {}\r\n          let index = dataIndex\r\n          if (isValid(timestamp)) {\r\n            index = this._chartData.timeScaleStore().timestampToDataIndex(timestamp)\r\n          }\r\n          if (isValid(index)) {\r\n            coordinate.x = this._xAxisPane.xAxis().convertToPixel(index)\r\n          }\r\n          if (isValid(value)) {\r\n            const y = pane.yAxis().convertToPixel(value)\r\n            coordinate.y = absoluteYAxis ? absoluteTop + y : y\r\n          }\r\n          return coordinate\r\n        })\r\n        break\r\n      }\r\n      absoluteTop += (pane.height() + separatorSize)\r\n    }\r\n    return isArray(point) ? coordinates : (coordinates[0] || {})\r\n  }\r\n\r\n  /**\r\n   * 将像素转换成值\r\n   * @param coordinate\r\n   * @param paneId\r\n   * @param dataIndexXAxis\r\n   * @param absoluteYAxis\r\n   * @return {{}[]|*[]}\r\n   */\r\n  convertFromPixel (coordinate, { paneId = CANDLE_PANE_ID, absoluteYAxis }) {\r\n    const coordinates = [].concat(coordinate)\r\n    let points = []\r\n    const separatorSize = this._chartData.styleOptions().separator.size\r\n    let absoluteTop = 0\r\n    const panes = this._panes.values()\r\n    for (const pane of panes) {\r\n      if (pane.id() === paneId) {\r\n        points = coordinates.map(({ x, y }) => {\r\n          const point = {}\r\n          if (isValid(x)) {\r\n            point.dataIndex = this._xAxisPane.xAxis().convertFromPixel(x)\r\n            point.timestamp = this._chartData.timeScaleStore().dataIndexToTimestamp(point.dataIndex)\r\n          }\r\n          if (isValid(y)) {\r\n            const ry = absoluteYAxis ? y - absoluteTop : y\r\n            point.value = pane.yAxis().convertFromPixel(ry)\r\n          }\r\n          return point\r\n        })\r\n        break\r\n      }\r\n      absoluteTop += pane.height() + separatorSize\r\n    }\r\n    return isArray(coordinate) ? points : (points[0] || {})\r\n  }\r\n\r\n  /**\r\n   * 图表宽度\r\n   * @return {*|{}}\r\n   */\r\n  chartWidth () {\r\n    return this._chartWidth\r\n  }\r\n\r\n  /**\r\n   * 图表高度\r\n   * @return {*|{}}\r\n   */\r\n  chartHeight () {\r\n    return this._chartHeight\r\n  }\r\n\r\n  /**\r\n   * 获取图表转换为图片后url\r\n   * @param includeOverlay,\r\n   * @param type\r\n   * @param backgroundColor\r\n   */\r\n  getConvertPictureUrl (includeOverlay, type, backgroundColor) {\r\n    const width = this._chartContainer.offsetWidth\r\n    const height = this._chartContainer.offsetHeight\r\n    const canvas = createElement('canvas', {\r\n      width: `${width}px`,\r\n      height: `${height}px`\r\n    })\r\n    const ctx = canvas.getContext('2d')\r\n    const pixelRatio = getPixelRatio(canvas)\r\n    canvas.width = width * pixelRatio\r\n    canvas.height = height * pixelRatio\r\n    ctx.scale(pixelRatio, pixelRatio)\r\n\r\n    ctx.fillStyle = backgroundColor\r\n    ctx.fillRect(0, 0, width, height)\r\n    let offsetTop = 0\r\n    this._panes.forEach((pane, paneId) => {\r\n      if (paneId !== CANDLE_PANE_ID) {\r\n        const separator = this._separators.get(paneId)\r\n        ctx.drawImage(\r\n          separator.getImage(),\r\n          0, offsetTop, width, separator.height()\r\n        )\r\n        offsetTop += separator.height()\r\n      }\r\n      ctx.drawImage(\r\n        pane.getImage(includeOverlay),\r\n        0, offsetTop, width, pane.height()\r\n      )\r\n      offsetTop += pane.height()\r\n    })\r\n    ctx.drawImage(\r\n      this._xAxisPane.getImage(includeOverlay),\r\n      0, offsetTop, width, this._xAxisPane.height()\r\n    )\r\n    return canvas.toDataURL(`image/${type}`)\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy () {\r\n    this._panes.forEach(pane => {\r\n      pane.destroy()\r\n    })\r\n    this._separators.forEach(pane => {\r\n      pane.destroy()\r\n    })\r\n    this._panes.clear()\r\n    this._separators.clear()\r\n    this._xAxisPane.destroy()\r\n    this._container.removeChild(this._chartContainer)\r\n    this._chartEvent.destroy()\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport ChartPane from './pane/ChartPane'\r\nimport { clone, isNumber, isObject, isArray, isFunction, isValid } from './utils/typeChecks'\r\nimport { logWarn } from './utils/logger'\r\nimport { requestAnimationFrame } from './utils/compatible'\r\nimport { formatValue } from './utils/format'\r\nimport { CANDLE_PANE_ID } from './data/constants'\r\n\r\nexport default class Chart {\r\n  constructor (container, styleOptions) {\r\n    this._chartPane = new ChartPane(container, styleOptions)\r\n  }\r\n\r\n  /**\r\n   * 获取宽尺寸\r\n   * @return {*|{}}\r\n   */\r\n  getWidth () {\r\n    return this._chartPane.chartWidth()\r\n  }\r\n\r\n  /**\r\n   * 获取高度尺寸\r\n   * @return {*|{}}\r\n   */\r\n  getHeight () {\r\n    return this._chartPane.chartHeight()\r\n  }\r\n\r\n  /**\r\n   * 设置样式配置\r\n   * @param options 配置\r\n   */\r\n  setStyleOptions (options) {\r\n    if (!isObject(options)) {\r\n      logWarn('setStyleOptions', 'options')\r\n      return\r\n    }\r\n    this._chartPane.chartData().applyStyleOptions(options)\r\n    this._chartPane.adjustPaneViewport(true, true, true, true, true)\r\n  }\r\n\r\n  /**\r\n   * 获取样式配置\r\n   * @returns {[]|*[]}\r\n   */\r\n  getStyleOptions () {\r\n    return clone(this._chartPane.chartData().styleOptions())\r\n  }\r\n\r\n  /**\r\n   * 设置价格数量精度\r\n   * @param pricePrecision 价格精度\r\n   * @param volumePrecision 数量精度\r\n   */\r\n  setPriceVolumePrecision (pricePrecision, volumePrecision) {\r\n    if (!isNumber(pricePrecision) || pricePrecision < 0) {\r\n      logWarn('setPriceVolumePrecision', 'pricePrecision', 'pricePrecision must be a number and greater than zero!!!')\r\n      return\r\n    }\r\n    if (!isNumber(volumePrecision) || volumePrecision < 0) {\r\n      logWarn('setPriceVolumePrecision', 'volumePrecision', 'volumePrecision must be a number and greater than zero!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().setPriceVolumePrecision(pricePrecision, volumePrecision)\r\n  }\r\n\r\n  /**\r\n   * 设置时区\r\n   * @param timezone 时区\r\n   */\r\n  setTimezone (timezone) {\r\n    this._chartPane.setTimezone(timezone)\r\n  }\r\n\r\n  /**\r\n   * 获取当前时区\r\n   */\r\n  getTimezone () {\r\n    return this._chartPane.chartData().timeScaleStore().timezone()\r\n  }\r\n\r\n  /**\r\n   * 重置尺寸，总是会填充父容器\r\n   */\r\n  resize () {\r\n    this._chartPane.adjustPaneViewport(true, true, true, true, true)\r\n  }\r\n\r\n  /**\r\n   * 设置右边间距\r\n   * @param space 空间大小\r\n   */\r\n  setOffsetRightSpace (space) {\r\n    if (!isNumber(space)) {\r\n      logWarn('setOffsetRightSpace', 'space', 'space must be a number!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().timeScaleStore().setOffsetRightSpace(space, true)\r\n  }\r\n\r\n  /**\r\n   * 设置左边可见的最小bar数量\r\n   * @param barCount bar数量\r\n   */\r\n  setLeftMinVisibleBarCount (barCount) {\r\n    if (!isNumber(barCount) || barCount <= 0) {\r\n      logWarn('setLeftMinVisibleBarCount', 'barCount', 'barCount must be a number and greater than zero!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().timeScaleStore().setLeftMinVisibleBarCount(Math.ceil(barCount))\r\n  }\r\n\r\n  /**\r\n   * 设置右边可见的最小bar数量\r\n   * @param barCount bar数量\r\n   */\r\n  setRightMinVisibleBarCount (barCount) {\r\n    if (!isNumber(barCount) || barCount <= 0) {\r\n      logWarn('setRightMinVisibleBarCount', 'barCount', 'barCount must be a number and greater than zero!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().timeScaleStore().setRightMinVisibleBarCount(Math.ceil(barCount))\r\n  }\r\n\r\n  /**\r\n   * 设置一条数据的空间\r\n   * @param space 空间大小\r\n   */\r\n  setDataSpace (space) {\r\n    if (!isNumber(space)) {\r\n      logWarn('setDataSpace', 'space', 'space must be a number!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().timeScaleStore().setDataSpace(space)\r\n  }\r\n\r\n  /**\r\n   * 获取单条数据的空间\r\n   * @returns\r\n   */\r\n  getDataSpace () {\r\n    return this._chartPane.chartData().timeScaleStore().dataSpace()\r\n  }\r\n\r\n  /**\r\n   * 获取单条数据绘制的空间\r\n   * @returns\r\n   */\r\n  getBarSpace () {\r\n    return this._chartPane.chartData().timeScaleStore().barSpace()\r\n  }\r\n\r\n  /**\r\n   * 清空数据\r\n   */\r\n  clearData () {\r\n    this._chartPane.chartData().clearDataList()\r\n  }\r\n\r\n  /**\r\n   * 获取数据源\r\n   */\r\n  getDataList () {\r\n    return this._chartPane.chartData().dataList()\r\n  }\r\n\r\n  /**\r\n   * 添加新数据\r\n   * @param dataList k线数据数组\r\n   * @param more 是否还有更多标识\r\n   */\r\n  applyNewData (dataList, more) {\r\n    if (!isArray(dataList)) {\r\n      logWarn('applyNewData', 'dataList', 'dataList must be an array!!!')\r\n      return\r\n    }\r\n    const chartData = this._chartPane.chartData()\r\n    chartData.clearDataList()\r\n    chartData.addData(dataList, 0, more)\r\n    Promise.resolve(chartData.technicalIndicatorStore().calcInstance()).then(\r\n      result => {\r\n        if (result) {\r\n          this._chartPane.adjustPaneViewport(false, true, true, true)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 添加历史更多数据\r\n   * @param dataList k线数据数组\r\n   * @param more 是否还有更多标识\r\n   */\r\n  applyMoreData (dataList, more) {\r\n    if (!isArray(dataList)) {\r\n      logWarn('applyMoreData', 'dataList', 'dataList must be an array!!!')\r\n      return\r\n    }\r\n    const chartData = this._chartPane.chartData()\r\n    chartData.addData(dataList, 0, more)\r\n    Promise.resolve(chartData.technicalIndicatorStore().calcInstance()).then(\r\n      result => {\r\n        if (result) {\r\n          this._chartPane.adjustPaneViewport(false, true, true, true)\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 更新数据\r\n   * @param data 新的k线数据\r\n   */\r\n  updateData (data) {\r\n    if (!isObject(data) || isArray(data)) {\r\n      logWarn('updateData', 'data', 'data must be an object!!!')\r\n      return\r\n    }\r\n    const chartData = this._chartPane.chartData()\r\n    const dataList = chartData.dataList()\r\n    const dataSize = dataList.length\r\n    // 这里判断单个数据应该添加到哪个位置\r\n    const timestamp = formatValue(data, 'timestamp', 0)\r\n    const lastDataTimestamp = formatValue(dataList[dataSize - 1], 'timestamp', 0)\r\n    if (timestamp >= lastDataTimestamp) {\r\n      let pos = dataSize\r\n      if (timestamp === lastDataTimestamp) {\r\n        pos = dataSize - 1\r\n      }\r\n      chartData.addData(data, pos)\r\n      Promise.resolve(chartData.technicalIndicatorStore().calcInstance()).then(\r\n        result => {\r\n          if (result) {\r\n            this._chartPane.adjustPaneViewport(false, true, true, true)\r\n          }\r\n        }\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置加载更多回调\r\n   * @param cb 回调方法\r\n   */\r\n  loadMore (cb) {\r\n    if (!isFunction(cb)) {\r\n      logWarn('loadMore', 'cb', 'cb must be a function!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().timeScaleStore().setLoadMoreCallback(cb)\r\n  }\r\n\r\n  /**\r\n   * 创建一个技术指标\r\n   * @param value 指标名或者指标\r\n   * @param isStack 是否覆盖\r\n   * @param paneOptions 窗口配置\r\n   * @returns {string|null}\r\n   */\r\n  createTechnicalIndicator (value, isStack, paneOptions) {\r\n    if (!isValid(value)) {\r\n      logWarn('createTechnicalIndicator', 'value', 'value is invalid!!!')\r\n      return null\r\n    }\r\n    const tech = isObject(value) && !isArray(value) ? value : { name: value }\r\n    if (!this._chartPane.chartData().technicalIndicatorStore().hasTemplate(tech.name)) {\r\n      logWarn('createTechnicalIndicator', 'value', 'can not find the corresponding technical indicator!!!')\r\n      return null\r\n    }\r\n    return this._chartPane.createTechnicalIndicator(tech, isStack, paneOptions)\r\n  }\r\n\r\n  /**\r\n   * 添加技术指标模板\r\n   * @param template 指标模板\r\n   */\r\n  addTechnicalIndicatorTemplate (template) {\r\n    if (!isObject(template)) {\r\n      logWarn('addTechnicalIndicatorTemplate', 'template', 'template must be an object or array!!!')\r\n      return\r\n    }\r\n    const templates = [].concat(template)\r\n    this._chartPane.chartData().technicalIndicatorStore().addTemplate(templates)\r\n  }\r\n\r\n  /**\r\n   * 覆盖技术指标\r\n   * @param override 覆盖参数\r\n   * @param paneId 窗口id\r\n   */\r\n  overrideTechnicalIndicator (techOverride, paneId) {\r\n    if (!isObject(techOverride) || isArray(techOverride)) {\r\n      logWarn('overrideTechnicalIndicator', 'overrideTech', 'overrideTech must be an object!!!')\r\n      return\r\n    }\r\n    const promise = this._chartPane.chartData().technicalIndicatorStore().override(techOverride, paneId)\r\n    if (promise) {\r\n      promise.then(\r\n        _ => {\r\n          this._chartPane.adjustPaneViewport(false, true, true, true)\r\n        }\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取技术指标名字获取技术指标\r\n   * @param name 指标名\r\n   * @return {{}}\r\n   */\r\n  getTechnicalIndicatorTemplate (name) {\r\n    return this._chartPane.chartData().technicalIndicatorStore().getTemplateInfo(name)\r\n  }\r\n\r\n  /**\r\n    * 获取窗口上的技术指标\r\n    * @param paneId 窗口id\r\n    * @param name 指标名\r\n    * @return {{}}\r\n    */\r\n  getTechnicalIndicatorByPaneId (paneId, name) {\r\n    return this._chartPane.chartData().technicalIndicatorStore().getInstanceInfo(paneId, name)\r\n  }\r\n\r\n  /**\r\n   * 移除一个技术指标\r\n   * @param paneId 窗口id\r\n   * @param name 指标名\r\n   */\r\n  removeTechnicalIndicator (paneId, name) {\r\n    this._chartPane.removeTechnicalIndicator(paneId, name)\r\n  }\r\n\r\n  /**\r\n   * 添加图形模板\r\n   * @param template 图形模板\r\n   */\r\n  addShapeTemplate (template) {\r\n    if (!isObject(template)) {\r\n      logWarn('addShapeTemplate', 'template', 'template must be an object or array!!!')\r\n      return\r\n    }\r\n    const templates = [].concat(template)\r\n    this._chartPane.chartData().shapeStore().addTemplate(templates)\r\n  }\r\n\r\n  /**\r\n   * 创建图形\r\n   * @param value 图形名或者图形配置\r\n   * @param paneId 窗口id\r\n   */\r\n  createShape (value, paneId) {\r\n    if (!isValid(value)) {\r\n      logWarn('createShape', 'value', 'value is invalid!!!')\r\n      return null\r\n    }\r\n    const shapeOptions = isObject(value) && !isArray(value) ? value : { name: value }\r\n    const Shape = this._chartPane.chartData().shapeStore().getTemplate(shapeOptions.name)\r\n    if (!Shape) {\r\n      logWarn('createShape', 'value', 'can not find the corresponding shape!!!')\r\n      return null\r\n    }\r\n    const id = this._chartPane.createShape(Shape, shapeOptions, paneId)\r\n    if (!id) {\r\n      logWarn('createShape', 'options.id', 'duplicate id!!!')\r\n    }\r\n    return id\r\n  }\r\n\r\n  /**\r\n   * 获取图形标记\r\n   * @param shapeId 图形标记id\r\n   * @return {{name, lock: *, styles, id, points: (*|*[])}[]|{name, lock: *, styles, id, points: (*|*[])}}\r\n   */\r\n  getShape (shapeId) {\r\n    return this._chartPane.chartData().shapeStore().getInstanceInfo(shapeId)\r\n  }\r\n\r\n  /**\r\n   * 设置图形标记配置\r\n   * @param options 图形标记配置\r\n   */\r\n  setShapeOptions (options) {\r\n    if (!isObject(options) || isArray(options)) {\r\n      logWarn('setShapeOptions', 'options', 'options must be an object!!!')\r\n      return\r\n    }\r\n    this._chartPane.chartData().shapeStore().setInstanceOptions(options)\r\n  }\r\n\r\n  /**\r\n   * 移除图形\r\n   * @param shapeId 图形id\r\n   */\r\n  removeShape (shapeId) {\r\n    this._chartPane.chartData().shapeStore().removeInstance(shapeId)\r\n  }\r\n\r\n  /**\r\n   * 创建注解\r\n   * @param annotation 单个注解或者注解数组\r\n   * @param paneId 窗口id\r\n   */\r\n  createAnnotation (annotation, paneId = CANDLE_PANE_ID) {\r\n    if (!isObject(annotation)) {\r\n      logWarn('createAnnotation', 'annotation', 'annotation must be an object or array!!!')\r\n      return\r\n    }\r\n    if (!this._chartPane.hasPane(paneId)) {\r\n      logWarn('createAnnotation', 'paneId', 'can not find the corresponding pane!!!')\r\n      return\r\n    }\r\n    const annotations = [].concat(annotation)\r\n    this._chartPane.createAnnotation(annotations, paneId)\r\n  }\r\n\r\n  /**\r\n   * 移除注解\r\n   * @param paneId 窗口id\r\n   * @param points 单个点或者点数组\r\n   */\r\n  removeAnnotation (paneId, points) {\r\n    this._chartPane.chartData().annotationStore().remove(paneId, points)\r\n  }\r\n\r\n  /**\r\n   * 创建标签\r\n   * @param tag 单个标签或者标签数组\r\n   * @param paneId 窗口id\r\n   */\r\n  createTag (tag, paneId = CANDLE_PANE_ID) {\r\n    if (!isObject(tag)) {\r\n      logWarn('createTag', 'tag', 'tag must be an object or array!!!')\r\n      return\r\n    }\r\n    if (!this._chartPane.hasPane(paneId)) {\r\n      logWarn('createTag', 'paneId', 'can not find the corresponding pane!!!')\r\n      return\r\n    }\r\n    const tags = [].concat(tag)\r\n    this._chartPane.createTag(tags, paneId)\r\n  }\r\n\r\n  /**\r\n   * 移除标签\r\n   * @param paneId 窗口id\r\n   * @param tagId 标签id\r\n   */\r\n  removeTag (paneId, tagId) {\r\n    this._chartPane.chartData().tagStore().remove(paneId, tagId)\r\n  }\r\n\r\n  /**\r\n   * 设置窗口属性\r\n   * @param options 窗口配置\r\n   */\r\n  setPaneOptions (options) {\r\n    if (!isObject(options)) {\r\n      logWarn('setPaneOptions', 'options', 'options must be an object!!!')\r\n      return\r\n    }\r\n    this._chartPane.setPaneOptions(options, false)\r\n  }\r\n\r\n  /**\r\n   * 设置是否可以缩放\r\n   * @param enabled 标识\r\n   */\r\n  setZoomEnabled (enabled) {\r\n    this._chartPane.chartData().timeScaleStore().setZoomEnabled(enabled)\r\n  }\r\n\r\n  /**\r\n   * 是否可以缩放\r\n   * @return {boolean}\r\n   */\r\n  isZoomEnabled () {\r\n    return this._chartPane.chartData().timeScaleStore().zoomEnabled()\r\n  }\r\n\r\n  /**\r\n   * 设置是否可以拖拽滚动\r\n   * @param enabled 标识\r\n   */\r\n  setScrollEnabled (enabled) {\r\n    this._chartPane.chartData().timeScaleStore().setScrollEnabled(enabled)\r\n  }\r\n\r\n  /**\r\n   * 是否可以拖拽滚动\r\n   * @return {boolean}\r\n   */\r\n  isScrollEnabled () {\r\n    return this._chartPane.chartData().timeScaleStore().scrollEnabled()\r\n  }\r\n\r\n  /**\r\n   * 按距离滚动\r\n   * @param distance 距离\r\n   * @param animationDuration 动画持续时间\r\n   */\r\n  scrollByDistance (distance, animationDuration) {\r\n    if (!isNumber(distance)) {\r\n      logWarn('scrollByDistance', 'distance', 'distance must be a number!!!')\r\n      return\r\n    }\r\n    if (isNumber(animationDuration) && animationDuration > 0) {\r\n      this._chartPane.chartData().timeScaleStore().startScroll()\r\n      const startTime = new Date().getTime()\r\n      const animation = () => {\r\n        const progress = (new Date().getTime() - startTime) / animationDuration\r\n        const finished = progress >= 1\r\n        const dis = finished ? distance : distance * progress\r\n        this._chartPane.chartData().timeScaleStore().scroll(dis)\r\n        if (!finished) {\r\n          requestAnimationFrame(animation)\r\n        }\r\n      }\r\n      animation()\r\n    } else {\r\n      this._chartPane.chartData().timeScaleStore().startScroll()\r\n      this._chartPane.chartData().timeScaleStore().scroll(distance)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 滚动到实时位置\r\n   * @param animationDuration 动画持续时间\r\n   */\r\n  scrollToRealTime (animationDuration) {\r\n    const difBarCount = this._chartPane.chartData().timeScaleStore().offsetRightBarCount() - this._chartPane.chartData().timeScaleStore().offsetRightSpace() / this._chartPane.chartData().timeScaleStore().dataSpace()\r\n    const distance = difBarCount * this._chartPane.chartData().timeScaleStore().dataSpace()\r\n    this.scrollByDistance(distance, animationDuration)\r\n  }\r\n\r\n  /**\r\n   * 滚动到指定的数据索引\r\n   * @param dataIndex 数据索引\r\n   * @param animationDuration 动画持续时间\r\n   */\r\n  scrollToDataIndex (dataIndex, animationDuration) {\r\n    if (!isNumber(dataIndex)) {\r\n      logWarn('scrollToDataIndex', 'dataIndex', 'dataIndex must be a number!!!')\r\n      return\r\n    }\r\n    const distance = (this._chartPane.chartData().dataList().length - 1 - dataIndex) * this._chartPane.chartData().timeScaleStore().dataSpace()\r\n    this.scrollByDistance(distance, animationDuration)\r\n  }\r\n\r\n  /**\r\n   * 在某个坐标点缩放\r\n   * @param scale 缩放比例\r\n   * @param coordinate 坐标点\r\n   * @param animationDuration 动画持续时间\r\n   */\r\n  zoomAtCoordinate (scale, coordinate, animationDuration) {\r\n    if (!isNumber(scale)) {\r\n      logWarn('zoomAtCoordinate', 'scale', 'scale must be a number!!!')\r\n      return\r\n    }\r\n    if (isNumber(animationDuration) && animationDuration > 0) {\r\n      const dataSpace = this._chartPane.chartData().timeScaleStore().dataSpace()\r\n      const scaleDataSpace = dataSpace * scale\r\n      const difSpace = scaleDataSpace - dataSpace\r\n      const startTime = new Date().getTime()\r\n      const animation = () => {\r\n        const progress = (new Date().getTime() - startTime) / animationDuration\r\n        const finished = progress >= 1\r\n        const progressDataSpace = finished ? difSpace : difSpace * progress\r\n        this._chartPane.chartData().timeScaleStore().zoom(progressDataSpace / dataSpace, coordinate)\r\n        if (!finished) {\r\n          requestAnimationFrame(animation)\r\n        }\r\n      }\r\n      animation()\r\n    } else {\r\n      this._chartPane.chartData().timeScaleStore().zoom(scale, coordinate)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在某个数据索引缩放\r\n   * @param scale 缩放比例\r\n   * @param dataIndex 索引位置\r\n   * @param animationDuration 动画持续时间\r\n   */\r\n  zoomAtDataIndex (scale, dataIndex, animationDuration) {\r\n    if (!isNumber(scale)) {\r\n      logWarn('zoomAtDataIndex', 'scale', 'scale must be a number!!!')\r\n      return\r\n    }\r\n    if (!isNumber(dataIndex)) {\r\n      logWarn('zoomAtDataIndex', 'dataIndex', 'dataIndex must be a number!!!')\r\n      return\r\n    }\r\n    const x = this._chartPane.chartData().timeScaleStore().dataIndexToCoordinate(dataIndex)\r\n    this.zoomAtCoordinate(scale, { x }, animationDuration)\r\n  }\r\n\r\n  /**\r\n   * 将值装换成像素\r\n   * @param point 单个点或者点集合\r\n   * @param finder 过滤条件\r\n   */\r\n  convertToPixel (point, finder) {\r\n    return this._chartPane.convertToPixel(point, finder)\r\n  }\r\n\r\n  /**\r\n   * 将像素转换成值\r\n   * @param coordinate 单个坐标或者坐标集合\r\n   * @param finder 过滤条件\r\n   */\r\n  convertFromPixel (coordinate, finder) {\r\n    return this._chartPane.convertFromPixel(coordinate, finder)\r\n  }\r\n\r\n  /**\r\n   * 订阅图表动作\r\n   * @param type 动作类型\r\n   * @param callback 回调方法\r\n   */\r\n  subscribeAction (type, callback) {\r\n    if (!this._chartPane.chartData().actionStore().subscribe(type, callback)) {\r\n      logWarn('subscribeAction', 'type', 'type does not exist!!!')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 取消订阅图表动作\r\n   * @param type 动作类型\r\n   * @param callback 回调方法\r\n   */\r\n  unsubscribeAction (type, callback) {\r\n    if (!this._chartPane.chartData().actionStore().unsubscribe(type, callback)) {\r\n      logWarn('unsubscribeAction', 'type', 'type does not exist!!!')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取将图表装换成图片后的url\r\n   * @param includeOverlay 是否包含覆盖层\r\n   * @param type 图片类型\r\n   * @param backgroundColor 背景色\r\n   */\r\n  getConvertPictureUrl (includeOverlay, type = 'jpeg', backgroundColor = '#FFFFFF') {\r\n    if (type !== 'png' && type !== 'jpeg' && type !== 'bmp') {\r\n      logWarn('getConvertPictureUrl', 'type', 'type only supports jpeg, png and bmp!!!')\r\n      return\r\n    }\r\n    return this._chartPane.getConvertPictureUrl(includeOverlay, type, backgroundColor)\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy () {\r\n    this._chartPane.destroy()\r\n  }\r\n}\r\n","/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Chart from './Chart'\r\nimport { logError, logTag, logWarn } from './utils/logger'\r\nimport { isString } from './utils/typeChecks'\r\n\r\nconst instances = {}\r\nlet chartBaseId = 1\r\nconst CHART_NAME_PREFIX = 'k_line_chart_'\r\n\r\n/**\r\n * 获取版本号\r\n * @returns {string}\r\n */\r\nfunction version () {\r\n  return '__BUILD_VERSION__'\r\n}\r\n\r\n/**\r\n * 初始化\r\n * @param ds\r\n * @param style\r\n * @returns {Chart}\r\n */\r\nfunction init (ds, style = {}) {\r\n  logTag()\r\n  const errorMessage = 'The chart cannot be initialized correctly. Please check the parameters. The chart container cannot be null and child elements need to be added!!!'\r\n  let dom\r\n  if (!ds) {\r\n    logError('', '', errorMessage)\r\n    return null\r\n  }\r\n  if (isString(ds)) {\r\n    dom = document.getElementById(ds)\r\n  } else {\r\n    dom = ds\r\n  }\r\n  if (!dom) {\r\n    logError('', '', errorMessage)\r\n    return null\r\n  }\r\n  let chart = instances[dom.chartId || '']\r\n  if (chart) {\r\n    logWarn('', '', 'The chart has been initialized on the dom！！！')\r\n    return chart\r\n  }\r\n  const id = `${CHART_NAME_PREFIX}${chartBaseId++}`\r\n  chart = new Chart(dom, style)\r\n  chart.id = id\r\n  dom.chartId = id\r\n  instances[id] = chart\r\n  return chart\r\n}\r\n\r\n/**\r\n * 销毁\r\n * @param dcs\r\n */\r\nfunction dispose (dcs) {\r\n  if (dcs) {\r\n    let id\r\n    if (isString(dcs)) {\r\n      const dom = document.getElementById(dcs)\r\n      id = dom && dom.chartId\r\n    } else if (dcs instanceof Chart) {\r\n      id = dcs.id\r\n    } else {\r\n      id = dcs && dcs.chartId\r\n    }\r\n    if (id) {\r\n      instances[id].destroy()\r\n      delete instances[id]\r\n    }\r\n  }\r\n}\r\n\r\nexport { version, init, dispose }\r\n"],"names":["technicalIndicatorExtensions","shapeExtensions","addTechnicalIndicatorTemplate","template","concat","forEach","tmp","name","addShapeTemplate","merge","target","source","isObject","key","Object","prototype","hasOwnProperty","call","targetProp","sourceProp","isArray","isValid","clone","copy","v","value","toString","isFunction","isNumber","isNaN","undefined","isBoolean","isString","StrokeFillStyle","STROKE","FILL","LineStyle","DASH","SOLID","YAxisPosition","LEFT","RIGHT","YAxisType","NORMAL","PERCENTAGE","LOG","CandleType","CANDLE_SOLID","CANDLE_STROKE","CANDLE_UP_STROKE","CANDLE_DOWN_STROKE","OHLC","AREA","TooltipShowRule","ALWAYS","FOLLOW_CROSS","NONE","TooltipShowType","RECT","STANDARD","AnnotationSymbolType","CIRCLE","TRIANGLE","DIAMOND","CUSTOM","OverlayPosition","POINT","TOP","BOTTOM","defaultGrid","show","horizontal","size","color","style","dashValue","vertical","defaultCandle","margin","top","bottom","type","bar","upColor","downColor","noChangeColor","area","lineSize","lineColor","backgroundColor","offset","priceMark","high","textMargin","textSize","textFamily","textWeight","low","last","line","text","paddingLeft","paddingTop","paddingRight","paddingBottom","family","weight","borderRadius","tooltip","showRule","showType","labels","values","defaultValue","rect","offsetLeft","offsetTop","offsetRight","borderSize","borderColor","marginLeft","marginTop","marginRight","marginBottom","defaultTechnicalIndicator","colors","circle","lastValueMark","showName","showParams","defaultXAxis","height","axisLine","tickText","tickLine","length","defaultYAxis","width","position","inside","defaultCrosshair","defaultShape","point","radius","activeBackgroundColor","activeBorderColor","activeBorderSize","activeRadius","polygon","stroke","fill","arc","defaultAnnotation","symbol","activeSize","activeColor","defaultTag","mark","defaultSeparator","defaultStyleOptions","grid","candle","technicalIndicator","xAxis","yAxis","separator","crosshair","shape","annotation","tag","formatValue","data","formatDate","dateTimeFormat","timestamp","format","dateTimeString","Date","dateTimeStringArray","split","dateStringArray","date","YYYY","MM","DD","match","replace","formatPrecision","precision","toFixed","formatBigNumber","logWarn","api","invalidParam","append","console","log","logError","logTag","binarySearchNearest","dataList","valueKey","targetNumber","left","right","midIndex","Math","floor","mid","midValue","nice","exponent","log10","exp10","index10","f","nf","round","min","max","getPrecision","str","eIndex","indexOf","slice","dotIndex","pow","DEFAULT_TECHNICAL_INDICATOR_PANE_HEIGHT","TECHNICAL_INDICATOR_PANE_ID_PREFIX","SHAPE_ID_PREFIX","CANDLE_PANE_ID","MIN_DATA_SPACE","MAX_DATA_SPACE","InvalidateLevel","OVERLAY","MAIN","FULL","ActionType","ZOOM","SCROLL","CROSSHAIR","PANE_DRAG","TimeScaleStore","chartData","_chartData","_dateTimeFormat","Intl","DateTimeFormat","hour12","year","month","day","hour","minute","_zoomEnabled","_scrollEnabled","_loading","_loadMoreCallback","_more","_totalDataSpace","_dataSpace","_barSpace","_calcBarSpace","_offsetRightSpace","_offsetRightBarCount","_leftMinVisibleBarCount","_rightMinVisibleBarCount","_from","_to","_preOffsetRightBarCount","rateBarSpace","floorBarSpace","optimalBarSpace","dataSize","barLength","maxRightOffsetBarCount","minRightOffsetBarCount","adjustVisibleDataList","more","loading","timezone","timeZone","e","resolvedOptions","dataSpace","adjustBeforeFuc","adjustFromTo","crosshairStore","recalculate","invalidate","totalSpace","space","setOffsetRightSpace","barCount","distance","distanceBarCount","actionStore","execute","cross","get","set","dataIndex","x","deltaFromRight","index","getDataByDataIndex","pixel","ceil","coordinateToFloatIndex","scale","coordinate","floatIndex","setDataSpace","enabled","callback","TechnicalIndicatorPlotType","LINE","BAR","TechnicalIndicatorSeries","PRICE","VOLUME","TechnicalIndicator","series","calcParams","plots","shouldCheckParamCount","shouldOhlc","shouldFormatBigNumber","minValue","maxValue","styles","_precisionFlag","result","map","param","flag","parseInt","params","i","allowDecimal","oldParam","push","regeneratePlots","_createParams","defaultStyles","calcTechnicalIndicator","options","getTechnicalIndicatorTooltipData","technicalIndicatorData","calcParamText","join","plot","title","TechnicalIndicatorStore","_templates","_createTemplates","_instances","Map","tech","mapping","extensions","extension","templateInstance","_createTemplateInstance","render","Template","templates","instance","_createTechInfo","templateInfos","paneId","isStack","paneInstances","has","create","getPrototypeOf","setCalcParams","setPrecision","setShouldOhlc","setShouldFormatBigNumber","setStyles","styleOptions","clear","calc","removed","delete","calcSuccess","info","instanceInfos","entry","instanceInfo","infos","paneInstance","pricePrecision","volumePrecision","techOverride","defaultTechStyleOptions","instances","overiderSuccss","tasks","calcParamsSuccess","precisionSuccess","shouldOhlcSuccess","shouldFormatBigNumberSuccess","styleSuccess","Promise","resolve","all","perfectOverlayFunc","overlay","funcs","fn","Overlay","id","_id","_xAxis","_yAxis","_styles","ctx","points","event","renderFillCircle","fillColor","circleCoordinate","fillStyle","beginPath","y","PI","closePath","DEVIATION","getTriangleSquare","coordinate1","coordinate2","coordinate3","x1","abs","y1","x2","y2","checkCoordinateInCircle","circleCenterCoordinate","targetCoordinate","difX","difY","checkCoordinateInTriangle","triangleCoordinates","square","compareSquare","checkCoordinateInDiamond","centerCoordinate","xDis","yDis","checkCoordinateInRect","renderPath","coordinates","strokeFill","save","lineWidth","translate","move","moveTo","lineTo","restore","renderStrokePath","renderFillPath","renderHorizontalLine","correction","renderVerticalLine","renderLine","getPixelRatio","canvas","ownerDocument","defaultView","devicePixelRatio","calcTextWidth","measureText","createFont","fontSize","fontWeight","fontFamily","SHAPE_DRAW_STEP_START","SHAPE_DRAW_STEP_FINISHED","ShapeMouseOperateElement","OTHER","ShapeElementType","TEXT","CONTINUOUS_LINE","POLYGON","ARC","LineType","COMMON","HORIZONTAL","VERTICAL","ShapeMode","WEAK_MAGNET","STRONG_MAGNET","getLineType","Shape","totalStep","lock","_name","_totalStep","_lock","_mode","_data","_drawStep","_points","setPoints","_prevPressPoint","_prevPoints","_coordinates","repeatTotalStep","performEventMoveForDrawing","step","mode","movePoint","performEventPressedMove","pressPointIndex","pressPoint","timeScaleStore","timestampToDataIndex","convertToPixel","lines","strokeStyle","setLineDash","lineType","continuousLines","polygons","strokeStyles","arcs","startAngle","endAngle","texts","fillStroke","strokeText","fillText","font","_timestampOrDataIndexToCoordinateX","shapeOptions","viewport","price","volume","_shapeDataSources","createShapeDataSource","isDraw","dataSource","_drawLines","_drawContinuousLines","_drawPolygons","_drawArcs","_drawText","drawExtend","shapeMouseOperate","shapeStore","mouseOperate","hover","element","click","isDrawing","elementIndex","eventCoordinate","start","isCheck","sources","checkEventCoordinateOnShape","convertFromPixel","kLineData","highY","buffValue","lowY","open","close","dataIndexToTimestamp","_performValue","onDrawing","progressInstanceComplete","onDrawEnd","onPressedMove","difDataIndex","difValue","ShapeStore","_mouseOperate","_progressInstance","_pressedInstance","TemplateClass","_createTemplateClass","shapeId","find","s","getInstance","fixed","progressInstance","setYAxis","shouldInvalidate","setLock","setMode","setData","shapes","onRemove","removeIndex","findIndex","splice","pressedInstance","AnnotationStore","_annotations","_visibleAnnotations","operate","visibleDataList","annotations","an","createSymbolCoordinate","idAnnotations","createVisibleAnnotations","shouldAdjust","paneAnnotations","TagStore","_tags","tags","_getById","update","idTags","tagId","paneTags","ids","CrosshairStore","_crosshair","notInvalidate","cr","realDataIndex","coordinateToDataIndex","realX","dataIndexToCoordinate","prevCrosshair","crosshairChange","Delegate","_observers","observer","ActionStore","_delegates","hasObservers","subscribe","delegate","unsubscribe","ChartData","handler","_handler","_styleOptions","_pricePrecision","_volumePrecision","_dataList","_visibleDataList","_dragPaneFlag","_timeScaleStore","_technicalIndicatorStore","_shapeStore","_annotationStore","_tagStore","_crosshairStore","_actionStore","from","to","setSeriesPrecision","pos","setLoading","setMore","isFirstAdd","resetOffsetRightSpace","offsetRightBarCount","setOffsetRightBarCount","invalidateLevel","createElement","document","Pane","props","_height","_container","container","_initBefore","_initElement","_mainWidget","_createMainWidget","_element","_yAxisWidget","_createYAxisWidget","padding","overflow","lastElement","lastChild","insertBefore","appendChild","offsetWidth","mainWidgetWidth","yAxisWidgetWidth","setWidth","setHeight","mainWidgetOffsetLeft","yAxisWidgetOffsetLeft","setOffsetLeft","offsetHeight","layout","level","includeOverlay","getContext","pixelRatio","mainWidgetElement","getElement","mainWidgetHeight","drawImage","getImage","yAxisWidgetElement","yAxisWidgetHeight","removeChild","Widget","_width","_mainView","_createMainView","_overlayView","_createOverlayView","flush","requestAnimationFrame","window","setTimeout","cancelAnimationFrame","clearTimeout","View","_initCanvas","_canvas","zIndex","_ctx","extendFun","clearRect","_draw","_redraw","requestAnimationId","TechnicalIndicatorView","_paneId","globalCompositeOperation","_drawContent","_drawTechs","_drawGrid","gridOptions","gridHorizontalOptions","ticks","tick","gridVerticalOptions","techOptions","techs","technicalIndicatorStore","techResult","kLineDataList","technicalIndicatorDataList","barSpace","isCandleYAxis","_drawGraphics","halfBarSpace","techData","lineValueIndex","_drawCandleBar","valueY","cbData","prev","current","next","_drawCircle","isStroke","baseValue","baseValueY","_drawBar","n","colorSize","strokeRect","fillRect","barOptions","barStyle","openY","closeY","highEndY","lowStartY","barHeight","renderText","TechnicalIndicatorOverlayView","textBaseline","_drawTag","_drawShape","_drawAnnotation","crosshairOptions","_drawCrosshairLine","_drawTooltip","annotationStore","draw","tagStore","drawMarkLine","progressShape","_drawBatchTechToolTip","_shouldDrawTooltip","optionsKey","end","drawLine","crosshairDirectionOptions","crosshairLineOptions","isDrawTechTooltip","techTooltipOptions","_drawTechTooltip","tooltipData","techTooltipTextOptions","textMarginLeft","textMarginRight","labelX","labelY","textColor","nameText","nameTextWidth","calcParamTextWidth","lineCount","valueColor","textWidth","tooltipOptions","TechnicalIndicatorWidget","renderStrokeFillRoundRect","renderFillRoundRect","renderStrokeRoundRect","renderFillRect","w","h","r","renderRoundRect","arcTo","YAxisView","yAxisOptions","_drawAxisLine","_drawTickLines","_drawTickLabels","_drawTechLastValue","_drawLastPriceLabel","isFromYAxisZero","tickLineLength","startX","endX","tickLineShow","textAlign","lastValueMarkOptions","_drawMarkLabel","priceMarkOptions","lastPriceMarkOptions","convertToNicePixel","yAxisType","fromData","fromClose","rectWidth","rectHeight","rectStartX","YAxisOverlayView","_drawCrossHairLabel","drawText","crosshairHorizontalOptions","crosshairHorizontalTextOptions","yAxisDataLabelWidth","rectY","YAxisWidget","Axis","_cacheMinValue","_cacheMaxValue","_minValue","_maxValue","_range","_ticks","_initMeasureCanvas","measureCanvas","_measureCtx","forceCompute","minMax","_optimalMinMax","_computeMinMax","range","_optimalTicks","_computeTicks","intervalPrecision","_computeInterval","interval","first","YAxis","_realRange","_isCandleYAxis","minMaxArray","Number","MAX_SAFE_INTEGER","MIN_SAFE_INTEGER","plotsResult","techPrecision","candleOptions","isArea","areaValueKey","shouldCompareHighLow","specifyMin","specifyMax","dif","minCheck","maxCheck","marginOptions","topRate","bottomRate","optimalTicks","textHeight","validY","_innerConvertToPixel","yAxisWidth","crosshairVerticalTextWidth","valueText","TechnicalIndicatorPane","_createYAxis","CandleView","_drawLastPriceLine","_drawArea","_drawLowHighPrice","comparePrice","_drawCandle","lineCoordinates","areaCoordinates","minY","areaOptions","areaCoordinateLength","lastCoordinate","gradient","createLinearGradient","addColorStop","optionKey","priceKey","initPriceValue","offsets","compare","lowHighPriceMarkOptions","priceY","startY","CandleOverlayView","candleTooltipOptions","isDrawCandleTooltip","_drawCandleTooltipWithRect","_drawCandleTooltipWithStandard","_getCandleTooltipData","label","labelWidth","baseLabels","baseValues","baseTextMarginLeft","baseTextMarginRight","baseTextMarginTop","baseTextMarginBottom","baseTextSize","baseTextColor","rectOptions","rectBorderSize","rectPaddingLeft","rectPaddingRight","rectPaddingTop","rectPaddingBottom","rectLeft","rectRight","maxLabelWidth","techTooltipTextMarginLeft","techTooltipTextMarginRight","techTooltipTextMarginTop","techTooltipTextMarginBottom","techTooltipTextSize","techTooltipDataList","centerX","rectX","baseLabelX","indicatorLabelX","CandleWidget","CandlePane","XAxisView","xAxisOptions","xAxisLine","endY","tickLength","XAxisOverlayView","_drawCrosshairLabel","crosshairVerticalOptions","crosshairVerticalTextOptions","XAxisWidget","XAxis","defaultLabelWidth","tickCountDif","nextPos","nextX","xDif","prePos","preKLineData","preTimestamp","_optimalTickLabel","oV","optimalTickLength","firstTimestamp","secondTimestamp","thirdV","test","comparedTimestamp","stylOptions","xAxisHeight","crosshairVerticalTextHeight","XAxisPane","MouseEventButton","DELAY_RESET_CLICK","DELAY_LONG_TAG","getBoundingClientRect","isTouchEvent","Boolean","touches","preventDefault","cancelable","checkTouchEvents","DocumentTouch","touch","navigator","maxTouchPoints","msMaxTouchPoints","mobileTouch","getDistance","p1","p2","xDiff","clientX","yDiff","clientY","sqrt","EventType","MOUSE","TOUCH","EventBase","eventHandler","_target","_options","_clickCount","_clickTimeoutId","_longTapTimeoutId","_longTapActive","_mouseMoveStartPosition","_moveExceededManhattanDistance","_cancelClick","_unsubscribeOutsideEvents","_unsubscribeMousemove","_unsubscribeRoot","_startPinchMiddleCoordinate","_startPinchDistance","_pinchPrevented","_preventDragProcess","_mousePressed","_init","_clearLongTapTimeout","_resetClickTimeout","enterEvent","boundMouseMoveHandler","_mouseMoveHandler","bind","boundMouseWheelHandler","_mouseWheelHandler","removeEventListener","addEventListener","passive","compatEvent","_makeCompatEvent","_processEvent","mouseEnterEvent","moveEvent","mouseMoveEvent","wheelEvent","localX","localY","mouseWheelEvent","button","isTouch","startMouseMovePos","xOffset","pageX","yOffset","pageY","moveExceededManhattanDistance","correctedXOffset","isVertDrag","treatVertTouchDragAsPageScroll","isHorzDrag","treatHorzTouchDragAsPageScroll","pressedMouseMoveEvent","mouseUpEvent","_mouseLeaveHandler","mouseDoubleClickEvent","mouseClickEvent","downEvent","mouseRightDownEvent","_mouseEnterHandler","boundMouseMoveWithDownHandler","_mouseMoveWithDownHandler","boundMouseUpHandler","_mouseUpHandler","rootElement","documentElement","_longTapHandler","mouseDownEvent","doc","outsideHandler","mouseDownOutsideEvent","contains","_mouseDownHandler","_initPinch","pinchStartEvent","pinchEvent","pinchEndEvent","_checkPinchState","currentDistance","_stopPinch","_startPinch","box","mouseLeaveEvent","longTapEvent","eventLike","changedTouches","screenX","screenY","ctrlKey","altKey","shiftKey","metaKey","startsWith","view","SeparatorPane","topPaneId","bottomPaneId","dragEnabled","dragEventHandler","_topPaneId","_bottomPaneId","_dragEnabled","_offsetLeft","_dragEventHandler","_dragFlag","_initEvent","_wrapper","cursor","_dragEvent","_mouseDownEvent","_mouseUpEvent","_pressedMouseMoveEvent","_mouseEnterEvent","_mouseLeaveEvent","_startY","startDrag","setDragPaneFlag","dragDistance","drag","separatorOptions","background","destroy","isMouse","EventHandler","TOUCH_MIN_RADIUS","ZoomScrollEventHandler","_startScrollCoordinate","_touchCoordinate","_touchCancelCrosshair","_touchZoomed","_pinchScale","middleCoordinate","zoomScale","zoom","paneY","deltaX","deltaY","startScroll","scroll","deltaMode","DOM_DELTA_PAGE","DOM_DELTA_LINE","sign","yDif","OverlayEventHandler","overlays","preHoverOperate","hoverOperate","checkEventCoordinateOn","onMouseLeave","onMouseEnter","updatePressedInstance","_waitingForMouseMove","shapeHoverOperate","shapeClickOperate","annotationHoverOperate","isStart","updateProgressInstance","mouseMoveForDrawing","prevShapeHoverOperate","prevAnnotationHoverOperate","_performOverlayMouseHover","setMouseOperate","mouseLeftButtonDownForDrawing","startPressedOtherMove","onClick","visibleAnnotations","annotationOperate","shapeOperateValid","removeShape","onRightClick","removeInstance","mousePressedPointMove","mousePressedOtherMove","KeyBoardCode","EQUAL","MINUS","ARROW_LEFT","ARROW_RIGHT","KeyBoardEventHandler","code","ChartEvent","_chartContentLeftRight","_chartContentTopBottom","_paneContentSize","_event","_pinchStartEvent","_pinchEvent","_mouseClickEvent","_mouseRightDownEvent","_mouseMoveEvent","_mouseWheelEvent","_longTapEvent","_boundKeyBoardDownEvent","_keyBoardDownEvent","_boundContextMenuEvent","_zoomScrollEventHandler","_overlayEventHandler","_keyBoardEventHandler","keyBoardDownEvent","_checkEventInChartContent","_shouldPerformOverlayEvent","_compatChartEvent","dragPaneFlag","_checkZoomScroll","isPressed","isEmpty","compatY","contentTop","contentBottom","contentLeft","contentRight","chartContentLeftRight","chartContentTopBottom","paneContentSize","throttle","func","wait","previous","now","context","args","arguments","apply","renderFillDiamond","renderFillTriangle","Annotation","_point","_symbolCoordinate","isActive","symbolOptions","styleSize","styleActiveSize","drawCustomSymbol","_drawSymbol","isOn","checkEventCoordinateOnCustomSymbol","Tag","_text","_mark","success","tagOptions","_getY","_drawLine","_drawMark","tagTextOptions","_getTextRectWidth","tagLineOptions","tagMarkOptions","valueRectWidth","textOptions","ChartPane","_initChartContainer","_shapeBaseId","_paneBaseId","_separatorDragStartTopPaneHeight","_separatorDragStartBottomPaneHeight","_invalidatePane","_crosshairObserver","_xAxisPane","_chartContainer","_panes","_separators","_chartWidth","_chartHeight","_chartEvent","adjustPaneViewport","userSelect","webkitUserSelect","msUserSelect","MozUserSelect","webkitTapHighlightColor","outline","borderStyle","tabIndex","techDatas","_","topPaneHeight","bottomPaneHeight","pane","shouldMeasureWidth","should","computeAxis","paneHeight","separatorSize","separatorTotalHeight","getSelfHeight","paneExcludeXAxisSeparatorHeight","techPaneTotalHeight","candlePaneHeight","total","setPaneContentSize","setChartContentTopBottom","isYAxisLeft","isOutside","paneWidth","mainWidth","yAxisOffsetLeft","mainOffsetLeft","getSelfWidth","setTotalDataSpace","setSize","content","setChartContentLeftRight","shouldMeasureHeight","shouldLayout","shouldComputeAxis","shouldForceComputeAxis","_measurePaneHeight","isAdjust","adjust","_measurePaneWidth","hasInstance","deleteSeparatorTopPaneId","updatePaneId","addInstance","setPaneOptions","Array","keys","pop","_separatorStartDrag","_separatorDrag","ShapeTemplateClass","onDrawStart","hasPane","shapeInstance","annotationInstance","add","shouldUpdate","shouldAdd","updateSuccess","forceShouldAdjust","setDragEnabled","setTimezone","absoluteYAxis","absoluteTop","panes","ry","toDataURL","Chart","_chartPane","chartWidth","chartHeight","applyStyleOptions","setPriceVolumePrecision","setLeftMinVisibleBarCount","setRightMinVisibleBarCount","clearDataList","addData","calcInstance","then","lastDataTimestamp","cb","setLoadMoreCallback","paneOptions","hasTemplate","createTechnicalIndicator","addTemplate","promise","override","getTemplateInfo","getInstanceInfo","removeTechnicalIndicator","getTemplate","createShape","setInstanceOptions","createAnnotation","remove","createTag","setZoomEnabled","zoomEnabled","setScrollEnabled","scrollEnabled","animationDuration","startTime","getTime","animation","progress","finished","dis","difBarCount","offsetRightSpace","scrollByDistance","scaleDataSpace","difSpace","progressDataSpace","zoomAtCoordinate","finder","getConvertPictureUrl","chartBaseId","CHART_NAME_PREFIX","version","init","ds","errorMessage","dom","getElementById","chart","chartId","dispose","dcs"],"mappings":"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"}